<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de">
<head>
<!-- 2017-11-09 Thu 15:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parallele Algorithmen</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Johannes Brauer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<link rel="stylesheet" type="text/css" href="mycss/mystyle.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Parallele Algorithmen
<br />
<span class="subtitle">Parallelprogrammierung</span>
</h1>

<div id="outline-container-org1609c36" class="outline-2">
<h2 id="org1609c36">Grundlagen</h2>
<div class="outline-text-2" id="text-org1609c36">
</div>
<div id="outline-container-org0ae1915" class="outline-3">
<h3 id="org0ae1915">Overview of Parallelism Beyond Concurrency</h3>
<div class="outline-text-3" id="text-org0ae1915">
<p>
Parallelism in computing
</p>

<ul class="org-ul">
<li>So far the emphasis has been on parallelism as concurrency made
efficient: multiple concurrent tasks are distributed among
processors so that the tasks can be processed literally at the same
time&#x2013;in parallel.</li>
<li>In a multiprocessing approach to concurrency, multiple processes
execute on multiple processors.
<ul class="org-ul">
<li>The OS handles the scheduling.</li>
</ul></li>
<li>In a multithreading approach to concurrency, multiple threads within a process execute on multiple processors.
<ul class="org-ul">
<li>If API threads map to <i>native</i> threads, then the OS handles the scheduling. (Assuming no GIL.)</li>
</ul></li>
<li>In hybrid approaches (e.g., Asp.Net's multithreaded worker
processes), there's still the distribution of task processing among
multiple processors.</li>
</ul>

<p>
The goal now is to focus on broader uses of parallel computation.
</p>

<ul class="org-ul">
<li>Some reasons why parallelism is now so attractive:
<ul class="org-ul">
<li>Consumer desktop, laptop, and even handheld machines are now
multi-core, with one or more processors per core.
<ul class="org-ul">
<li>In fact (even if not in reputation), these machines are <i>parallel computers</i>.</li>
<li>At issue is how to exploit this possibily for parallel computations.</li>
</ul></li>
<li>Consumer-level machines may come with GPUs (graphics-processing
units) and FPUs (floating-point unit or <i>math coproccessor</i>) as
well as CPUs (central or <i>generic</i> processing units).
<ul class="org-ul">
<li>GPUs and FPUs are designed for parallelism.</li>
<li><i>gpgpu</i> (general-purpose computing on a GPU) refers to the use
of a GPU for <i>general purposes</i>, that is, purposes beyond just
graphics. So gpgpu approaches a GPU as if it were a
(specialized) CPU.</li>
</ul></li>
<li>Distributed software systems such as email and the WWW have code
modules that execute on physically distinct devices.
<ul class="org-ul">
<li>The <i>network as the computer</i> describes networked hosts, each
with its own collection of processors, as a resource for
distributed parallel computation.</li>
<li>The key challenge is how to coordinate such computations and to share information among them.
<ul class="org-ul">
<li>Message-passing is a popular, general method.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Parallel computations may used shared, centralized memory;
distributed memory; or some hybrid of the two.
<ul class="org-ul">
<li>The point of interest is how to write programs that execute as
parallel computations.</li>
<li>Support from toolchains (in particular, compilers therein) is
critical to encouarge widespread use of hardware support for
parallel computing.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgb5b6dbd" class="outline-3">
<h3 id="orgb5b6dbd">A SIMD Auto Vectorization Code Example in C</h3>
<div class="outline-text-3" id="text-orgb5b6dbd">
</div><div id="outline-container-org3f63d94" class="outline-4">
<h4 id="org3f63d94">the non parallel version</h4>
<div class="outline-text-4" id="text-org3f63d94">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">To compile and run:</span>

<span style="color: #8D8D84; font-style: italic;">    gcc -o nonsimd nonsimd.c</span>
<span style="color: #8D8D84; font-style: italic;">    ./nonsimd  # On Windows: simd</span>
<span style="color: #8D8D84;">*/</span>
  
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">Length</span> 8

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">array1</span><span style="color: #7388D6;">[</span> <span style="color: #7388D6;">]</span> = <span style="color: #7388D6;">{</span>1, 2, 3, 4, 5, 6, 7, 8<span style="color: #7388D6;">}</span>; 
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">array2</span><span style="color: #7388D6;">[</span> <span style="color: #7388D6;">]</span> = <span style="color: #7388D6;">{</span>8, 7, 6, 5, 4, 3, 2, 1<span style="color: #7388D6;">}</span>; 
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">sum</span><span style="color: #7388D6;">[</span>Length<span style="color: #7388D6;">]</span>;

  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> sum<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = array1<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> + array2<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span>; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">serial computation *</span><span style="color: #8D8D84;">*/</span>
  
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%i "</span>, sum<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>;  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">ideal case for data parallelism *</span><span style="color: #8D8D84;">*/</span>
  putchar<span style="color: #7388D6;">(</span><span style="color: #008000;">'\n'</span><span style="color: #7388D6;">)</span>;
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span>
<span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">A better way: SSE = Streaming SIMD Extensions = additional instruction set, </span>
<span style="color: #8D8D84; font-style: italic;">    more CPU registers</span>

<span style="color: #8D8D84; font-style: italic;">In the late 1990s, Intel introduced an SSE instruction set for their Pentium III</span>
<span style="color: #8D8D84; font-style: italic;">processors. This became known as the MMX instruction set. (Officially, MMX is not an</span>
<span style="color: #8D8D84; font-style: italic;">acronym.) AMD earlier introduced a comparable instruction set known as 3DNow!. In any case, </span>
<span style="color: #8D8D84; font-style: italic;">the hardware support included new registers with names that start with 'xmm'. In the </span>
<span style="color: #8D8D84; font-style: italic;">original SSE, there was support only for integer operations.</span>

<span style="color: #8D8D84; font-style: italic;">SEE has progressed, with new versions: SSE2, SSE3, SSSE3, and</span>
<span style="color: #8D8D84; font-style: italic;">SSE4. The newer versions bring SIMD support for both integer and</span>
<span style="color: #8D8D84; font-style: italic;">floating-point operations. At the same time, C/C++ compilers such as</span>
<span style="color: #8D8D84; font-style: italic;">GNU and Clang provided support, eventually automatic, for</span>
<span style="color: #8D8D84; font-style: italic;">SIMD-friendly code. Nowadays, both compilers are capable of 'automatic</span>
<span style="color: #8D8D84; font-style: italic;">vectorization' of approrpiately written source code.</span>

<span style="color: #8D8D84; font-style: italic;">The short version: elements in the arrays 'array1' and 'array2' should</span>
<span style="color: #8D8D84; font-style: italic;">be added pairwise in parallel in order to boost performance.</span>
<span style="color: #8D8D84;">*/</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge081793" class="outline-4">
<h4 id="orge081793">the parallel version</h4>
<div class="outline-text-4" id="text-orge081793">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">To compile and run:</span>

<span style="color: #8D8D84; font-style: italic;">    gcc -o simd simd.c</span>
<span style="color: #8D8D84; font-style: italic;">    ./simd  # On Windows: simd</span>

<span style="color: #8D8D84; font-style: italic;"> No explicit optimization is required. The GNU and Clang compilers</span>
<span style="color: #8D8D84; font-style: italic;"> do the optimization automatically. </span>
<span style="color: #8D8D84;">*/</span>
  
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">A typedef in C supports 'aliasing' of data types. Here's a simple example:</span>

<span style="color: #8D8D84; font-style: italic;">     typedef unsigned boolean; ## 'unsigned' is short for 'unsigned int'</span>

<span style="color: #8D8D84; font-style: italic;">   This typedef allows 'boolean' to be used in place of 'unsigned', for example:</span>

<span style="color: #8D8D84; font-style: italic;">     boolean flag = 0;  ## 0 is 'false' in C</span>

<span style="color: #8D8D84; font-style: italic;">   The typedef below is more complicated, as it includes special information for the</span>
<span style="color: #8D8D84; font-style: italic;">   compiler, in particuar the '__attribute__' and 'vector_size' terms. Here's the upshot</span>
<span style="color: #8D8D84; font-style: italic;">   of the typedef:</span>

<span style="color: #8D8D84; font-style: italic;">   # 'intV8' aliases 'int', but as a vector (1-dimensional array) rather than as a scalar </span>
<span style="color: #8D8D84; font-style: italic;">      type.</span>
<span style="color: #8D8D84; font-style: italic;">   # The size of an 'intV8' vector is set to 32 == Length * sizeof(int) == 8 * 4. </span>
<span style="color: #8D8D84; font-style: italic;">     The size is in bytes.</span>
<span style="color: #8D8D84;">*/</span>
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">Length</span> 8
<span style="color: #0000FF;">typedef</span> <span style="color: #6434A3;">int</span> <span style="color: #6434A3;">intV8</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>vector_size <span style="color: #909183;">(</span><span style="color: #6434A3;">Length</span> * <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span><span style="color: #6434A3;">int</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">32 bytes *</span><span style="color: #8D8D84;">*/</span>
    
<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">dataV1</span> = <span style="color: #7388D6;">{</span>1, 2, 3, 4, 5, 6, 7, 8<span style="color: #7388D6;">}</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">initialize vector dataV1: no array syntax </span><span style="color: #8D8D84;">*/</span>                   
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">dataV2</span> = <span style="color: #7388D6;">{</span>8, 7, 6, 5, 4, 3, 2, 1<span style="color: #7388D6;">}</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">same for vector dataV2 </span><span style="color: #8D8D84;">*/</span>
  
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">add</span> = dataV1 + dataV2; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">9  9  9  9  9  9  9 9 -- no array syntax </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">mul</span> = dataV1 * dataV2; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">8 14 18 20 20 18 14 8 -- no array syntax </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">div</span> = dataV2 / dataV1; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">8  3  2  1  0  0  0 0 -- no array syntax </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%i "</span>, add<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">array syntax </span><span style="color: #8D8D84;">*/</span>
  putchar<span style="color: #7388D6;">(</span><span style="color: #008000;">'\n'</span><span style="color: #7388D6;">)</span>;
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5e288a3" class="outline-3">
<h3 id="org5e288a3">using the shell</h3>
<div class="outline-text-3" id="text-org5e288a3">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ gcc -o nonsimd nonsimd.c
bash-3.2$ gcc -o simd simd.c

bash-3.2$ ./nonsimd
9 9 9 9 9 9 9 9 

bash-3.2$ ./simd
9 9 9 9 9 9 9 9 </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org89b8674" class="outline-3">
<h3 id="org89b8674">in Assembly-Code</h3>
<div class="outline-text-3" id="text-org89b8674">
<p>
Some compiler-generated assembly code from the simd.c program
</p>
<pre class="example">
# A note on C compilation:

                 +------------+    +--------+    +---------+    +------+
C source code---&gt;|preprocessor|---&gt;|compiler|---&gt;|assembler|---&gt;|linker|---&gt;executable 	
                 +------------+    +--------+ /  +---------+ /  +------+    machine code
                                             /              /
                                        assembly code    object code

## Compile command: gcc -S simd.c  (produces 'simd.s' by default)	
	
main:
   ## The identifiers that start with $ are constants.
	
   ## %rsp is the /stack pointer/, which points to the TOP position on the stack.
	
   ## An expression such as 96(%rsp) is an address or pointer expression: %rsp is the base 
      address, 96 is of the offset therefrom. The offset is in bytes, so in this case it/s 
      96 bytes. (The Intel stack grows downwards, from high to low addresses.)

   ## The full expression 'movl $1, 96(%rsp)' copies (not literally moves) the 32-bit value 
      1 into stack location %rsp + 96:

	The stack
	  ...                     ## high addresses
	+-----+
	|  1  |&lt;------%rsp + 96   ## instruction 'movl $l, 96(%rsp)' puts 1 in this location
        +-----+
	  ...                
	+-----+
	|     |
	+-----+
	|     |&lt;------%rsp   ## %rsp is the 64-bit 'stack pointer'
	+-----+
	  ...                     ## low addresses
	
   ## Note that every offset increases by 4 because the values (1,2,3,...) are 4-byte 
      (32-bit) integer values.
   movl $1, 96(%rsp)         # data vector 1 start
   movl $2, 100(%rsp)
   movl $3, 104(%rsp)
   movl $4, 108(%rsp)
   movl $5, 112(%rsp)
   movl $6, 116(%rsp)
   movl $7, 120(%rsp)
   movl $8, 124(%rsp)        # data vector 1 end
   movl $8, 128(%rsp)        # data vector 2 start
   movl $7, 132(%rsp)
   movl $6, 136(%rsp)
   movl $5, 140(%rsp)
   movl $4, 144(%rsp)
   movl $3, 148(%rsp)
   movl $2, 152(%rsp)
   movl $1, 156(%rsp)        # data vector 2 end
	
   movdqa 96(%rsp), %xmm1    # %xmm1 = dataV1[0..3]: 'dq' is for 'double quadword'
	                     # (quad == 64 bits) and %xmm1 is a 128-bit register
	
   movdqa 128(%rsp), %xmm0   # %xmm0 = dataV2[0..3]
	
   paddd %xmm0, %xmm1        # %xmm1 += %xmm0 (the 'paddd' instruction is for 'packed 
                               addition' of 32-bit values)
   movdqa 112(%rsp), %xmm2   # %xmm2 = dataV1[4..7]
   movdqa 144(%rsp), %xmm0   # %xmm0 = dataV2[4..7]
   paddd %xmm2, %xmm0        # %xmm0 += %xmm2
	
   movdqa %xmm1, 32(%rsp)    # save %xmm1 to stack (sums of the 1st four elements)
   movdqa %xmm0, 48(%rsp)    # save %xmm0 to stack (sums of the last four elements)
	                     # the sum is now on the stack contiguously, in effect as an array
   ...

</pre>
</div>
</div>
</div>
<div id="outline-container-orgbe16785" class="outline-2">
<h2 id="orgbe16785">Zeitmessungen &#x2013; ein Code-Beispiel</h2>
<div class="outline-text-2" id="text-orgbe16785">
</div>
<div id="outline-container-orge9dd873" class="outline-3">
<h3 id="orge9dd873">Source Code</h3>
<div class="outline-text-3" id="text-orge9dd873">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">A timing example to contrast serial and parallel execution on typical matrix/vector </span>
<span style="color: #8D8D84; font-style: italic;">    operations. The program uses 'SSE intrinsics', the interface for which is the header </span>
<span style="color: #8D8D84; font-style: italic;">    file 'xmmintrin.h'.</span>
<span style="color: #8D8D84; font-style: italic;">    </span>
<span style="color: #8D8D84; font-style: italic;">    Some of the code is obscure, a good sign of what's involved as you get ever closer </span>
<span style="color: #8D8D84; font-style: italic;">    to the metal.</span>

<span style="color: #8D8D84; font-style: italic;">    The program adds two vectors, and then multiples the rows of the sum vector by a </span>
<span style="color: #8D8D84; font-style: italic;">    +third vector.</span>
<span style="color: #8D8D84; font-style: italic;">*</span><span style="color: #8D8D84;">*/</span>

<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">xmmintrin.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdint.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #0000FF;">typedef</span> <span style="color: #6434A3;">void</span> <span style="color: #707183;">(</span>*<span style="color: #6434A3;">func</span><span style="color: #707183;">)()</span>;  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">a function that takes no arguments and returns void *</span><span style="color: #8D8D84;">*/</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">Length</span>      <span style="color: #707183;">(</span>2048<span style="color: #707183;">)</span>
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">AlignedVals</span>    <span style="color: #707183;">(</span>4<span style="color: #707183;">)</span>

 <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">Ensure 16-byte alignment of vector elements: 16 bytes is 4 ints or 4 floats,</span>
<span style="color: #8D8D84; font-style: italic;">     which comes to 128 bits--the size of an %xmm register. *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">v1</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>; 
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">v2</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">v3</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">r1</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">r2</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">Initialize with small random values. *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #6434A3;">void</span> <span style="color: #006699;">init</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
    v1<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">float</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>rand<span style="color: #709870;">()</span> / RAND_MAX<span style="color: #909183;">)</span>; 
    v2<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">float</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>rand<span style="color: #709870;">()</span> / RAND_MAX<span style="color: #909183;">)</span>;  
    v3<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">float</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>rand<span style="color: #709870;">()</span> / RAND_MAX<span style="color: #909183;">)</span>; 
  <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">void</span> <span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> r1<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = <span style="color: #7388D6;">(</span>v1<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> + v2<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span> * v3<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span>; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">the math *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">void</span> <span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">set up for the special vector instructions *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_v1</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> v1; 
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_v2</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> v2;
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_v3</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> v3;
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_rv</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> r2;

  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">Multiply a vector row by a vector: the outer instruction is _mm_mul_ps. </span>
<span style="color: #8D8D84; font-style: italic;">      _mm_add_ps adds vector elements.</span>
<span style="color: #8D8D84; font-style: italic;">   *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">n</span> = Length / AlignedVals; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">in this case, n == 512 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">for</span><span style="color: #7388D6;">(</span> i = 0; i &lt; n; i++<span style="color: #7388D6;">)</span> mm_rv<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = _mm_mul_ps<span style="color: #7388D6;">(</span>_mm_add_ps<span style="color: #909183;">(</span>mm_v1<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>, mm_v2<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>, mm_v3<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">from the Intel developer's guide: in-line assembly for reasonably good timings *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #6434A3;">uint64_t</span> <span style="color: #006699;">rdtsc</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #6434A3;">uint32_t</span> <span style="color: #BA36A5;">lo</span>, <span style="color: #BA36A5;">hi</span>;
    <span style="color: #0000FF;">__asm__</span> __volatile__ <span style="color: #7388D6;">(</span>
      <span style="color: #008000;">"xorl %%eax, %%eax\n"</span>
      <span style="color: #008000;">"cpuid\n"</span>
      <span style="color: #008000;">"rdtsc\n"</span>
      : <span style="color: #008000;">"=a"</span> <span style="color: #909183;">(</span>lo<span style="color: #909183;">)</span>, <span style="color: #008000;">"=d"</span> <span style="color: #909183;">(</span>hi<span style="color: #909183;">)</span>
      :
      : <span style="color: #008000;">"%ebx"</span>, <span style="color: #008000;">"%ecx"</span><span style="color: #7388D6;">)</span>;
    <span style="color: #0000FF;">return</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">uint64_t</span><span style="color: #7388D6;">)</span> hi &lt;&lt; 32 | lo;
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">void</span> <span style="color: #006699;">time_it</span><span style="color: #707183;">(</span><span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">msg</span>, <span style="color: #6434A3;">func</span> <span style="color: #BA36A5;">func2run</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #6434A3;">long</span> <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">start</span>, <span style="color: #BA36A5;">stop</span>;
  start = rdtsc<span style="color: #7388D6;">()</span>;
  func2run<span style="color: #7388D6;">()</span>;
  stop = rdtsc<span style="color: #7388D6;">()</span>;
  printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%s: %lld\n"</span>, msg, stop - start<span style="color: #7388D6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  init<span style="color: #7388D6;">()</span>;
  time_it<span style="color: #7388D6;">(</span><span style="color: #008000;">"in_serial()  "</span>, in_serial<span style="color: #7388D6;">)</span>;
  time_it<span style="color: #7388D6;">(</span><span style="color: #008000;">"in_parallel()"</span>, in_parallel<span style="color: #7388D6;">)</span>;
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org29d7c7a" class="outline-3">
<h3 id="org29d7c7a">using the shell</h3>
<div class="outline-text-3" id="text-org29d7c7a">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ gcc -o sseTimings sseTimings.c
bash-3.2$ ./sseTimings
<span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span>  : 19905
<span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span>: 10483
bash-3.2$ ./sseTimings
<span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span>  : 22260
<span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span>: 11319
bash-3.2$ ./sseTimings
<span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span>  : 21785
<span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span>: 10957</pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org622f938" class="outline-2">
<h2 id="org622f938">Parallelit√§t und Performance</h2>
<div class="outline-text-2" id="text-org622f938">
</div>
<div id="outline-container-org19b4bca" class="outline-3">
<h3 id="org19b4bca">How Can Performance Gains Through Parallelism Be Measured</h3>
<div class="outline-text-3" id="text-org19b4bca">
<p>
Parallelism and performance
</p>

<ul class="org-ul">
<li>Revised <i>sseTimings</i> program, now in 3 versions: <i>timings2048</i>,
<i>timings8192</i>, and <i>timings32768</i>:
<ul class="org-ul">
<li>Average speedup of 'serial' version from 20 test runs:<br />
'timings2048':  average speedup of 2.17    ## 2048 is vector size<br />
'timings8192':  average speedup of 1.72    ##  8192 <code>= 2048 x 4\\
       'timings32768': average speedup of 1.65    ## 32768 =</code> 8192 x 4</li>
<li>Key question: The 'in<sub>parallel</sub>()' function does only 1/4th the
arithmetic operations as the 'in<sub>serial</sub>()' function. Why is max
speedup above only slightly over 2 rather than close to (or even
at) 4?</li>
</ul></li>
</ul>
<hr />
<ul class="org-ul">
<li>How to measure performance?
<ul class="org-ul">
<li>Response time ('latency'): elapsed time
<ul class="org-ul">
<li>Program P1 takes 10 units, whereas program P2 takes 5: P1/P2 =
2, a speedup of 2</li>
</ul></li>
<li>Throughput: number of tasks completed in a fixed amount of time.
<ul class="org-ul">
<li><p>
On single-processor machine M1, with required times for processing above the arrows:
</p>
<pre class="example">
    5       3   +-----------+
T2-----&gt;T1-----&gt;| processor |  ## Two tasks completed in 8 time units on M1
                +-----------+
</pre></li>
<li><p>
On multiple-processor machine M2:
</p>
<pre class="example">
   5   +-----------+
T1-----&gt;| processor | ## T1 takes a bit longer on M2
       +-----------+
               ## Two tasks completed in 5 time units on M2, a speedup of about 1.6
   5   +-----------+
T2-----&gt;| processor | ## T2 takes the same amount of time on M1 and M2
       +-----------+
</pre></li>
</ul></li>
<li>Big picture: parallelism is a good way to boost performance
<ul class="org-ul">
<li>Parallelism tends to increase throughput, and thereby performance.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org4aa84e4" class="outline-3">
<h3 id="org4aa84e4">The ParallelSort Program in Java</h3>
<div class="outline-text-3" id="text-org4aa84e4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #036A07;">/** A Java program to illustrate the potential speedup of parallelism, in this</span>
<span style="color: #036A07;">    case for sorting: the program uses the new (as of Java 8) Arrays.parallelSort</span>
<span style="color: #036A07;">    method, and also the Arrays.parallelSetAll method for parallel initialization</span>
<span style="color: #036A07;">    of the roughly 4M array of integers.</span>

<span style="color: #036A07;">    As noted, Java 8 or greater is requied.</span>
<span style="color: #036A07;">*/</span>
<span style="color: #0000FF;">import</span> <span style="color: #D0372D;">java</span>.<span style="color: #D0372D;">util</span>.<span style="color: #6434A3;">Random</span>;
<span style="color: #0000FF;">import</span> <span style="color: #D0372D;">java</span>.<span style="color: #D0372D;">util</span>.<span style="color: #6434A3;">Arrays</span>;

<span style="color: #0000FF;">public</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ParallelSort</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">int</span><span style="color: #7388D6;">[</span> <span style="color: #7388D6;">]</span> <span style="color: #BA36A5;">array2Sort</span>;
    
    <span style="color: #0000FF;">public</span> <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">String</span><span style="color: #909183;">[</span> <span style="color: #909183;">]</span> <span style="color: #BA36A5;">args</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">ParallelSort</span><span style="color: #909183;">()</span>.doIt<span style="color: #909183;">()</span>;
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">doIt</span><span style="color: #7388D6;">()</span> <span style="color: #7388D6;">{</span>
        <span style="color: #0000FF;">final</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">arraySize</span> = 1024 * 1024 * 4;  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">about 4M: 4,194,304     /** line 1 **/</span>

        <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">** serial sort</span>
        init<span style="color: #909183;">(</span>arraySize<span style="color: #909183;">)</span>;
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">serial</span> = sortArray<span style="color: #909183;">(</span>array2Sort, <span style="color: #D0372D;">false</span><span style="color: #909183;">)</span>;                        <span style="color: #036A07;">/** line 2 **/</span>

        <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">** parallel sort</span>
        init<span style="color: #909183;">(</span>arraySize<span style="color: #909183;">)</span>;
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">parallel</span> = sortArray<span style="color: #909183;">(</span>array2Sort, <span style="color: #D0372D;">true</span><span style="color: #909183;">)</span>;                       <span style="color: #036A07;">/** line 3 **/</span>

        <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">** report</span>
        log<span style="color: #909183;">(</span><span style="color: #008000;">"Serial sort of array of size:   "</span> + arraySize<span style="color: #909183;">)</span>;
        log<span style="color: #909183;">(</span><span style="color: #008000;">"Elapsed time: "</span> + serial<span style="color: #909183;">)</span>;
        log<span style="color: #909183;">(</span><span style="color: #008000;">""</span><span style="color: #909183;">)</span>;

        log<span style="color: #909183;">(</span><span style="color: #008000;">"Parallel sort of array of size: "</span> + arraySize<span style="color: #909183;">)</span>; 
        log<span style="color: #909183;">(</span><span style="color: #008000;">"Elapsed time: "</span> + parallel<span style="color: #909183;">)</span>;

        log<span style="color: #909183;">(</span><span style="color: #008000;">""</span><span style="color: #909183;">)</span>;
        <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">ratio</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">double</span><span style="color: #909183;">)</span> serial / <span style="color: #909183;">(</span><span style="color: #6434A3;">double</span><span style="color: #909183;">)</span> parallel;
        <span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span>parallel &lt; <span style="color: #6434A3;">serial</span><span style="color: #909183;">)</span> 
            log<span style="color: #909183;">(</span><span style="color: #008000;">"Speedup:  "</span> + ratio<span style="color: #909183;">)</span>;
        <span style="color: #0000FF;">else</span>
            log<span style="color: #909183;">(</span><span style="color: #008000;">"Slowdown: "</span> + ratio<span style="color: #909183;">)</span>;
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">init</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">size</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        array2Sort = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">int</span><span style="color: #909183;">[</span>size<span style="color: #909183;">]</span>;
        <span style="color: #036A07;">/** parallel initialization of array elements **/</span>
        Arrays.parallelSetAll<span style="color: #909183;">(</span>array2Sort,                                  <span style="color: #036A07;">/** line 4 **/</span> 
                              i-&gt;<span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Random</span><span style="color: #709870;">()</span>.nextInt<span style="color: #709870;">()</span><span style="color: #909183;">)</span>;                  <span style="color: #036A07;">/** line 5 **/</span>
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">long</span> <span style="color: #006699;">sortArray</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">int</span><span style="color: #909183;">[</span> <span style="color: #909183;">]</span> <span style="color: #BA36A5;">array</span>, <span style="color: #6434A3;">boolean</span> <span style="color: #BA36A5;">parallel</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">start</span> = System.currentTimeMillis<span style="color: #909183;">()</span>;
        <span style="color: #036A07;">/** parallel version of merge-sort **/</span>
        <span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span>parallel<span style="color: #909183;">)</span> Arrays.parallelSort<span style="color: #909183;">(</span>array<span style="color: #909183;">)</span>;                          <span style="color: #036A07;">/** line 6 **/</span>
        <span style="color: #036A07;">/** variant of quicksort ('dual pivot') **/</span>
        <span style="color: #0000FF;">else</span> Arrays.sort<span style="color: #909183;">(</span>array<span style="color: #909183;">)</span>;                                           <span style="color: #036A07;">/** line 7 **/</span>
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">stop</span> = System.currentTimeMillis<span style="color: #909183;">()</span>;
        <span style="color: #0000FF;">return</span> stop - start;
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">log</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">String</span> <span style="color: #BA36A5;">msg</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        System.out.println<span style="color: #909183;">(</span>msg<span style="color: #909183;">)</span>;
    <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
<div id="outline-container-orgc97b3cc" class="outline-4">
<h4 id="orgc97b3cc">using the shell</h4>
<div class="outline-text-4" id="text-orgc97b3cc">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ java ParallelSort
Serial sort of array of size:   4194304
Elapsed time: 824

Parallel sort of array of size: 4194304
Elapsed time: 358

Speedup:  2.3016759776536313
bash-3.2$ java ParallelSort
Serial sort of array of size:   4194304
Elapsed time: 710

Parallel sort of array of size: 4194304
Elapsed time: 258

Speedup:  2.751937984496124
bash-3.2$ java ParallelSort
Serial sort of array of size:   4194304
Elapsed time: 807

Parallel sort of array of size: 4194304
Elapsed time: 295

Speedup:  2.7355932203389832</pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org667f2e0" class="outline-3">
<h3 id="org667f2e0">Amdahls Law by Example</h3>
<div class="outline-text-3" id="text-org667f2e0">
<ul class="org-ul">
<li>The law, named after its creator (a one-time IBM engineer who
founded a IBM rival company), sets a theoretical limit on the
speedup that can be achieved in a computation.
<ul class="org-ul">
<li>The law has the practical benefit of sharpening intuitions about
how speedup should be pursued.</li>
</ul></li>
<li>A sample problem for Amdahl's law: 
<ul class="org-ul">
<li>Compute the arithmetic mean of 4M floating-point values on
single-processor machine M1.  Call this problem P.</li>
<li>Compute the speedup of porting the solution to quad-processor
machine M4.
<ul class="org-ul">
<li>Assume that M1 and M4 differ only in the number of processors.</li>
</ul></li>
</ul></li>
<li>A step-by-step application of the law:
<ol class="org-ol">
<li>Compute response time for P on M1: \(RT1\)</li>
<li>Compute response time for P on M4: \(RT4\)</li>
<li>Compute the ratio: \(\frac{RT1}{RT4}\)
<ul class="org-ul">
<li>If \(\frac{RT1}{RT4} = 1\), the response times are the same: no difference between M1 and M4 performance.</li>
<li>If \(\frac{RT1}{RT4} < 1\), there's slowdown rather than speedup.</li>
<li>If \(\frac{RT1}{RT4} > 1\), there's speedup.</li>
</ul></li>
<li>Normalize \(RT1\) to 1 time unit: keeps things simple.</li>
<li>Break \(RT4\) into two parts: 
<ul class="org-ul">
<li>\(enchanced\): in this case, parallel and</li>
<li>\(unenhanced\): in this case, serial</li>
<li>The \(unenhanced\) part of \(RT4\) is the part still done in serial
mode &#x2013; no benefit of parallelism.
<ul class="org-ul">
<li>The data set needs to be partitioned, assigned to workers
(threads or processes), the results from the workers need to
be aggregated, etc.</li>
</ul></li>
<li>The \(enhanced\) part of \(RT4\) is the part that benefits from the
speedup due to parallelism.</li>
<li>\[Speedup = \frac{RT1}{RT4} = \frac{1}{unenhanced + enhanced}\]</li>
<li>The \(enhanced\) depends on two factors: what fraction of time is
sped up, and by what amount.  How much time does M4 speed in
'parallel mode' when solving P, and how much faster is M4 in
'parallel mode' than M1 in serial mode?</li>
<li>Assume M4 is four times faster than M1 when M4 is in 'parallel
mode', and that M4 is in 'parallel mode' 80% of the time when
solving P.</li>
<li>\[Speedup = \frac{RT1}{RT4} = \frac{1}{unenhanced + enhanced} = \frac{1}{0.2 + \frac{0.8}{4.0}} = 2.5\]</li>
<li>Under the given assumptions, M4 solves P 2.5 times faster than does M1.</li>
</ul></li>
</ol></li>
<li>The big picture of Amdahal's Law:
<ul class="org-ul">
<li>It's tempting to be distracted by how much faster a 'local
speedup' is: M4 is four times faster than M1 when M4 is in
'parallel mode'.</li>
<li>It's critical to focus on the fraction of time spent in enhanced
mode: M4 is in 'parallel mode' 80% of the time&#x2013;not 100% of time.</li>
</ul></li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Machine</th>
<th scope="col" class="org-right">Fraction in local speedup</th>
<th scope="col" class="org-right">Local speedup</th>
<th scope="col" class="org-right">Global speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">M4</td>
<td class="org-right">0.8</td>
<td class="org-right">4.0</td>
<td class="org-right">2.5</td>
</tr>

<tr>
<td class="org-left">M8</td>
<td class="org-right">0.7</td>
<td class="org-right">8.0</td>
<td class="org-right">2.6</td>
</tr>

<tr>
<td class="org-left">M12</td>
<td class="org-right">0.6</td>
<td class="org-right">12.0</td>
<td class="org-right"><b>2.2</b></td>
</tr>

<tr>
<td class="org-left">M16</td>
<td class="org-right">0.5</td>
<td class="org-right">16.0</td>
<td class="org-right">1.9</td>
</tr>

<tr>
<td class="org-left">M20</td>
<td class="org-right">0.4</td>
<td class="org-right">20.0</td>
<td class="org-right">1.6</td>
</tr>

<tr>
<td class="org-left">M24</td>
<td class="org-right">0.3</td>
<td class="org-right">24.0</td>
<td class="org-right">1.4</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6616b9e" class="outline-3">
<h3 id="org6616b9e">Programming exercise for parallelism/performance</h3>
<div class="outline-text-3" id="text-org6616b9e">
<ul class="org-ul">
<li>More data gathering and reflecting on the data than coding</li>
<li>The current version calls Arrays.sort(&#x2026;) and Arrays.parallelSort(&#x2026;) on an array.
<ul class="org-ul">
<li>Array has roughly 4M array elements.</li>
<li>Speedup on the machines I tried was about 2.5 for the parallelSort.</li>
</ul></li>
<li><p>
In the interest of gathering more data, change the program so that
it tries various sizes.  For instance:
</p>
<div class="org-src-container">
<pre class="src src-java">  <span style="color: #0000FF;">final</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">initialSize</span> = 1024;
  <span style="color: #0000FF;">final</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">howMany</span> = 16; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">don't go over 20 -- overflow occurs</span>
  <span style="color: #6434A3;">int</span><span style="color: #707183;">[</span> <span style="color: #707183;">]</span> <span style="color: #BA36A5;">arraySizes</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">int</span><span style="color: #707183;">[</span>howMany<span style="color: #707183;">]</span>;
  arraySizes<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = initialSize;
  <span style="color: #0000FF;">for</span> <span style="color: #707183;">(</span><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span> = 1; i &lt; <span style="color: #6434A3;">howMany</span>; i++<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
      arraySizes<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = arraySizes<span style="color: #7388D6;">[</span>i - 1<span style="color: #7388D6;">]</span> * 2;
  <span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
Get the speedup for each of the sizes, and note any trends in speedup.
</p></li>
<li>Do the same for numeric types other than int, for instance, long, float, and double.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Johannes Brauer</p>
<p class="date">Created: 2017-11-09 Thu 15:12</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>