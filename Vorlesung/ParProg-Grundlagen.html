<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de">
<head>
<!-- 2017-10-06 Fri 11:36 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parallelprogrammierung &#x2013; Grundlagen</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Johannes Brauer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<link rel="stylesheet" type="text/css" href="mycss/mystyle.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Parallelprogrammierung &#x2013; Grundlagen</h1>

<div id="outline-container-orga78922d" class="outline-2">
<h2 id="orga78922d">Ein wenig Geschichte &#x2026;</h2>
<div class="outline-text-2" id="text-orga78922d">
</div><div id="outline-container-org42b5629" class="outline-3">
<h3 id="org42b5629">&#x2026; der Rechensysteme</h3>
<div class="outline-text-3" id="text-org42b5629">
<p>
(vgl. <a class='org-ref-reference' href="#Bengel2015">Bengel2015</a>)
</p>
<dl class="org-dl">
<dt>1970 &#x2013; Stapelverarbeitung</dt><dd><ul class="org-ul">
<li>Einlesen von Aufträgen (jobs) und Bearbeitung durch die Maschine</li>
<li>Job-Scheduler bestimmt die Abarbeitungsreihenfolge</li>
<li><i>non-blocking IO</i> kommt zum Einsatz (Nebenläufigkeit)</li>
</ul></dd>
<dt>1975 &#x2013; Timesharing-Systeme</dt><dd><ul class="org-ul">
<li>interaktives Arbeiten mittels Kommandozeilen-Befehlen</li>
<li>Mehrbenutzerbetrieb</li>
<li>Zuteilung von Zeitscheiben</li>
</ul></dd>
<dt>1980 &#x2013; Personal Computer und Workstation</dt><dd><ul class="org-ul">
<li>hohe Rechenleistung am Arbeitsplatz</li>
<li>Rückkehr zum Einbenutzerbetrieb</li>
<li>Kommandozeile + graphische Benutzungsoberflächen</li>
<li>Insellösungen &#x2013; kein Zugriff auf gemeinsame Betriebsmittel</li>
<li>Notlösung: peer-to-peer-Netze</li>
</ul></dd>
<dt>1985 &#x2013; Client-Server-Systeme</dt><dd><ul class="org-ul">
<li>Zentralisierung bestimmter Dienste auf dedizierten Rechnern (server)</li>
<li>neue Betriebssystemkonzepte für Netzwerknutzung erforderlich</li>
</ul></dd>
<dt>1990 &#x2013; Cluster-Systeme</dt><dd><ul class="org-ul">
<li>auch <i>Verteilte Systeme</i></li>
<li>mehrere Rechner bzw. Multiprozessorsysteme teilen sich die Dienstserbringung</li>
<li>zur Erhöhung von Leistung und Ausfallsicherheit</li>
<li>Load Balancing Cluster / Serverfarmen</li>
<li>High Performance Computing (HPC) Cluster
<ul class="org-ul">
<li>Geschwindigkeitssteigerung durch Parallelisierung von Aufgaben</li>
<li>bei Ausfall eines Systems übernimmt ein anderes Cluster-Mitglied
dessen Aufgaben</li>
</ul></li>
</ul></dd>
<dt>1995 &#x2013; Peer-to-Peer-Systeme</dt><dd><ul class="org-ul">
<li>jede Maschine kann Client und Server sein</li>
<li>höhere Ausfallsicherheit</li>
</ul></dd>
<dt>2005 &#x2013; Cloud-Systeme oder Cloud-Computing</dt><dd><ul class="org-ul">
<li>Rezentralisierung der Rechenleistung durch Virtualisierung</li>
<li>Zugriff auf Ressourcen über Internet oder Intranet</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-org529b4e9" class="outline-3">
<h3 id="org529b4e9">&#x2026; der Technologie</h3>
<div class="outline-text-3" id="text-org529b4e9">
<p>
&#x2026; der Prozessoren und Speicherchips
</p>
<ul class="org-ul">
<li>Mooresches Gesetz von 1965: Verdoppelung der Anzahl der Transistoren
auf einem Chip ca. alle 18 Monate &#x2013; gilt noch heute</li>
<li>Entwicklung der Mikroprozessoren am Beispiel von Intel
<ul class="org-ul">
<li>1971: Intel 4004, Transistoren: 2300, Taktrate: 108 kHz</li>
<li>1999: Pentium III, Transistoren: 9.500.000, Taktrate: bis 1 GHz</li>
<li>2000 bis 2008: Pentium 4, Transistoren: 42.000.000, Taktrate: bis
3,8 GHz</li>
</ul></li>
<li>Speicherkapazität pro Chip
<ul class="org-ul">
<li>1970: 1 Kilobit</li>
<li>heute: 1 Gigabit</li>
</ul></li>
<li>Preisverfall bei MIPS und Kosten pro Bit</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgb88d4a1" class="outline-2">
<h2 id="orgb88d4a1">Rechnerarchitekturen für parallele und verteilte Systeme</h2>
<div class="outline-text-2" id="text-orgb88d4a1">
<p>
(vgl.  <a class='org-ref-reference' href="#Bengel2015">Bengel2015</a>)
</p>
</div>
<div id="outline-container-orga6895d9" class="outline-3">
<h3 id="orga6895d9">Taxonomie von parallelen Rechnerarchitekturen nach Flynn</h3>
<div class="outline-text-3" id="text-orga6895d9">
<p>
(vgl. <a class='org-ref-reference' href="#Flynn1972">Flynn1972</a>)
</p>
<ul class="org-ul">
<li>Anmerkungen:
<ul class="org-ul">
<li>Die Taxonomie sagt nichts darüber aus, ob die Architektur ein
einzelnes oder ein verteiltes System beschreibt.</li>
<li>TDie Taxonomie ist schon recht alt, wird aber als Referenz nach
wie vor benutzt.</li>
</ul></li>
<li>Abkürzungen:<br />
D = Daten<br />
I = Befehle (Instruktionen)<br />
P = Prozessor<br />
S steht für <i>single</i>, M für <i>multiple</i>.
<ul class="org-ul">
<li>Parallelität im Sinne dieser Taxonomie erfordert immer mehrere
Prozessoren (P).</li>
</ul></li>
</ul>
<dl class="org-dl">
<dt>SISD: single instruction, single data</dt><dd><ul class="org-ul">
<li>keine Form von Parallelität</li>
</ul></dd>
</dl>
<pre class="example">
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |                 
   +----------+    +---+    +----------+
</pre>
<dl class="org-dl">
<dt>SIMD: single instruction, multiple data</dt><dd><ul class="org-ul">
<li>Unterstützung in verschiedenen Programmiersprachen</li>
<li>heutzutage besonders relevant</li>
</ul></dd>
</dl>
<pre class="example">
   +----------+    +---+
   | D source |---&gt;| P |&lt;---+
   +----------+    +---+    |
   +----------+    +---+    |  +----------+
   | D source |---&gt;| P |&lt;---+--| I source |               
   +----------+    +---+    |  +----------+
   +----------+    +---+    |
   | D source |---&gt;| P |&lt;---+
   +----------+    +---+
</pre>
<dl class="org-dl">
<dt>MISD: multiple instruction, single data</dt><dd><ul class="org-ul">
<li>kaum praktische Bedeutung</li>
</ul></dd>
</dl>
<pre class="example">
                      +---+    +----------+
                 +---&gt;| P |&lt;---| I source |
                 |    +---+    +----------+
   +----------+  |    +---+    +----------+
   | D source |--+---&gt;| P |&lt;---| I source |               
   +----------+  |    +---+    +----------+ 
                 |    +---+    +----------+
                 +---&gt;| P |&lt;---| I source | 
                      +---+    +----------+
</pre>
<dl class="org-dl">
<dt>MIMD: multiple instruction, multiple data</dt><dd><ul class="org-ul">
<li>am ehesten in verteilten Systemen anzutreffen</li>
</ul></dd>
</dl>
<pre class="example">
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |
   +----------+    +---+    +----------+
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |                  
   +----------+    +---+    +----------+
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |
   +----------+    +---+    +----------+
</pre>
</div>
</div>

<div id="outline-container-org6194c80" class="outline-3">
<h3 id="org6194c80">Ausprägungen</h3>
<div class="outline-text-3" id="text-org6194c80">
</div><div id="outline-container-org738d7fa" class="outline-4">
<h4 id="org738d7fa">Eng gekoppelte Multiprozessoren und Multicore-Prozessoren</h4>
<div class="outline-text-4" id="text-org738d7fa">
<ul class="org-ul">
<li>mehrere Prozesse können <i>echt</i> parallel ablaufen (auf
Einprozessorsystemen hingegen nur Quasi-Parallelität)</li>
<li>gemeinsamer Hauptspeicher</li>
</ul>
</div>
</div>
<div id="outline-container-org17a543a" class="outline-4">
<h4 id="org17a543a">Vektorrechner</h4>
<div class="outline-text-4" id="text-org17a543a">
<ul class="org-ul">
<li>Ausführung einer Berechnung gleichzeitig auf vielen Daten</li>
<li>Anordnung der Daten als Vektor bzw. Matrix</li>
<li>Beispiel für SIMD-Architektur</li>
<li>High-Performance-Computing</li>
<li>bekannt geworden ursprünglich durch Cray-Supercomputer (seit 1978)</li>
<li>genutzt z. B. für Simulationen (Meteorologie)</li>
</ul>
</div>
</div>
<div id="outline-container-orgb1ff66c" class="outline-4">
<h4 id="orgb1ff66c">General Purpose Computation on Graphic Processing Unit (GPGPU)</h4>
<div class="outline-text-4" id="text-orgb1ff66c">
<ul class="org-ul">
<li>ursprünglich bestehend aus beschränkt programmierbaren
Spezialprozessoren für Fließkommaoperationen</li>
<li>inzwischen frei programmierbare Prozessoren (tausende von Kernen),
dadurch</li>
<li>nutzbar nicht nur für Grafikanwendungen</li>
<li>Verwendbarkeit in höheren Programmiersprachen durch spezielle
Bibliotheken wie z. B. CUDA von Nvidia</li>
<li>Beispiel für SIMD-Architektur</li>
</ul>
</div>
</div>
<div id="outline-container-org0cea333" class="outline-4">
<h4 id="org0cea333">Lose gekoppelte Multiprozessoren</h4>
<div class="outline-text-4" id="text-org0cea333">
<ul class="org-ul">
<li>kein gemeinsamer Speicher</li>
<li>Synchronisation und Kommunikation durch Nachrichtenaustausch</li>
<li>Ziele: Erhöhung der Leistung, Erhöhung der Verfügbarkeit</li>
<li>MIMD möglich</li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-org98578e6" class="outline-2">
<h2 id="org98578e6">Parallelität vs. Nebenläufigkeit &#x2013; Überblick</h2>
<div class="outline-text-2" id="text-org98578e6">
</div>
<div id="outline-container-org6ba03d7" class="outline-3">
<h3 id="org6ba03d7">Concurrency, parallelism, and non-blocking I/O: an overview</h3>
<div class="outline-text-3" id="text-org6ba03d7">
<ul class="org-ul">
<li>For now, concurrency is "handling many tasks during the same time span":
<ul class="org-ul">
<li>Any app with a GUI (e.g., a game) needs to manage the GUI and perform the underlying logic.</li>
<li>A typical network app queues up requests, which then need to be handled concurrently.</li>
</ul></li>
<li>For now, (true) parallelism is "processing many tasks literally at the same time."
<ul class="org-ul">
<li>The tasks in a concurrent app would be farmed out to separate processors for true parallelism.</li>
<li>True parallelism requires multiple processors.
<ul class="org-ul">
<li>Multiprocessor machines now are available at consumer prices.</li>
</ul></li>
</ul></li>
<li>Two 'classic' mechanisms for concurrency: multiprocessing and multithreading.
<ul class="org-ul">
<li>Each mechanism supports true parallelism on a multiprocessor machine.</li>
</ul></li>
<li>Non-blocking I/O enables quick jumps from one I/O task to another, thereby supporting
concurrency without parallelism.
<ul class="org-ul">
<li>Non-blocking I/O typically is used in conjunction with  a 'classic' approach:
<ul class="org-ul">
<li>The nginx web server: multiprocessing + non-blocking I/O</li>
<li>Node.js: non-blocking I/O at the API level, multithreading under the hood.</li>
</ul></li>
</ul></li>
<li>Summary
<ul class="org-ul">
<li>Concurrency is a requirement for many modern apps, and there are various ways to enable it.</li>
<li>Parallelism boosts performance by increasing throughput: more work done in a given amount of time.
<ul class="org-ul">
<li>Concurrent tasks can be executed in parallel on a multiprocessor machine.</li>
</ul></li>
<li>Non-blocking I/O is used mostly in combination with multiprocessing or multithreading</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orge05358a" class="outline-3">
<h3 id="orge05358a">Concurrency and parallelism: working technical definitions</h3>
<div class="outline-text-3" id="text-orge05358a">
<pre class="example">
      client requests  +------------+   ## Task1: handle request1
    ------------------&gt;| web server |   ## Task2: handle request2
                       +------------+      ...
</pre>

<dl class="org-dl">
<dt>1st scenario</dt><dd><p>
a single-processor machine with time-sliced scheduling 
</p>
<ul class="org-ul">
<li>Assume each task is scheduled for a fixed-length time slice, and
then is pre-empted and rescheduled if its processing exceeds that
time slice.</li>
</ul>
<pre class="example">
               Time span (TS) = Start to Finish
Start time                                         Finish time
         |                                         |
         +-----------------------------------------+   ## each star * is one 
          \             /\         /\             /       system-clock tick
           ****Task1****  **Task2**  ****Task1****     ## Task1 (16 ticks) and Task2 
                                                         (4 ticks) share the processor
</pre>

<ul class="org-ul">
<li>Task1 and Task2 are processed concurrently during time span TS: their processing overlaps during TS.
<ul class="org-ul">
<li>Task1 and Task2 are not processed in parallel, as there's but a single processor that must be shared.</li>
</ul></li>
<li>1st scenario exhibits concurrency, but not true parallelism.</li>
</ul></dd>

<dt>2nd scenario</dt><dd><p>
a multi-processor machine (assume two for simplicity)
</p>
<pre class="example">
                 Time span 
Start time                       Finish time
         |                       |
         +-----------------------+
          \                     /
           ********Task1********      ### Executing on processor1
		   \         /
		    **Task2**         ### Executing on processor2
</pre>

<ul class="org-ul">
<li>Task1 and Task2 again are processed concurrently (during the same time span TS).</li>
<li>Task1 and Task2 also are processed in parallel for a while&#x2013;for 4
ticks (Task2's processing time).</li>
<li>The machine's throughput is improved: Task1 and Task2 both
complete within 16 time units, the time taken to process Task1,
the longer of the two.
<ul class="org-ul">
<li>1st scenario requires 20 clock ticks (each 1 time unit) to complete the two tasks.</li>
<li>2nd scenario requires 16 clock ticks to complete the two tasks, a 20% improvement.</li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgab817ae" class="outline-3">
<h3 id="orgab817ae">System call overview for concurrency, parallelism, and non-blocking I/O</h3>
<div class="outline-text-3" id="text-orgab817ae">
<ul class="org-ul">
<li><p>
The systems context: user-space and kernel-space code
</p>
<ul class="org-ul">
<li>User-space code does not control shared physical resources (processors, memory, I/O devices).
<ul class="org-ul">
<li>Ordinary applications execute in user space.</li>
</ul></li>
<li>Kernel-space code comprises the core OS routines that control shared physical resources.</li>
<li>A "system call" originates in user-space, but results in the execution of a kernel-space routine.
<ul class="org-ul">
<li>Standard library functions (user-space) mediate between ordinary
application code and the core OS routines (kernel-space) that
some library functions call.</li>
<li>The standard library goes by various names: on Unix-type
systems, libc or variants thereof (e.g., glibc on Ubuntu); on
Windows, the Windows API or variants thereof (e.g., Win32 API)</li>
</ul></li>
<li>Depiction: Node.js app calls the cluster.fork() function</li>
</ul>
<pre class="example">
                                                            system call
                                                 user space&lt;----+----&gt;kernel space
                                                                |
            calls                 calls                         | calls
Node.js app-------&gt;cluster.fork()-------&gt;library function fork()|-------&gt;kernel routine 
                                                                |     ## in Unix: fork
                                                                |     ## in Linux: clone
</pre></li>
<li>Importance of C: The standard libraries and kernel routines are
written mostly in C, with some assembly language or non-standard
C extensions covering the rest.</li>
</ul>
</div>
</div>
<div id="outline-container-org2a81d24" class="outline-3">
<h3 id="org2a81d24">Wrapup of the overview</h3>
<div class="outline-text-3" id="text-org2a81d24">
<ul class="org-ul">
<li>Concurrency and parallelism are different.
<ul class="org-ul">
<li>Concurrency involves handling multiple tasks in the same time span.</li>
<li>Parallelism involves processing multiple tasks literally at the same time.
<ul class="org-ul">
<li>True parallelism requires multiple processors.</li>
</ul></li>
<li>Parallelism is a performance-boosting way to manage concurrency.</li>
</ul></li>
<li>The classic approaches to concurrency are multiprocessing and multithreading.
<ul class="org-ul">
<li>Non-blocking I/O has emerged as an option as well, but one that's
typically used in conjunction with multiprocessing or
multithreading.</li>
<li>Non-blocking I/O sometimes is described as 'concurrency without parallelism'.</li>
</ul></li>
<li>Different languages have difference advantages when it comes to
studying concurrency, parallelism, and non-blocking I/O.
<ul class="org-ul">
<li>C is close to the metal: the system libraries and core OS routines at work under the hood.</li>
<li>Whatever the application language, multiprocessing,
multithreading, and non-blocking I/O calls in the language hit the
C libraries and, from there, kernel-space routines.</li>
<li>Java (C#), Go, Node.js and other languages have particular styles
and strengths with respect to concurrency in particular.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1e22ad0" class="outline-2">
<h2 id="org1e22ad0">Parallelität vs. Nebenläufigkeit im Detail</h2>
<div class="outline-text-2" id="text-org1e22ad0">
</div><div id="outline-container-org4b5eb8a" class="outline-3">
<h3 id="org4b5eb8a">Processes and threads</h3>
<div class="outline-text-3" id="text-org4b5eb8a">
<ul class="org-ul">
<li>A process is a 'program in execution', each with its own address space.
<ul class="org-ul">
<li>Executing a program from the command-line is an example:
<code>% hi.exe</code>  ## <code>%</code> is the command-line prompt, <code>hi.exe</code> is an executable program.</li>
<li>The address space comprises the memory locations accessible to the process.</li>
<li>Separate address spaces effectively partition memory among the processes.</li>
</ul></li>
<li>A thread is a sequence of executable instructions within a process.
<ul class="org-ul">
<li>A 1-instruction thread is trivial, and threads made up of tens of
instructions are more typical.</li>
<li>A single-threaded process has one thread, whereas a multithreaded process has multiple ones.</li>
<li>Although there are different ways to implement threads (more on this later), the
critical point is this:
<ul class="org-ul">
<li>Threads within a process share the same address space&#x2013;they have
access to exactly the same memory locations. This is the root
cause of race conditions.</li>
<li>A 'race condition' arises when two or more threads concurrently
access the same memory location and at least one of the threads
tries to update the location. For instance, each thread might be
executing the instruction:<br />
   <code>n = random_num()</code>  ## <code>n</code> is a shared memory location among the threads, random<sub>num</sub>() returns a random number<br />
   The result is unpredictable, except that the last thread to execute this 'wins'.</li>
</ul></li>
</ul></li>
<li>Scheduling on modern systems: to schedule a process on a processor is to schedule one of its threads.</li>
</ul>
<pre class="example">
  Process1    scheduled   +----------+
    Thread11-------------&gt;|processor3|
    Thread12              +----------+

  Process2
    Thread21
    Thread22  scheduled   +----------+
    Thread23-------------&gt;|processor7|
                          +----------+
</pre>
</div>
</div>
<div id="outline-container-org3d75540" class="outline-3">
<h3 id="org3d75540">Multiprocessing</h3>
<div class="outline-text-3" id="text-org3d75540">
<p>
A first look at multiprocessing: the command-line pipe operator <code>|</code>
</p>
<ul class="org-ul">
<li><p>
At the command line:
</p>
<pre class="example">
cat file.txt | sort

</pre>
<ul class="org-ul">
<li>The 'cat' (short for 'concatenate') on the left is one executing
process, and the 'sort' on the right is another executing process.</li>
<li>The 'sort' performs blocking I/O: it waits for all of the bytes
from 'cat' before doing the sorting.</li>
<li>If the machine has two processorss, 'cat' could execute on one and 'sort' on the other.</li>
<li>The unnamed pipe operator | thus performs automatic multiprocessing.
<ul class="org-ul">
<li>A pipe is thus a mechanism for inter-process communication (IPC).</li>
</ul></li>
</ul></li>
<li>Conceptual view of the pipe:</li>
</ul>
<pre class="example">
                       pipe
               +--------|-------+
    writer----&gt;|WriteEnd|ReadEnd|&lt;----reader
               +--------+-------+
</pre>
<ul class="org-ul">
<li>The tasks at hand (producing the bytes in the file and then sorting
the lines) are divided between two proceses, 'cat' and 'sort'.</li>
<li>Two general approaches in code:
<ul class="org-ul">
<li>A parent process 'forks' (clones, spawns) a child process, and both
execute code from the same program.	  
<ul class="org-ul">
<li>An if-else or the equivalent typically separates the parent code from the child code.</li>
</ul></li>
<li>A parent process forks a child, which then executes a separate program.</li>
</ul></li>
<li><p>
A final example to underscore the point:
</p>
<pre class="example">
sleep 5 | echo 'Hello, world!'  ## sleep sends no bytes to the pipe, and echo expects none

</pre>
<ul class="org-ul">
<li>Hello, world! appears on the screen, and roughly 5 seconds later the prompt returns from the sleep command.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org01b16aa" class="outline-3">
<h3 id="org01b16aa">Multithreading</h3>
<div class="outline-text-3" id="text-org01b16aa">
<p>
A first look at multithreading: the Tomcat web server, written in Java
</p>

<ul class="org-ul">
<li>Tomcat implements the 'one-thread-per-request' model for handling client requests.</li>
<li>Tomcat runs as a single process, which is multithreaded.</li>
<li>Web sites and services are deployed as JAR files (with a .war
extension) dropped into a particular directory (TOMCAT<sub>HOME</sub>/webapps)
or subdirectory thereof.
<ul class="org-ul">
<li><p>
The WAR file's name (e.g., 'site1' in 'site1.war') becomes the first part of 'resource path'
in a request URL:<br />
</p>

<p>
<a href="http://somemachine.org:8080/site1/">http://somemachine.org:8080/site1/</a>&#x2026;    ## site1 for the site1.war file<br />
<a href="http://somemachine.org:8080/site1/hi.jsp">http://somemachine.org:8080/site1/hi.jsp</a> ## a completed URL, with hi.jsp as the requested resourc
</p></li>
<li>Tomcat delegates each request for any WAR file to a thread, the 'one-thread-per-request' model
<ul class="org-ul">
<li>Code within the WAR file is thus susceptible to race conditions
because multiple request-handling threads have access to the
very same memory locations: the burden is on the programmer to
ensure proper thread coordination.</li>
</ul></li>
</ul></li>
<li>For efficiency, Tomcat creates a thread pool at start-up: indeed, two thread pools&#x2013;one for
requests over HTTP, another for requests over HTTPS if HTTPS is enabled.</li>
<li>Other Java-centric web servers, such as Jetty, implement the one-thread-per-request model as well.</li>
</ul>
</div>
</div>
<div id="outline-container-org8d9b5fd" class="outline-3">
<h3 id="org8d9b5fd">Non-blocking I/O</h3>
<div class="outline-text-3" id="text-org8d9b5fd">
<p>
A first look at non-blocking I/O non-blocking I/O: two code examples
</p>

<ul class="org-ul">
<li>A blocking 'getItem' (read) example</li>
</ul>
<div class="org-src-container">
<pre class="src src-html">&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #0000FF;">!doctype</span> html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">html</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">head</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Blocking I/O</span>&lt;/<span style="color: #006699;">title</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">script</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localStorage.name = 'Flintstone';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 1 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('Before blocking call');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 2 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var value = localStorage.getItem('name');&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 3 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('After blocking call: ' + value);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 4 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span style="color: #006699;">script</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span style="color: #006699;">head</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">body</span>/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span style="color: #006699;">html</span>&gt;</p>
</pre>
</div>
<ul class="org-ul">
<li>The second alert occurs only after the blocking call to 'getItem' (line 3) returns.</li>
</ul>
<ul class="org-ul">
<li>A non-blocking 'fetch' example in pseudo-code</li>
</ul>
<div class="org-src-container">
<pre class="src src-java">    <span style="color: #6434A3;">define</span> <span style="color: #006699;">callbackFunction</span><span style="color: #707183;">(</span>Http-response<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
       productList = extractProductListFromResponse<span style="color: #7388D6;">(</span>Http-response<span style="color: #7388D6;">)</span>
       print<span style="color: #7388D6;">(</span>productList<span style="color: #7388D6;">)</span>                            ## print is blocking
    <span style="color: #707183;">}</span>

    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Main code </span>
    url = <span style="color: #008000;">'http://some-machine.org/some-script-to-get-data'</span>
    connection = getConnectionToRemoteMachine<span style="color: #707183;">(</span>url<span style="color: #707183;">)</span>
    connection.fetch<span style="color: #707183;">(</span>callbackFunction<span style="color: #707183;">)</span>                   ## fetch<span style="color: #707183;">(</span>...<span style="color: #707183;">)</span> is non-blocking
    print<span style="color: #707183;">(</span><span style="color: #008000;">'Hello, world!'</span><span style="color: #707183;">)</span>                               ## print is blocking
    print<span style="color: #707183;">(</span><span style="color: #008000;">'Goodbye, cruel world!'</span><span style="color: #707183;">)</span>                       ## print is blocking</pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org29b4aa7" class="outline-3">
<h3 id="org29b4aa7">Zusammenfassung</h3>
<div class="outline-text-3" id="text-org29b4aa7">
<p>
Three approaches to concurrency: multiprocessing, multithreading, non-blocking I/O
</p>

<pre class="example">
     client requests  +------------+   ## Task1: handle request1
   ------------------&gt;| web server |   ## Task2: handle request2
                      +------------+      ...
</pre>

<ul class="org-ul">
<li>Multiprocessing: dispatch each task to a separate process ('program in execution')
<ul class="org-ul">
<li>For efficiency, "prefork" the processes by building a pool of these
at start-up.  Then grab a process from the pool to act as the 'task
handler'.</li>
<li>When the task-handling process finishes its work, put it to sleep.</li>
<li>Apache2, nginx, and IIS are production-grade examples.</li>
</ul></li>

<li>Multithreading: dispatch each task to a separate thread within a process.
<ul class="org-ul">
<li>Again for efficiency, build a thread-pool at start-up, and grab a
thread from the pool to act as the 'task handler'.
<ul class="org-ul">
<li>When the task-handling thread finishes its work, put it to sleep.</li>
<li>Tomcat and Jetty are production-grade examples.</li>
</ul></li>
</ul></li>
<li>Non-blocking I/O: in its pure form, a single-threaded process that
jumps quickly from one task to another, perhaps doing only partial
processing of each task.
<ul class="org-ul">
<li>For example, the non-blocking web server might read (and cache)
some bytes as part of Task1, then do the same for Task2, and so on
until all of the request bytes for a given task have been read.
<ul class="org-ul">
<li>Node.js is the obvious 'pure' example (but even Node.js takes a hybrid approach).</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org7bd47ea" class="outline-3">
<h3 id="org7bd47ea">Hybrid approaches</h3>
<div class="outline-text-3" id="text-org7bd47ea">
<ul class="org-ul">
<li>There's no hard-and-fast rule about how best to support concurrency.
<ul class="org-ul">
<li>Multiprocessing, multithreading, and non-blocking I/O can be used
in various combinations.</li>
</ul></li>
<li><p>
Sample hybrids
</p>
<ul class="org-ul">
<li>Multiprocessing + multithreading: IIS (Windows web server) and
AspNet runtime</li>
</ul>
<pre class="example">
  client side                         server side
+-------------+  HTTP requests    +-----------------+
| web browser |------------------&gt;| Web server (IIS)|
|             |&lt;------------------|                 |
+-------------+  HTTP responses   +-------+---------+
                                          |
                                    aspnet_isapi.dll    ## Links IIS process with workers
                                          |
                                          +--- aspnet_wp.exe    ## worker process 1
                                          |
                                          +--- aspnet_wp.exe    ## worker process 2
                                          ...                   ...
</pre>
<ul class="org-ul">
<li>Each worker process is multithreaded (by default, 10 threads per
worker process), and each thread handles a single request (the
'one-thread-per-request' model)</li>
</ul>
<ul class="org-ul">
<li>Multiprocessing + non-blocking I/O: nginx
<ul class="org-ul">
<li>Multiprocessing:
<ul class="org-ul">
<li>nginx has a 'master process' to read configuration files and
to watch over worker processes (e.g., start a new worker if
one happens to die unexpectedly).</li>
<li>A 'worker process' handles a client request: a given worker
may handle even thousands of requests concurrently&#x2013;given the
efficiency of non-blocking I/O.</li>
<li>Other (optional) processes (e.g., a cache loader and a cache
manager) also are in play.</li>
<li>Non-blocking I/O:
<ul class="org-ul">
<li>The workers employ non-blocking I/O in handling requests,
each of which is partitioned into a collection of
sub-requests. A completed sub-request generates an event,
which is handled in the course of assembling a full response
out of pieces.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Non-blocking I/O + multithreading (under the hood): Node.js</li>
</ul>
<pre class="example">
               Node.js server  ## a single-threaded process managing an event loop
client request  +--------+
---------------&gt;|        |     ## 'workers' are JavaScript functions that read and
     ...        | event           otherwise handle a client's request using non-blocking 
client request  | loop   |        I/O and callbacks to signal task completion
---------------&gt;|        |
                +--------+     ## Long-running tasks (e.g., accessing a DB) are delegated 
			          to under-the-hood threads, with callbacks to signal
                                  task completion
</pre></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org317e28e" class="outline-2">
<h2 id="org317e28e">Multiprocessing &#x2013; Grundlagen</h2>
<div class="outline-text-2" id="text-org317e28e">
</div><div id="outline-container-orged49fb4" class="outline-3">
<h3 id="orged49fb4">A first multiprocessing example in C</h3>
<div class="outline-text-3" id="text-orged49fb4">
</div><div id="outline-container-org9fab7a5" class="outline-4">
<h4 id="org9fab7a5">Overview</h4>
<div class="outline-text-4" id="text-org9fab7a5">
<p>
&#x2026; key points of the 'unnamed pipe example'
</p>

<ul class="org-ul">
<li><p>
When the program pipeExample.c is compiled and then executed from
the command-line, it executes as a process. Here's the command to
execute:
</p>
<pre class="example">
% ./pipeExample   ## On Windows: % pipeExample

</pre></li>
<li>The executing pipeExample is the 'parent' process.</li>
<li>The parent process calls the library function fork() to spawn a
'child' process, a clone of the parent.
<ul class="org-ul">
<li>The library function fork() makes a system call to the OS routine that spawns the child.</li>
<li>The library function fork() returns one of three values:
<dl class="org-dl">
<dt>-1</dt><dd>to signal failure (e.g., the system already has too
many processes)</dd>
<dt>0</dt><dd>to the child process</dd>
<dt>&gt; 0</dt><dd>to the parent process; in particular, the 'process id'
(pid) of the child is returned to the parent, and a pid
is always a positive integer</dd>
</dl></li>
<li>The parent and child process both execute the code that follows the call to fork().
<ul class="org-ul">
<li>fork() effectively 'clones' one process (child) from another (parent).</li>
<li><p>
An if-else or equivalent construct is used to ensure that the
parent does one thing and the child does something else.
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #6434A3;">pid_t</span> <span style="color: #BA36A5;">pid</span> = fork<span style="color: #707183;">()</span>;   <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">pid_t is a signed integer data type *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>-1 == pid<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>      <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">error: couldn't clone a new process *</span><span style="color: #8D8D84;">*/</span>
    ...                
<span style="color: #707183;">}</span>   
<span style="color: #0000FF;">else</span> <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>0 == pid<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">child code follows *</span><span style="color: #8D8D84;">*/</span>
    ...
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">else</span> <span style="color: #707183;">{</span>                <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">parent code follows *</span><span style="color: #8D8D84;">*/</span>
    ...
<span style="color: #707183;">}</span></pre>
</pre>
</div></li>
</ul></li>
<li>The parent waits for the child to exit so that the child does not
become a 'zombie'.
<ul class="org-ul">
<li>When a child terminates, the OS notifies the parent. If the
parent is already terminated, it cannot be notified&#x2013;and the
child becomes an 'zombie', dead but still around.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgbce78a1" class="outline-4">
<h4 id="orgbce78a1">using the shell&#x2026;</h4>
<div class="outline-text-4" id="text-orgbce78a1">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ ls pipeExample.c 
pipeExample.c
bash-3.2$ gcc -o pipeExample pipeExample.c 
bash-3.2$ ./pipeExample
This is the winter of our discontent
bash-3.2$ </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd3bd3fb" class="outline-4">
<h4 id="orgd3bd3fb">Source code</h4>
<div class="outline-text-4" id="text-orgd3bd3fb">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">A first multiprocessing example: pipes in C </span>
<span style="color: #8D8D84; font-style: italic;">    To compile (Unix-like system): gcc -o pipeExample pipeExample.c</span>
<span style="color: #8D8D84; font-style: italic;">    For Windows, the GNU compiler: https://gcc.gnu.org/</span>
<span style="color: #8D8D84; font-style: italic;">*</span><span style="color: #8D8D84;">*/</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/wait.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">string.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">ReadEnd</span>  0                                                  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 1 *</span><span style="color: #8D8D84;">*/</span>            
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">WriteEnd</span> 1                                                

<span style="color: #6434A3;">void</span> <span style="color: #006699;">report_and_die</span><span style="color: #707183;">(</span><span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">msg</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>                              <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 2 *</span><span style="color: #8D8D84;">*/</span>
  perror<span style="color: #7388D6;">(</span>msg<span style="color: #7388D6;">)</span>;
  exit<span style="color: #7388D6;">(</span>-1<span style="color: #7388D6;">)</span>;    <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">failure *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">pipeFDs</span><span style="color: #7388D6;">[</span>2<span style="color: #7388D6;">]</span>;                                                   <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 3 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">char</span> <span style="color: #BA36A5;">buf</span>;         <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">1-byte buffer </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">msg</span> = <span style="color: #008000;">"This is the winter of our discontent\n"</span>;

  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>pipe<span style="color: #909183;">(</span>pipeFDs<span style="color: #909183;">)</span> &lt; 0<span style="color: #7388D6;">)</span> report_and_die<span style="color: #7388D6;">(</span><span style="color: #008000;">"pipe(...)"</span><span style="color: #7388D6;">)</span>;               <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 4 *</span><span style="color: #8D8D84;">*/</span>

  <span style="color: #6434A3;">pid_t</span> <span style="color: #BA36A5;">cpid</span> = fork<span style="color: #7388D6;">()</span>;                                              <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 5 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>cpid &lt; 0<span style="color: #7388D6;">)</span> report_and_die<span style="color: #7388D6;">(</span><span style="color: #008000;">"fork()"</span><span style="color: #7388D6;">)</span>;                           <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 6 *</span><span style="color: #8D8D84;">*/</span>

  <span style="color: #8D8D84;">/*** </span><span style="color: #8D8D84; font-style: italic;">child **</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>0 == cpid<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>                                                  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 7 *</span><span style="color: #8D8D84;">*/</span>
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>WriteEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;                                       <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 8 *</span><span style="color: #8D8D84;">*/</span>
    <span style="color: #0000FF;">while</span> <span style="color: #909183;">(</span>read<span style="color: #709870;">(</span>pipeFDs<span style="color: #907373;">[</span>ReadEnd<span style="color: #907373;">]</span>, &amp;buf, 1<span style="color: #709870;">)</span> &gt; 0<span style="color: #909183;">)</span>                     <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 9 *</span><span style="color: #8D8D84;">*/</span>
      write<span style="color: #909183;">(</span>STDOUT_FILENO, &amp;buf, <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span>buf<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;                      <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">1ine 10 *</span><span style="color: #8D8D84;">*/</span>
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>ReadEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;                                        <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 11 *</span><span style="color: #8D8D84;">*/</span>
    _exit<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">signal parent of immediate exit *</span><span style="color: #8D8D84;">*/</span>                <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 12 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #7388D6;">}</span> 
  <span style="color: #8D8D84;">/*** </span><span style="color: #8D8D84; font-style: italic;">parent **</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">else</span> <span style="color: #7388D6;">{</span>                                                            <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 13 *</span><span style="color: #8D8D84;">*/</span> 
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>ReadEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;                                   
    write<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>WriteEnd<span style="color: #709870;">]</span>, msg, strlen<span style="color: #709870;">(</span>msg<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;                     <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 14 *</span><span style="color: #8D8D84;">*/</span>
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>WriteEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">generates an EOF </span><span style="color: #8D8D84;">*/</span>                <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 15 *</span><span style="color: #8D8D84;">*/</span>
    wait<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/*** </span><span style="color: #8D8D84; font-style: italic;">wait for child to exit **</span><span style="color: #8D8D84;">*/</span>                       <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 16 *</span><span style="color: #8D8D84;">*/</span>  
    exit<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">exit normally </span><span style="color: #8D8D84;">*/</span>                                    <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 17 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #7388D6;">}</span>
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org633e23d" class="outline-3">
<h3 id="org633e23d">Second Example &#x2013; Named Pipes</h3>
<div class="outline-text-3" id="text-org633e23d">
</div><div id="outline-container-orgcc027da" class="outline-4">
<h4 id="orgcc027da">Overview</h4>
<div class="outline-text-4" id="text-orgcc027da">
<p>
A second multiprocessing example in C: key points of the 'named pipe' example
</p>

<ul class="org-ul">
<li>Two separate processes, but no parent/child relationship between them.
<ul class="org-ul">
<li>The processes communicate through a 'named pipe' (aka 'FIFO').
<ul class="org-ul">
<li><p>
A named pipe is a mechanism designed to support IPC among processes on the same host.
</p>
<pre class="example">
           +------------+
writer----&gt;| named pipe |&lt;----reader
           +------------+
</pre></li>
</ul></li>
</ul></li>
<li>The system implements an FIFO as a temporary file.</li>
<li>Named pipes are quite similar in functionality to Unix Domain
Sockets, also called 'local sockets'.
<ul class="org-ul">
<li>Network sockets support communcation between processes running on
different hosts, whereas named pipes and local sockets do the same
for processes running on the same host.</li>
</ul></li>
<li><p>
The example consists of two executable programs, fifoWriter and
fifoReader, which can be executed at the command-line as follows:
</p>
<pre class="example">
% ./fifoWriter &amp;    ## for Windows: fifoWriter &amp; (&amp; puts the process in the background) 
% ./fifoReader      ## for Windows: fifoReader

</pre>
<ul class="org-ul">
<li>There are now two processes executing: fifoWriter and fifoReader</li>
<li>The fifoWriter writes randomly generated integers to the FIFO.</li>
<li>The fifoReader reads these integers from the FIFO until end-of-file.</li>
<li>In the C code, the FIFO is 'written' and 'read' as if it were a
regular disk file: the I/O API is the same.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgdb6542c" class="outline-4">
<h4 id="orgdb6542c">using the shell</h4>
<div class="outline-text-4" id="text-orgdb6542c">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ ./fifoWriter &amp;
<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> 7316
bash-3.2$ ./fifoReader
60749779
966803328
1202260494
...
<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span>+  Done                    ./fifoWriter
bash-3.2$ </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org1c21d24" class="outline-4">
<h4 id="org1c21d24">Source Code <code>fifoWriter.c</code></h4>
<div class="outline-text-4" id="text-org1c21d24">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">fcntl.h</span><span style="color: #707183;">&gt;</span> 
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">time.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/stat.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/types.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">MaxWrites</span> 256  

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  srand<span style="color: #7388D6;">(</span>time<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">seed the random number generator </span><span style="color: #8D8D84;">*/</span>

  <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">fifoName</span> = <span style="color: #008000;">"./myPipe1"</span>;          
  mkfifo<span style="color: #7388D6;">(</span>fifoName, 0666<span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">read/write for user/group/others </span><span style="color: #8D8D84;">*/</span>             <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 1 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">fd</span> = open<span style="color: #7388D6;">(</span>fifoName, O_CREAT | O_WRONLY<span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">open blocks on a FIFO </span><span style="color: #8D8D84;">*/</span>   <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 2 *</span><span style="color: #8D8D84;">*/</span>

  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; MaxWrites; i++<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span> 
    <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">n</span> = rand<span style="color: #909183;">()</span>;             
    write<span style="color: #909183;">(</span>fd, &amp;n, <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span><span style="color: #6434A3;">int</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">4 bytes per int </span><span style="color: #8D8D84;">*/</span>                       <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 3 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #7388D6;">}</span>
  close<span style="color: #7388D6;">(</span>fd<span style="color: #7388D6;">)</span>;         <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">close the fifo </span><span style="color: #8D8D84;">*/</span>                                    <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 4 *</span><span style="color: #8D8D84;">*/</span>
  unlink<span style="color: #7388D6;">(</span>fifoName<span style="color: #7388D6;">)</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">dispose of underlying file </span><span style="color: #8D8D84;">*/</span>                        <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 5 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6119aaf" class="outline-4">
<h4 id="org6119aaf">Source Code <code>fifoReader.c</code></h4>
<div class="outline-text-4" id="text-org6119aaf">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">fcntl.h</span><span style="color: #707183;">&gt;</span> 
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">time.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/stat.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/types.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">fifoName</span> = <span style="color: #008000;">"./myPipe1"</span>;
    <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">num</span>;
    <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">fd</span> = open<span style="color: #7388D6;">(</span>fifoName, O_RDONLY<span style="color: #7388D6;">)</span>;              <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 1 *</span><span style="color: #8D8D84;">*/</span>

    <span style="color: #0000FF;">while</span> <span style="color: #7388D6;">(</span>read<span style="color: #909183;">(</span>fd, &amp;num, <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span>num<span style="color: #709870;">)</span><span style="color: #909183;">)</span> &gt; 0<span style="color: #7388D6;">)</span>         <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 2 *</span><span style="color: #8D8D84;">*/</span> 
      printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%i\n"</span>, num<span style="color: #7388D6;">)</span>;
    close<span style="color: #7388D6;">(</span>fd<span style="color: #7388D6;">)</span>;                                      <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 3 *</span><span style="color: #8D8D84;">*/</span>
    unlink<span style="color: #7388D6;">(</span>fifoName<span style="color: #7388D6;">)</span>;                               <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 4 *</span><span style="color: #8D8D84;">*/</span>
    <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge397734" class="outline-3">
<h3 id="orge397734">The Nginx Web Server</h3>
<div class="outline-text-3" id="text-orge397734">
<p>
Multiprocessing in production-grade software: the nginx web server
</p>

<ul class="org-ul">
<li>www.nginx.com
<ul class="org-ul">
<li>The web server is written in C.</li>
<li>nginx combines multiprocessing and non-blocking I/O as concurrency mechanisms.</li>
</ul></li>

<li>nginx, like any modern web server that relies on multiprocessing for concurrency,
is a "pre-forking" server.
<ul class="org-ul">
<li>nginx can be started as a 'system service' (at boot time), and is platform-neutral.</li>
</ul></li>

<li><p>
<code>nginx.conf</code>  ()configuration entries are key/value pairs: no XML!)
</p>
<pre class="example">
user www-data;           ## www-data (name is arbitrary) is owner of workers
worker_processes 4;      ## default number of workers, might be set to processor count
pid /var/run/nginx.pid;  ## file /var/run/nginx.pid stores pid of master process

events {
   worker_connections 1024;  ## Max of 1024 connections per worker 
   ...                       ## (typical browsers open at least two connections to a 
                                site per client session)
    }   
</pre></li>

<li><p>
<code>ps -ef | grep nginx</code>
</p>
<pre class="example">
Owner     pid   ppid   nginx process type

root      1803     1   master process /usr/sbin/nginx  ## command that started nginx
www-data  1804  1803   worker process
www-data  1805  1803   worker process
www-data  1807  1803   worker process
www-data  1808  1803   worker process
</pre></li>
</ul>
</div>
</div>
<div id="outline-container-orgdd3f605" class="outline-3">
<h3 id="orgdd3f605">Execing and Forking Options in Multiprocessing</h3>
<div class="outline-text-3" id="text-orgdd3f605">
<p>
A second way for one executing program to start another
</p>

<ul class="org-ul">
<li><p>
Review of the previously way, introduction of the new way:
</p>
<pre class="example">
        fork()
parent----------&gt;child        ## Both parent and child continue to execute...

         exec...()
process1-----------&gt;process2  ## process2 replaces process1, which terminates
</pre></li>
<li>In systems speak, an 'image' is an executable program. For instance,
copying the system from one machine to another is called
're-imaging'.
<ul class="org-ul">
<li>In the multiprocessing 'pipeExample' code, the image is the
compiled, executable program named 'pipeExample'</li>
</ul></li>
<li>A new process can be 'spawned' (created) under one of two distinct
scenarios, which the difference between the fork() function and the
exec-family of functions illustrates.
<ul class="org-ul">
<li>The exec-family consists of library functions that, under the
hood, make the same system call.</li>
</ul></li>
<li><p>
In a successful call to fork(), the new child process executes the
'same' image as the parent that spawned it: the forked process is a
clone. So the standard code idiom is this:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #6434A3;">pid_t</span> <span style="color: #BA36A5;">pid</span> = fork<span style="color: #707183;">()</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">parent executes this </span><span style="color: #8D8D84;">*/</span>
...                  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">check for success </span><span style="color: #8D8D84;">*/</span>
<span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>0 == pid<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>      <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">0 returned to the child </span><span style="color: #8D8D84;">*/</span>
   ...               <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">child code </span><span style="color: #8D8D84;">*/</span>
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">else</span> <span style="color: #707183;">{</span>               <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">parent code: fork returns child's pid to parent </span><span style="color: #8D8D84;">*/</span>
   ...               <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">alternative parent test: if (pid &gt; 0)</span>
<span style="color: #8D8D84; font-style: italic;">}</span></pre>
</pre>
</div></li>
<li><p>
In a successful call to an exec-function, replaces the current process image with
a new image that's loaded into memory.
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">flag</span> = execl<span style="color: #707183;">(</span><span style="color: #008000;">"/usr/bin/myGame"</span>, <span style="color: #008000;">"myGame"</span>, 0<span style="color: #707183;">)</span>;
<span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>-1 == flag<span style="color: #707183;">)</span> perror<span style="color: #707183;">(</span><span style="color: #008000;">"Couldn't exec..."</span><span style="color: #707183;">)</span>;
<span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">on success, the 'myGame' program now executes </span><span style="color: #8D8D84;">*/</span></pre>
</pre>
</div>
<ul class="org-ul">
<li>The new image has its own address space and other features. In
summary, the old process stops execution and a new one begins
execution.</li>
<li>The new process retains the pid (and ppid) of the one it replaces
<ul class="org-ul">
<li>The user and group properties are likewise unchanged.</li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="outline-container-org50ddabb" class="outline-4">
<h4 id="org50ddabb">Using the Shell</h4>
<div class="outline-text-4" id="text-org50ddabb">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ ./fileStatus tmp
File name: tmp

Information about file tmp:

Owner ID:    503
Group ID:    20
Byte size:   68
Last access: Fri Oct  6 11:10:23 2017
File type:   directory
Owner read:  Owner readable
Owner write: Owner writable

bash-3.2$ ./fileStatus fileStatus
File name: fileStatus

Information about file fileStatus:

Owner ID:    503
Group ID:    20
Byte size:   8808
Last access: Fri Oct  6 11:12:05 2017
File type:   regular
Owner read:  Owner readable
Owner write: Owner writable

bash-3.2$ ./execing
File name: tmp

Information about file tmp:

Owner ID:    503
Group ID:    20
Byte size:   68
Last access: Fri Oct  6 11:10:23 2017
File type:   directory
Owner read:  Owner readable
Owner write: Owner writable</pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf939800" class="outline-4">
<h4 id="orgf939800">Source Code</h4>
<div class="outline-text-4" id="text-orgf939800">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">To run: </span>

<span style="color: #8D8D84; font-style: italic;">   -- compile this program (gcc -o execing execing.c) and fileStatus.c </span>
<span style="color: #8D8D84; font-style: italic;">   --                      (gcc -o fileStatus fileStatus.c)</span>
<span style="color: #8D8D84; font-style: italic;">   -- create a subdirectory named tmp: mkdir tmp</span>
<span style="color: #8D8D84; font-style: italic;">   -- from the command line: ./execing</span>

<span style="color: #8D8D84; font-style: italic;">   This program 'execs' the fileStatus program, which outputs metadata about the tmp dir..</span>
<span style="color: #8D8D84; font-style: italic;">   Here's a depiction:</span>

<span style="color: #8D8D84; font-style: italic;">                   execv</span>
<span style="color: #8D8D84; font-style: italic;">   execing program-------&gt;fileStatus program</span>
<span style="color: #8D8D84;">*/</span>

<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">char</span>* <span style="color: #0000FF;">const</span> <span style="color: #BA36A5;">args</span><span style="color: #7388D6;">[]</span> = <span style="color: #7388D6;">{</span><span style="color: #008000;">"./fileStatus"</span>, <span style="color: #008000;">"tmp"</span>, 0<span style="color: #7388D6;">}</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">fileStatus program, tmp directory </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">ret</span> = execv<span style="color: #7388D6;">(</span><span style="color: #008000;">"./fileStatus"</span>, args<span style="color: #7388D6;">)</span>;            <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">"v" for "vector" </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>-1 == ret<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>                                  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">check for failure </span><span style="color: #8D8D84;">*/</span>
    perror<span style="color: #909183;">(</span><span style="color: #008000;">"execv(...) error"</span><span style="color: #909183;">)</span>;
    exit<span style="color: #909183;">(</span>-1<span style="color: #909183;">)</span>;
  <span style="color: #7388D6;">}</span>
  <span style="color: #0000FF;">else</span> 
    printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"I'm here\n"</span><span style="color: #7388D6;">)</span>;                           <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">never executes </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span>
</pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9bae681" class="outline-3">
<h3 id="org9bae681">Process Tracking and Management</h3>
<div class="outline-text-3" id="text-org9bae681">
<p>
Process tracking and context switching
</p>

<ul class="org-ul">
<li>Each process has a unique ID (pid), a non-negative integer.
<ul class="org-ul">
<li>A process's pid is recorded in the system's process table.</li>
<li>Library functions getpid() and getppid() get the pid and the
parent's pid, respectively.</li>
<li>The pid of 0 is typically reserved for the 'idle process', the one
that 'runs' when there's nothing else to run.</li>
<li>The 'init process' has a pid of 1: the first user-space process
that the OS kernel spawns in the boot-up.
<ul class="org-ul">
<li>On shutdown, the init process is the last process to terminate:
it waits for all of its children.</li>
<li>The init process starts other processes: system services such as
the login service, etc.</li>
</ul></li>
</ul></li>
<li>Key data structures in a process 'context':
<ul class="org-ul">
<li>process table: tracks information per process, in particular
information that allows a pre-empted process to restart later.</li>
<li>page table(s): translate virtual into physical addresses. Each
process has its own, which effectively partitions virtual address
spaces among processes.</li>
<li>file table: tracks, per process, files that a process has opened.</li>
</ul></li>
<li>Every process has a user and group 'owner', which determines the
process's access rights to resources.
<ul class="org-ul">
<li>Every process likewise belongs to a 'process group', which
facilitates sending signals to every process in a group, to
getting information about related processes, and so on.</li>
<li>In the default case, a child process belongs to the same as its
parent.</li>
</ul></li>
<li>Most modern systems use pre-emptive scheduling, with either
fixed-length or variable-length time-slices: a process that exceeds
the time-slice on a given run is pre-empted and sent back to a
scheduling queue.
<ul class="org-ul">
<li>A process and a thread 'context' consists of key information about
it.
<ul class="org-ul">
<li>For a process, key data structures such as the process table,
the file table, and its page tables define the 'context'.</li>
</ul></li>
</ul></li>
<li>Context switches, which occur during pre-emption, come in two
flavors:
<ul class="org-ul">
<li>From one thread to another within the same process: 'intraprocess
switching'</li>
<li>From one process to another: 'interprocess switching'
<ul class="org-ul">
<li>The big cost is the swapping out of one (virtual) address space
for another: page tables</li>
</ul></li>
<li>A process-level context switch is signficantly more expensive than
a thread-level context switch.
<ul class="org-ul">
<li>The cost of thread-level switching is near zero on modern systems.</li>
<li><p>
Depiction:
</p>
<pre class="example">
Process1      Process2        processor7
  Thread11      Thread21
  Thread12

1st scenario: Thread12 replaces Thread11 on processor7  + virtually no overhead

2nd scenario: Thread21 replaces Thread11 on processor7  + high overhead--process context switch
</pre></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5f5589b" class="outline-2">
<h2 id="org5f5589b">weitere verwendete Literatur</h2>
<div class="outline-text-2" id="text-org5f5589b">
<ul class="org-ul">
<li><a class='org-ref-reference' href="#CACM2017">CACM2017</a></li>
<li><a class='org-ref-reference' href="#CACM2016">CACM2016</a></li>
<li><a class='org-ref-reference' href="#Subramanian2017">Subramanian2017</a></li>
</ul>
</div>
</div>
<div id="outline-container-org13e030a" class="outline-2">
<h2 id="org13e030a"><h2>Literaturverzeichnis</h2>
<ul class='org-ref-bib'><li><a id="Bengel2015">[Bengel2015] Günther Bengel, Christian Baun, Marcel Kunze & Karl-Uwe Stucky, Masterkurs Parallele und Verteilte Systeme, Springer Fachmedien Wiesbaden (2015).</a></li>
<li><a id="Flynn1972">[Flynn1972] Flynn, Some Computer Organizations and Their Effectiveness, <i>IEEE Trans. Comput.</i>, <b>21(9)</b>, 948-960 (1972). <a href="http://dx.doi.org/10.1109/TC.1972.5009071">link</a>. <a href="http://dx.doi.org/10.1109/TC.1972.5009071">doi</a>.</a></li>
<li><a id="CACM2017">[CACM2017] Practical Parallelism, (2017), zuletzt aufgerufen am 26.09.2017: <a href="https://cacm.acm.org/careers/219104-practical-parallelism/fulltext">https://cacm.acm.org/careers/219104-practical-parallelism/fulltext</a> </a></li>
<li><a id="CACM2016">[CACM2016] Parallel Programming Made Easy, (2017), zuletzt aufgerufen am 26.09.2017: <a href="https://cacm.acm.org/careers/203794-parallel-programming-made-easy/fulltext">https://cacm.acm.org/careers/203794-parallel-programming-made-easy/fulltext</a> </a></li>
<li><a id="Subramanian2017">[Subramanian2017] Subramanian, Jeffrey, Abeydeera, Lee, Ying, Emer & Sanchez, Fractal: An Execution Model for Fine-Grain Nested Speculative Parallelism, 587-599, in in: Proceedings of the 44th Annual International Symposium on Computer Architecture, edited by ACM (2017)</a></li>
</ul></h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Johannes Brauer</p>
<p class="date">Created: 2017-10-06 Fri 11:36</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>