<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de">
<head>
<!-- 2017-10-10 Tue 12:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parallelprogrammierung &#x2013; Grundlagen</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Johannes Brauer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<link rel="stylesheet" type="text/css" href="mycss/mystyle.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Parallelprogrammierung &#x2013; Grundlagen</h1>

<div id="outline-container-org80bda55" class="outline-2">
<h2 id="org80bda55">Ein wenig Geschichte &#x2026;</h2>
<div class="outline-text-2" id="text-org80bda55">
</div><div id="outline-container-org5982bbb" class="outline-3">
<h3 id="org5982bbb">&#x2026; der Rechensysteme</h3>
<div class="outline-text-3" id="text-org5982bbb">
<p>
(vgl. <a class='org-ref-reference' href="#Bengel2015">Bengel2015</a>)
</p>
<dl class="org-dl">
<dt>1970 &#x2013; Stapelverarbeitung</dt><dd><ul class="org-ul">
<li>Einlesen von Aufträgen (jobs) und Bearbeitung durch die Maschine</li>
<li>Job-Scheduler bestimmt die Abarbeitungsreihenfolge</li>
<li><i>non-blocking IO</i> kommt zum Einsatz (Nebenläufigkeit)</li>
</ul></dd>
<dt>1975 &#x2013; Timesharing-Systeme</dt><dd><ul class="org-ul">
<li>interaktives Arbeiten mittels Kommandozeilen-Befehlen</li>
<li>Mehrbenutzerbetrieb</li>
<li>Zuteilung von Zeitscheiben</li>
</ul></dd>
<dt>1980 &#x2013; Personal Computer und Workstation</dt><dd><ul class="org-ul">
<li>hohe Rechenleistung am Arbeitsplatz</li>
<li>Rückkehr zum Einbenutzerbetrieb</li>
<li>Kommandozeile + graphische Benutzungsoberflächen</li>
<li>Insellösungen &#x2013; kein Zugriff auf gemeinsame Betriebsmittel</li>
<li>Notlösung: peer-to-peer-Netze</li>
</ul></dd>
<dt>1985 &#x2013; Client-Server-Systeme</dt><dd><ul class="org-ul">
<li>Zentralisierung bestimmter Dienste auf dedizierten Rechnern (server)</li>
<li>neue Betriebssystemkonzepte für Netzwerknutzung erforderlich</li>
</ul></dd>
<dt>1990 &#x2013; Cluster-Systeme</dt><dd><ul class="org-ul">
<li>auch <i>Verteilte Systeme</i></li>
<li>mehrere Rechner bzw. Multiprozessorsysteme teilen sich die Dienstserbringung</li>
<li>zur Erhöhung von Leistung und Ausfallsicherheit</li>
<li>Load Balancing Cluster / Serverfarmen</li>
<li>High Performance Computing (HPC) Cluster
<ul class="org-ul">
<li>Geschwindigkeitssteigerung durch Parallelisierung von Aufgaben</li>
<li>bei Ausfall eines Systems übernimmt ein anderes Cluster-Mitglied
dessen Aufgaben</li>
</ul></li>
</ul></dd>
<dt>1995 &#x2013; Peer-to-Peer-Systeme</dt><dd><ul class="org-ul">
<li>jede Maschine kann Client und Server sein</li>
<li>höhere Ausfallsicherheit</li>
</ul></dd>
<dt>2005 &#x2013; Cloud-Systeme oder Cloud-Computing</dt><dd><ul class="org-ul">
<li>Rezentralisierung der Rechenleistung durch Virtualisierung</li>
<li>Zugriff auf Ressourcen über Internet oder Intranet</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgc930a2f" class="outline-3">
<h3 id="orgc930a2f">&#x2026; der Technologie</h3>
<div class="outline-text-3" id="text-orgc930a2f">
<p>
&#x2026; der Prozessoren und Speicherchips
</p>
<ul class="org-ul">
<li>Mooresches Gesetz von 1965: Verdoppelung der Anzahl der Transistoren
auf einem Chip ca. alle 18 Monate &#x2013; gilt noch heute</li>
<li>Entwicklung der Mikroprozessoren am Beispiel von Intel
<ul class="org-ul">
<li>1971: Intel 4004, Transistoren: 2300, Taktrate: 108 kHz</li>
<li>1999: Pentium III, Transistoren: 9.500.000, Taktrate: bis 1 GHz</li>
<li>2000 bis 2008: Pentium 4, Transistoren: 42.000.000, Taktrate: bis
3,8 GHz</li>
</ul></li>
<li>Speicherkapazität pro Chip
<ul class="org-ul">
<li>1970: 1 Kilobit</li>
<li>heute: 1 Gigabit</li>
</ul></li>
<li>Preisverfall bei MIPS und Kosten pro Bit</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2f39c46" class="outline-2">
<h2 id="org2f39c46">Rechnerarchitekturen für parallele und verteilte Systeme</h2>
<div class="outline-text-2" id="text-org2f39c46">
<p>
(vgl.  <a class='org-ref-reference' href="#Bengel2015">Bengel2015</a>, <a class='org-ref-reference' href="#Kalin2015">Kalin2015</a>)
</p>
</div>
<div id="outline-container-org1ec2fbe" class="outline-3">
<h3 id="org1ec2fbe">Taxonomie von parallelen Rechnerarchitekturen nach Flynn</h3>
<div class="outline-text-3" id="text-org1ec2fbe">
<p>
(vgl. <a class='org-ref-reference' href="#Flynn1972">Flynn1972</a>)
</p>
<ul class="org-ul">
<li>Anmerkungen:
<ul class="org-ul">
<li>Die Taxonomie sagt nichts darüber aus, ob die Architektur ein
einzelnes oder ein verteiltes System beschreibt.</li>
<li>TDie Taxonomie ist schon recht alt, wird aber als Referenz nach
wie vor benutzt.</li>
</ul></li>
<li>Abkürzungen:<br />
D = Daten<br />
I = Befehle (Instruktionen)<br />
P = Prozessor<br />
S steht für <i>single</i>, M für <i>multiple</i>.
<ul class="org-ul">
<li>Parallelität im Sinne dieser Taxonomie erfordert immer mehrere
Prozessoren (P).</li>
</ul></li>
</ul>
<dl class="org-dl">
<dt>SISD: single instruction, single data</dt><dd><ul class="org-ul">
<li>keine Form von Parallelität</li>
</ul></dd>
</dl>
<pre class="example">
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |                 
   +----------+    +---+    +----------+
</pre>
<dl class="org-dl">
<dt>SIMD: single instruction, multiple data</dt><dd><ul class="org-ul">
<li>Unterstützung in verschiedenen Programmiersprachen</li>
<li>heutzutage besonders relevant</li>
</ul></dd>
</dl>
<pre class="example">
   +----------+    +---+
   | D source |---&gt;| P |&lt;---+
   +----------+    +---+    |
   +----------+    +---+    |  +----------+
   | D source |---&gt;| P |&lt;---+--| I source |               
   +----------+    +---+    |  +----------+
   +----------+    +---+    |
   | D source |---&gt;| P |&lt;---+
   +----------+    +---+
</pre>
<dl class="org-dl">
<dt>MISD: multiple instruction, single data</dt><dd><ul class="org-ul">
<li>kaum praktische Bedeutung</li>
</ul></dd>
</dl>
<pre class="example">
                      +---+    +----------+
                 +---&gt;| P |&lt;---| I source |
                 |    +---+    +----------+
   +----------+  |    +---+    +----------+
   | D source |--+---&gt;| P |&lt;---| I source |               
   +----------+  |    +---+    +----------+ 
                 |    +---+    +----------+
                 +---&gt;| P |&lt;---| I source | 
                      +---+    +----------+
</pre>
<dl class="org-dl">
<dt>MIMD: multiple instruction, multiple data</dt><dd><ul class="org-ul">
<li>am ehesten in verteilten Systemen anzutreffen</li>
</ul></dd>
</dl>
<pre class="example">
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |
   +----------+    +---+    +----------+
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |                  
   +----------+    +---+    +----------+
   +----------+    +---+    +----------+
   | D source |---&gt;| P |&lt;---| I source |
   +----------+    +---+    +----------+
</pre>
</div>
</div>

<div id="outline-container-org483e8ed" class="outline-3">
<h3 id="org483e8ed">Ausprägungen</h3>
<div class="outline-text-3" id="text-org483e8ed">
</div><div id="outline-container-org2325de6" class="outline-4">
<h4 id="org2325de6">Eng gekoppelte Multiprozessoren und Multicore-Prozessoren</h4>
<div class="outline-text-4" id="text-org2325de6">
<ul class="org-ul">
<li>mehrere Prozesse können <i>echt</i> parallel ablaufen (auf
Einprozessorsystemen hingegen nur Quasi-Parallelität)</li>
<li>gemeinsamer Hauptspeicher</li>
</ul>
</div>
</div>
<div id="outline-container-orgac03725" class="outline-4">
<h4 id="orgac03725">Vektorrechner</h4>
<div class="outline-text-4" id="text-orgac03725">
<ul class="org-ul">
<li>Ausführung einer Berechnung gleichzeitig auf vielen Daten</li>
<li>Anordnung der Daten als Vektor bzw. Matrix</li>
<li>Beispiel für SIMD-Architektur</li>
<li>High-Performance-Computing</li>
<li>bekannt geworden ursprünglich durch Cray-Supercomputer (seit 1978)</li>
<li>genutzt z. B. für Simulationen (Meteorologie)</li>
</ul>
</div>
</div>
<div id="outline-container-org9abdabb" class="outline-4">
<h4 id="org9abdabb">General Purpose Computation on Graphic Processing Unit (GPGPU)</h4>
<div class="outline-text-4" id="text-org9abdabb">
<ul class="org-ul">
<li>ursprünglich bestehend aus beschränkt programmierbaren
Spezialprozessoren für Fließkommaoperationen</li>
<li>inzwischen frei programmierbare Prozessoren (tausende von Kernen),
dadurch</li>
<li>nutzbar nicht nur für Grafikanwendungen</li>
<li>Verwendbarkeit in höheren Programmiersprachen durch spezielle
Bibliotheken wie z. B. CUDA von Nvidia</li>
<li>Beispiel für SIMD-Architektur</li>
</ul>
</div>
</div>
<div id="outline-container-orgc9632ed" class="outline-4">
<h4 id="orgc9632ed">Lose gekoppelte Multiprozessoren</h4>
<div class="outline-text-4" id="text-orgc9632ed">
<ul class="org-ul">
<li>kein gemeinsamer Speicher</li>
<li>Synchronisation und Kommunikation durch Nachrichtenaustausch</li>
<li>Ziele: Erhöhung der Leistung, Erhöhung der Verfügbarkeit</li>
<li>MIMD möglich</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbd677ab" class="outline-2">
<h2 id="orgbd677ab">Parallelität vs. Nebenläufigkeit &#x2013; Überblick</h2>
<div class="outline-text-2" id="text-orgbd677ab">
</div>
<div id="outline-container-org3615c83" class="outline-3">
<h3 id="org3615c83">Concurrency, parallelism, and non-blocking I/O: an overview</h3>
<div class="outline-text-3" id="text-org3615c83">
<ul class="org-ul">
<li>For now, concurrency is "handling many tasks during the same time span":
<ul class="org-ul">
<li>Any app with a GUI (e.g., a game) needs to manage the GUI and perform the underlying logic.</li>
<li>A typical network app queues up requests, which then need to be handled concurrently.</li>
</ul></li>
<li>For now, (true) parallelism is "processing many tasks literally at the same time."
<ul class="org-ul">
<li>The tasks in a concurrent app would be farmed out to separate processors for true parallelism.</li>
<li>True parallelism requires multiple processors.
<ul class="org-ul">
<li>Multiprocessor machines now are available at consumer prices.</li>
</ul></li>
</ul></li>
<li>Two 'classic' mechanisms for concurrency: multiprocessing and multithreading.
<ul class="org-ul">
<li>Each mechanism supports true parallelism on a multiprocessor machine.</li>
</ul></li>
<li>Non-blocking I/O enables quick jumps from one I/O task to another, thereby supporting
concurrency without parallelism.
<ul class="org-ul">
<li>Non-blocking I/O typically is used in conjunction with  a 'classic' approach:
<ul class="org-ul">
<li>The nginx web server: multiprocessing + non-blocking I/O</li>
<li>Node.js: non-blocking I/O at the API level, multithreading under the hood.</li>
</ul></li>
</ul></li>
<li>Summary
<ul class="org-ul">
<li>Concurrency is a requirement for many modern apps, and there are various ways to enable it.</li>
<li>Parallelism boosts performance by increasing throughput: more work done in a given amount of time.
<ul class="org-ul">
<li>Concurrent tasks can be executed in parallel on a multiprocessor machine.</li>
</ul></li>
<li>Non-blocking I/O is used mostly in combination with multiprocessing or multithreading</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org8e6a391" class="outline-3">
<h3 id="org8e6a391">Concurrency and parallelism: working technical definitions</h3>
<div class="outline-text-3" id="text-org8e6a391">
<pre class="example">
      client requests  +------------+   ## Task1: handle request1
    ------------------&gt;| web server |   ## Task2: handle request2
                       +------------+      ...
</pre>

<dl class="org-dl">
<dt>1st scenario</dt><dd><p>
a single-processor machine with time-sliced scheduling 
</p>
<ul class="org-ul">
<li>Assume each task is scheduled for a fixed-length time slice, and
then is pre-empted and rescheduled if its processing exceeds that
time slice.</li>
</ul>
<pre class="example">
               Time span (TS) = Start to Finish
Start time                                         Finish time
         |                                         |
         +-----------------------------------------+   ## each star * is one 
          \             /\         /\             /       system-clock tick
           ****Task1****  **Task2**  ****Task1****     ## Task1 (16 ticks) and Task2 
                                                         (4 ticks) share the processor
</pre>

<ul class="org-ul">
<li>Task1 and Task2 are processed concurrently during time span TS: their processing overlaps during TS.
<ul class="org-ul">
<li>Task1 and Task2 are not processed in parallel, as there's but a single processor that must be shared.</li>
</ul></li>
<li>1st scenario exhibits concurrency, but not true parallelism.</li>
</ul></dd>

<dt>2nd scenario</dt><dd><p>
a multi-processor machine (assume two for simplicity)
</p>
<pre class="example">
                 Time span 
Start time                       Finish time
         |                       |
         +-----------------------+
          \                     /
           ********Task1********      ### Executing on processor1
		   \         /
		    **Task2**         ### Executing on processor2
</pre>

<ul class="org-ul">
<li>Task1 and Task2 again are processed concurrently (during the same time span TS).</li>
<li>Task1 and Task2 also are processed in parallel for a while&#x2013;for 4
ticks (Task2's processing time).</li>
<li>The machine's throughput is improved: Task1 and Task2 both
complete within 16 time units, the time taken to process Task1,
the longer of the two.
<ul class="org-ul">
<li>1st scenario requires 20 clock ticks (each 1 time unit) to complete the two tasks.</li>
<li>2nd scenario requires 16 clock ticks to complete the two tasks, a 20% improvement.</li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-org25ec746" class="outline-3">
<h3 id="org25ec746">System call overview for concurrency, parallelism, and non-blocking I/O</h3>
<div class="outline-text-3" id="text-org25ec746">
<ul class="org-ul">
<li><p>
The systems context: user-space and kernel-space code
</p>
<ul class="org-ul">
<li>User-space code does not control shared physical resources (processors, memory, I/O devices).
<ul class="org-ul">
<li>Ordinary applications execute in user space.</li>
</ul></li>
<li>Kernel-space code comprises the core OS routines that control shared physical resources.</li>
<li>A "system call" originates in user-space, but results in the execution of a kernel-space routine.
<ul class="org-ul">
<li>Standard library functions (user-space) mediate between ordinary
application code and the core OS routines (kernel-space) that
some library functions call.</li>
<li>The standard library goes by various names: on Unix-type
systems, libc or variants thereof (e.g., glibc on Ubuntu); on
Windows, the Windows API or variants thereof (e.g., Win32 API)</li>
</ul></li>
<li>Depiction: Node.js app calls the cluster.fork() function</li>
</ul>
<pre class="example">
                                                            system call
                                                 user space&lt;----+----&gt;kernel space
                                                                |
            calls                 calls                         | calls
Node.js app-------&gt;cluster.fork()-------&gt;library function fork()|-------&gt;kernel routine 
                                                                |     ## in Unix: fork
                                                                |     ## in Linux: clone
</pre></li>
<li>Importance of C: The standard libraries and kernel routines are
written mostly in C, with some assembly language or non-standard
C extensions covering the rest.</li>
</ul>
</div>
</div>
<div id="outline-container-org6b97a9a" class="outline-3">
<h3 id="org6b97a9a">Wrapup of the overview</h3>
<div class="outline-text-3" id="text-org6b97a9a">
<ul class="org-ul">
<li>Concurrency and parallelism are different.
<ul class="org-ul">
<li>Concurrency involves handling multiple tasks in the same time span.</li>
<li>Parallelism involves processing multiple tasks literally at the same time.
<ul class="org-ul">
<li>True parallelism requires multiple processors.</li>
</ul></li>
<li>Parallelism is a performance-boosting way to manage concurrency.</li>
</ul></li>
<li>The classic approaches to concurrency are multiprocessing and multithreading.
<ul class="org-ul">
<li>Non-blocking I/O has emerged as an option as well, but one that's
typically used in conjunction with multiprocessing or
multithreading.</li>
<li>Non-blocking I/O sometimes is described as 'concurrency without parallelism'.</li>
</ul></li>
<li>Different languages have difference advantages when it comes to
studying concurrency, parallelism, and non-blocking I/O.
<ul class="org-ul">
<li>C is close to the metal: the system libraries and core OS routines at work under the hood.</li>
<li>Whatever the application language, multiprocessing,
multithreading, and non-blocking I/O calls in the language hit the
C libraries and, from there, kernel-space routines.</li>
<li>Java (C#), Go, Node.js and other languages have particular styles
and strengths with respect to concurrency in particular.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgde48bb9" class="outline-2">
<h2 id="orgde48bb9">Parallelität vs. Nebenläufigkeit im Detail</h2>
<div class="outline-text-2" id="text-orgde48bb9">
</div><div id="outline-container-org868b534" class="outline-3">
<h3 id="org868b534">Processes and threads</h3>
<div class="outline-text-3" id="text-org868b534">
<ul class="org-ul">
<li>A process is a 'program in execution', each with its own address space.
<ul class="org-ul">
<li>Executing a program from the command-line is an example:
<code>% hi.exe</code>  ## <code>%</code> is the command-line prompt, <code>hi.exe</code> is an executable program.</li>
<li>The address space comprises the memory locations accessible to the process.</li>
<li>Separate address spaces effectively partition memory among the processes.</li>
</ul></li>
<li>A thread is a sequence of executable instructions within a process.
<ul class="org-ul">
<li>A 1-instruction thread is trivial, and threads made up of tens of
instructions are more typical.</li>
<li>A single-threaded process has one thread, whereas a multithreaded process has multiple ones.</li>
<li>Although there are different ways to implement threads (more on this later), the
critical point is this:
<ul class="org-ul">
<li>Threads within a process share the same address space&#x2013;they have
access to exactly the same memory locations. This is the root
cause of race conditions.</li>
<li>A 'race condition' arises when two or more threads concurrently
access the same memory location and at least one of the threads
tries to update the location. For instance, each thread might be
executing the instruction:<br />
   <code>n = random_num()</code>  ## <code>n</code> is a shared memory location among the threads, random<sub>num</sub>() returns a random number<br />
   The result is unpredictable, except that the last thread to execute this 'wins'.</li>
</ul></li>
</ul></li>
<li>Scheduling on modern systems: to schedule a process on a processor is to schedule one of its threads.</li>
</ul>
<pre class="example">
  Process1    scheduled   +----------+
    Thread11-------------&gt;|processor3|
    Thread12              +----------+

  Process2
    Thread21
    Thread22  scheduled   +----------+
    Thread23-------------&gt;|processor7|
                          +----------+
</pre>
</div>
</div>
<div id="outline-container-orga8e50c4" class="outline-3">
<h3 id="orga8e50c4">Multiprocessing</h3>
<div class="outline-text-3" id="text-orga8e50c4">
<p>
A first look at multiprocessing: the command-line pipe operator <code>|</code>
</p>
<ul class="org-ul">
<li><p>
At the command line:
</p>
<pre class="example">
cat file.txt | sort

</pre>
<ul class="org-ul">
<li>The 'cat' (short for 'concatenate') on the left is one executing
process, and the 'sort' on the right is another executing process.</li>
<li>The 'sort' performs blocking I/O: it waits for all of the bytes
from 'cat' before doing the sorting.</li>
<li>If the machine has two processorss, 'cat' could execute on one and 'sort' on the other.</li>
<li>The unnamed pipe operator | thus performs automatic multiprocessing.
<ul class="org-ul">
<li>A pipe is thus a mechanism for inter-process communication (IPC).</li>
</ul></li>
</ul></li>
<li>Conceptual view of the pipe:</li>
</ul>
<pre class="example">
                       pipe
               +--------|-------+
    writer----&gt;|WriteEnd|ReadEnd|&lt;----reader
               +--------+-------+
</pre>
<ul class="org-ul">
<li>The tasks at hand (producing the bytes in the file and then sorting
the lines) are divided between two processes, 'cat' and 'sort'.</li>
<li>Two general approaches in code:
<ul class="org-ul">
<li>A parent process 'forks' (clones, spawns) a child process, and both
execute code from the same program.	  
<ul class="org-ul">
<li>An if-else or the equivalent typically separates the parent code from the child code.</li>
</ul></li>
<li>A parent process forks a child, which then executes a separate program.</li>
</ul></li>
<li><p>
A final example to underscore the point:
</p>
<pre class="example">
sleep 5 | echo 'Hello, world!'  ## sleep sends no bytes to the pipe, and echo expects none

</pre>
<ul class="org-ul">
<li>Hello, world! appears on the screen, and roughly 5 seconds later the prompt returns from the sleep command.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3f7bb81" class="outline-3">
<h3 id="org3f7bb81">Multithreading</h3>
<div class="outline-text-3" id="text-org3f7bb81">
<p>
A first look at multithreading: the Tomcat web server, written in Java
</p>

<ul class="org-ul">
<li>Tomcat implements the 'one-thread-per-request' model for handling client requests.</li>
<li>Tomcat runs as a single process, which is multithreaded.</li>
<li>Web sites and services are deployed as JAR files (with a .war
extension) dropped into a particular directory (TOMCAT<sub>HOME</sub>/webapps)
or subdirectory thereof.
<ul class="org-ul">
<li><p>
The WAR file's name (e.g., 'site1' in 'site1.war') becomes the first part of 'resource path'
in a request URL:<br />
</p>

<p>
<a href="http://somemachine.org:8080/site1/">http://somemachine.org:8080/site1/</a>&#x2026;    ## site1 for the site1.war file<br />
<a href="http://somemachine.org:8080/site1/hi.jsp">http://somemachine.org:8080/site1/hi.jsp</a> ## a completed URL, with hi.jsp as the requested resourc
</p></li>
<li>Tomcat delegates each request for any WAR file to a thread, the 'one-thread-per-request' model
<ul class="org-ul">
<li>Code within the WAR file is thus susceptible to race conditions
because multiple request-handling threads have access to the
very same memory locations: the burden is on the programmer to
ensure proper thread coordination.</li>
</ul></li>
</ul></li>
<li>For efficiency, Tomcat creates a thread pool at start-up: indeed, two thread pools&#x2013;one for
requests over HTTP, another for requests over HTTPS if HTTPS is enabled.</li>
<li>Other Java-centric web servers, such as Jetty, implement the one-thread-per-request model as well.</li>
</ul>
</div>
</div>
<div id="outline-container-org04c0000" class="outline-3">
<h3 id="org04c0000">Non-blocking I/O</h3>
<div class="outline-text-3" id="text-org04c0000">
<p>
A first look at non-blocking I/O non-blocking I/O: two code examples
</p>

<ul class="org-ul">
<li>A blocking 'getItem' (read) example</li>
</ul>
<div class="org-src-container">
<pre class="src src-html">&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #0000FF;">!doctype</span> html&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">html</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">head</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">title</span>&gt;<span style="color: #000000; font-weight: bold; text-decoration: underline;">Blocking I/O</span>&lt;/<span style="color: #006699;">title</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">script</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localStorage.name = 'Flintstone';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 1 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('Before blocking call');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 2 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var value = localStorage.getItem('name');&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 3 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('After blocking call: ' + value);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">line 4 </span><span style="color: #8D8D84;">--&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span style="color: #006699;">script</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span style="color: #006699;">head</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color: #006699;">body</span>/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span style="color: #006699;">html</span>&gt;</p>
</pre>
</div>
<ul class="org-ul">
<li>The second alert occurs only after the blocking call to 'getItem' (line 3) returns.</li>
</ul>
<ul class="org-ul">
<li>A non-blocking 'fetch' example in pseudo-code</li>
</ul>
<div class="org-src-container">
<pre class="src src-java">    <span style="color: #6434A3;">define</span> <span style="color: #006699;">callbackFunction</span><span style="color: #707183;">(</span>Http-response<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
       productList = extractProductListFromResponse<span style="color: #7388D6;">(</span>Http-response<span style="color: #7388D6;">)</span>
       print<span style="color: #7388D6;">(</span>productList<span style="color: #7388D6;">)</span>                            ## print is blocking
    <span style="color: #707183;">}</span>

    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Main code </span>
    url = <span style="color: #008000;">'http://some-machine.org/some-script-to-get-data'</span>
    connection = getConnectionToRemoteMachine<span style="color: #707183;">(</span>url<span style="color: #707183;">)</span>
    connection.fetch<span style="color: #707183;">(</span>callbackFunction<span style="color: #707183;">)</span>                   ## fetch<span style="color: #707183;">(</span>...<span style="color: #707183;">)</span> is non-blocking
    print<span style="color: #707183;">(</span><span style="color: #008000;">'Hello, world!'</span><span style="color: #707183;">)</span>                               ## print is blocking
    print<span style="color: #707183;">(</span><span style="color: #008000;">'Goodbye, cruel world!'</span><span style="color: #707183;">)</span>                       ## print is blocking</pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbabac52" class="outline-3">
<h3 id="orgbabac52">Zusammenfassung</h3>
<div class="outline-text-3" id="text-orgbabac52">
<p>
Three approaches to concurrency: multiprocessing, multithreading, non-blocking I/O
</p>

<pre class="example">
     client requests  +------------+   ## Task1: handle request1
   ------------------&gt;| web server |   ## Task2: handle request2
                      +------------+      ...
</pre>

<ul class="org-ul">
<li>Multiprocessing: dispatch each task to a separate process ('program
in execution')
<ul class="org-ul">
<li>For efficiency, "prefork" the processes by building a pool of these
at start-up.  Then grab a process from the pool to act as the 'task
handler'.</li>
<li>When the task-handling process finishes its work, put it to sleep.</li>
<li>Apache2, nginx, and IIS are production-grade examples.</li>
</ul></li>
<li>Multithreading: dispatch each task to a separate thread within a process.
<ul class="org-ul">
<li>Again for efficiency, build a thread-pool at start-up, and grab a
thread from the pool to act as the 'task handler'.
<ul class="org-ul">
<li>When the task-handling thread finishes its work, put it to sleep.</li>
<li>Tomcat and Jetty are production-grade examples.</li>
</ul></li>
</ul></li>
<li>Non-blocking I/O: in its pure form, a single-threaded process that
jumps quickly from one task to another, perhaps doing only partial
processing of each task.
<ul class="org-ul">
<li>For example, the non-blocking web server might read (and cache)
some bytes as part of Task1, then do the same for Task2, and so on
until all of the request bytes for a given task have been read.
<ul class="org-ul">
<li>Node.js is the obvious 'pure' example (but even Node.js takes a hybrid approach).</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org476ae62" class="outline-3">
<h3 id="org476ae62">Hybrid approaches</h3>
<div class="outline-text-3" id="text-org476ae62">
<ul class="org-ul">
<li>There's no hard-and-fast rule about how best to support concurrency.
<ul class="org-ul">
<li>Multiprocessing, multithreading, and non-blocking I/O can be used
in various combinations.</li>
</ul></li>
<li><p>
Sample hybrids
</p>
<ul class="org-ul">
<li>Multiprocessing + multithreading: IIS (Windows web server) and
AspNet runtime</li>
</ul>
<pre class="example">
  client side                         server side
+-------------+  HTTP requests    +-----------------+
| web browser |------------------&gt;| Web server (IIS)|
|             |&lt;------------------|                 |
+-------------+  HTTP responses   +-------+---------+
                                          |
                                    aspnet_isapi.dll    ## Links IIS process with workers
                                          |
                                          +--- aspnet_wp.exe    ## worker process 1
                                          |
                                          +--- aspnet_wp.exe    ## worker process 2
                                          ...                   ...
</pre>
<ul class="org-ul">
<li>Each worker process is multithreaded (by default, 10 threads per
worker process), and each thread handles a single request (the
'one-thread-per-request' model)</li>
</ul>
<ul class="org-ul">
<li>Multiprocessing + non-blocking I/O: nginx
<ul class="org-ul">
<li>Multiprocessing:
<ul class="org-ul">
<li>nginx has a 'master process' to read configuration files and
to watch over worker processes (e.g., start a new worker if
one happens to die unexpectedly).</li>
<li>A 'worker process' handles a client request: a given worker
may handle even thousands of requests concurrently&#x2013;given the
efficiency of non-blocking I/O.</li>
<li>Other (optional) processes (e.g., a cache loader and a cache
manager) also are in play.</li>
<li>Non-blocking I/O:
<ul class="org-ul">
<li>The workers employ non-blocking I/O in handling requests,
each of which is partitioned into a collection of
sub-requests. A completed sub-request generates an event,
which is handled in the course of assembling a full response
out of pieces.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Non-blocking I/O + multithreading (under the hood): Node.js</li>
</ul>
<pre class="example">
               Node.js server  ## a single-threaded process managing an event loop
client request  +--------+
---------------&gt;|        |     ## 'workers' are JavaScript functions that read and
     ...        | event           otherwise handle a client's request using non-blocking 
client request  | loop   |        I/O and callbacks to signal task completion
---------------&gt;|        |
                +--------+     ## Long-running tasks (e.g., accessing a DB) are delegated 
			          to under-the-hood threads, with callbacks to signal
                                  task completion
</pre></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgdf147a7" class="outline-2">
<h2 id="orgdf147a7">Multiprocessing &#x2013; Grundlagen</h2>
<div class="outline-text-2" id="text-orgdf147a7">
</div><div id="outline-container-org157a6e6" class="outline-3">
<h3 id="org157a6e6">A first multiprocessing example in C</h3>
<div class="outline-text-3" id="text-org157a6e6">
</div><div id="outline-container-org526b75c" class="outline-4">
<h4 id="org526b75c">Overview</h4>
<div class="outline-text-4" id="text-org526b75c">
<p>
&#x2026; key points of the 'unnamed pipe example'
</p>

<ul class="org-ul">
<li><p>
When the program pipeExample.c is compiled and then executed from
the command-line, it executes as a process. Here's the command to
execute:
</p>
<pre class="example">
% ./pipeExample   ## On Windows: % pipeExample

</pre></li>
<li>The executing pipeExample is the 'parent' process.</li>
<li>The parent process calls the library function fork() to spawn a
'child' process, a clone of the parent.
<ul class="org-ul">
<li>The library function fork() makes a system call to the OS routine that spawns the child.</li>
<li>The library function fork() returns one of three values:
<dl class="org-dl">
<dt>-1</dt><dd>to signal failure (e.g., the system already has too
many processes)</dd>
<dt>0</dt><dd>to the child process</dd>
<dt>&gt; 0</dt><dd>to the parent process; in particular, the 'process id'
(pid) of the child is returned to the parent, and a pid
is always a positive integer</dd>
</dl></li>
<li>The parent and child process both execute the code that follows the call to fork().
<ul class="org-ul">
<li>fork() effectively 'clones' one process (child) from another (parent).</li>
<li><p>
An if-else or equivalent construct is used to ensure that the
parent does one thing and the child does something else.
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #6434A3;">pid_t</span> <span style="color: #BA36A5;">pid</span> = fork<span style="color: #707183;">()</span>;   <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">pid_t is a signed integer data type *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>-1 == pid<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>      <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">error: couldn't clone a new process *</span><span style="color: #8D8D84;">*/</span>
    ...                
<span style="color: #707183;">}</span>   
<span style="color: #0000FF;">else</span> <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>0 == pid<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">child code follows *</span><span style="color: #8D8D84;">*/</span>
    ...
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">else</span> <span style="color: #707183;">{</span>                <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">parent code follows *</span><span style="color: #8D8D84;">*/</span>
    ...
<span style="color: #707183;">}</span></pre>
</pre>
</div></li>
</ul></li>
<li>The parent waits for the child to exit so that the child does not
become a 'zombie'.
<ul class="org-ul">
<li>When a child terminates, the OS notifies the parent. If the
parent is already terminated, it cannot be notified&#x2013;and the
child becomes an 'zombie', dead but still around.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3b441d3" class="outline-4">
<h4 id="org3b441d3">using the shell</h4>
<div class="outline-text-4" id="text-org3b441d3">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ ls pipeExample.c 
pipeExample.c
bash-3.2$ gcc -o pipeExample pipeExample.c 
bash-3.2$ ./pipeExample
This is the winter of our discontent
bash-3.2$ </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org02ae615" class="outline-4">
<h4 id="org02ae615">Source code</h4>
<div class="outline-text-4" id="text-org02ae615">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">A first multiprocessing example: pipes in C </span>
<span style="color: #8D8D84; font-style: italic;">    To compile (Unix-like system): gcc -o pipeExample pipeExample.c</span>
<span style="color: #8D8D84; font-style: italic;">    For Windows, the GNU compiler: https://gcc.gnu.org/</span>
<span style="color: #8D8D84; font-style: italic;">*</span><span style="color: #8D8D84;">*/</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/wait.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">string.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">ReadEnd</span>  0                                                  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 1 *</span><span style="color: #8D8D84;">*/</span>            
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">WriteEnd</span> 1                                                

<span style="color: #6434A3;">void</span> <span style="color: #006699;">report_and_die</span><span style="color: #707183;">(</span><span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">msg</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>                              <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 2 *</span><span style="color: #8D8D84;">*/</span>
  perror<span style="color: #7388D6;">(</span>msg<span style="color: #7388D6;">)</span>;
  exit<span style="color: #7388D6;">(</span>-1<span style="color: #7388D6;">)</span>;    <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">failure *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">pipeFDs</span><span style="color: #7388D6;">[</span>2<span style="color: #7388D6;">]</span>;                                                   <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 3 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">char</span> <span style="color: #BA36A5;">buf</span>;         <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">1-byte buffer </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">msg</span> = <span style="color: #008000;">"This is the winter of our discontent\n"</span>;

  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>pipe<span style="color: #909183;">(</span>pipeFDs<span style="color: #909183;">)</span> &lt; 0<span style="color: #7388D6;">)</span> report_and_die<span style="color: #7388D6;">(</span><span style="color: #008000;">"pipe(...)"</span><span style="color: #7388D6;">)</span>;               <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 4 *</span><span style="color: #8D8D84;">*/</span>

  <span style="color: #6434A3;">pid_t</span> <span style="color: #BA36A5;">cpid</span> = fork<span style="color: #7388D6;">()</span>;                                              <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 5 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>cpid &lt; 0<span style="color: #7388D6;">)</span> report_and_die<span style="color: #7388D6;">(</span><span style="color: #008000;">"fork()"</span><span style="color: #7388D6;">)</span>;                           <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 6 *</span><span style="color: #8D8D84;">*/</span>

  <span style="color: #8D8D84;">/*** </span><span style="color: #8D8D84; font-style: italic;">child **</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>0 == cpid<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>                                                  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 7 *</span><span style="color: #8D8D84;">*/</span>
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>WriteEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;                                       <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 8 *</span><span style="color: #8D8D84;">*/</span>
    <span style="color: #0000FF;">while</span> <span style="color: #909183;">(</span>read<span style="color: #709870;">(</span>pipeFDs<span style="color: #907373;">[</span>ReadEnd<span style="color: #907373;">]</span>, &amp;buf, 1<span style="color: #709870;">)</span> &gt; 0<span style="color: #909183;">)</span>                     <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 9 *</span><span style="color: #8D8D84;">*/</span>
      write<span style="color: #909183;">(</span>STDOUT_FILENO, &amp;buf, <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span>buf<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;                      <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">1ine 10 *</span><span style="color: #8D8D84;">*/</span>
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>ReadEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;                                        <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 11 *</span><span style="color: #8D8D84;">*/</span>
    _exit<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">signal parent of immediate exit *</span><span style="color: #8D8D84;">*/</span>                <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 12 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #7388D6;">}</span> 
  <span style="color: #8D8D84;">/*** </span><span style="color: #8D8D84; font-style: italic;">parent **</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">else</span> <span style="color: #7388D6;">{</span>                                                            <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 13 *</span><span style="color: #8D8D84;">*/</span> 
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>ReadEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;                                   
    write<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>WriteEnd<span style="color: #709870;">]</span>, msg, strlen<span style="color: #709870;">(</span>msg<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;                     <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 14 *</span><span style="color: #8D8D84;">*/</span>
    close<span style="color: #909183;">(</span>pipeFDs<span style="color: #709870;">[</span>WriteEnd<span style="color: #709870;">]</span><span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">generates an EOF </span><span style="color: #8D8D84;">*/</span>                <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 15 *</span><span style="color: #8D8D84;">*/</span>
    wait<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/*** </span><span style="color: #8D8D84; font-style: italic;">wait for child to exit **</span><span style="color: #8D8D84;">*/</span>                       <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 16 *</span><span style="color: #8D8D84;">*/</span>  
    exit<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">exit normally </span><span style="color: #8D8D84;">*/</span>                                    <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 17 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #7388D6;">}</span>
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org191fb3f" class="outline-3">
<h3 id="org191fb3f">Second Example &#x2013; Named Pipes</h3>
<div class="outline-text-3" id="text-org191fb3f">
</div><div id="outline-container-org7f1c7b4" class="outline-4">
<h4 id="org7f1c7b4">Overview</h4>
<div class="outline-text-4" id="text-org7f1c7b4">
<p>
A second multiprocessing example in C: key points of the 'named pipe' example
</p>

<ul class="org-ul">
<li>Two separate processes, but no parent/child relationship between them.
<ul class="org-ul">
<li>The processes communicate through a 'named pipe' (aka 'FIFO').
<ul class="org-ul">
<li><p>
A named pipe is a mechanism designed to support IPC among processes on the same host.
</p>
<pre class="example">
           +------------+
writer----&gt;| named pipe |&lt;----reader
           +------------+
</pre></li>
</ul></li>
</ul></li>
<li>The system implements an FIFO as a temporary file.</li>
<li>Named pipes are quite similar in functionality to Unix Domain
Sockets, also called 'local sockets'.
<ul class="org-ul">
<li>Network sockets support communcation between processes running on
different hosts, whereas named pipes and local sockets do the same
for processes running on the same host.</li>
</ul></li>
<li><p>
The example consists of two executable programs, fifoWriter and
fifoReader, which can be executed at the command-line as follows:
</p>
<pre class="example">
% ./fifoWriter &amp;    ## for Windows: fifoWriter &amp; (&amp; puts the process in the background) 
% ./fifoReader      ## for Windows: fifoReader

</pre>
<ul class="org-ul">
<li>There are now two processes executing: fifoWriter and fifoReader</li>
<li>The fifoWriter writes randomly generated integers to the FIFO.</li>
<li>The fifoReader reads these integers from the FIFO until end-of-file.</li>
<li>In the C code, the FIFO is 'written' and 'read' as if it were a
regular disk file: the I/O API is the same.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org4dd9aa2" class="outline-4">
<h4 id="org4dd9aa2">using the shell</h4>
<div class="outline-text-4" id="text-org4dd9aa2">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ ./fifoWriter &amp;
<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> 7316
bash-3.2$ ./fifoReader
60749779
966803328
1202260494
...
<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span>+  Done                    ./fifoWriter
bash-3.2$ </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcd9867c" class="outline-4">
<h4 id="orgcd9867c">Source Code <code>fifoWriter.c</code></h4>
<div class="outline-text-4" id="text-orgcd9867c">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">fcntl.h</span><span style="color: #707183;">&gt;</span> 
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">time.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/stat.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/types.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">MaxWrites</span> 256  

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  srand<span style="color: #7388D6;">(</span>time<span style="color: #909183;">(</span>0<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">seed the random number generator </span><span style="color: #8D8D84;">*/</span>

  <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">fifoName</span> = <span style="color: #008000;">"./myPipe1"</span>;          
  mkfifo<span style="color: #7388D6;">(</span>fifoName, 0666<span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">read/write for user/group/others </span><span style="color: #8D8D84;">*/</span>             <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 1 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">fd</span> = open<span style="color: #7388D6;">(</span>fifoName, O_CREAT | O_WRONLY<span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">open blocks on a FIFO </span><span style="color: #8D8D84;">*/</span>   <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 2 *</span><span style="color: #8D8D84;">*/</span>

  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; MaxWrites; i++<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span> 
    <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">n</span> = rand<span style="color: #909183;">()</span>;             
    write<span style="color: #909183;">(</span>fd, &amp;n, <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span><span style="color: #6434A3;">int</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">4 bytes per int </span><span style="color: #8D8D84;">*/</span>                       <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 3 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #7388D6;">}</span>
  close<span style="color: #7388D6;">(</span>fd<span style="color: #7388D6;">)</span>;         <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">close the fifo </span><span style="color: #8D8D84;">*/</span>                                    <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 4 *</span><span style="color: #8D8D84;">*/</span>
  unlink<span style="color: #7388D6;">(</span>fifoName<span style="color: #7388D6;">)</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">dispose of underlying file </span><span style="color: #8D8D84;">*/</span>                        <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 5 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4a07a02" class="outline-4">
<h4 id="org4a07a02">Source Code <code>fifoReader.c</code></h4>
<div class="outline-text-4" id="text-org4a07a02">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">fcntl.h</span><span style="color: #707183;">&gt;</span> 
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">time.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/stat.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/types.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">fifoName</span> = <span style="color: #008000;">"./myPipe1"</span>;
    <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">num</span>;
    <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">fd</span> = open<span style="color: #7388D6;">(</span>fifoName, O_RDONLY<span style="color: #7388D6;">)</span>;              <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 1 *</span><span style="color: #8D8D84;">*/</span>

    <span style="color: #0000FF;">while</span> <span style="color: #7388D6;">(</span>read<span style="color: #909183;">(</span>fd, &amp;num, <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span>num<span style="color: #709870;">)</span><span style="color: #909183;">)</span> &gt; 0<span style="color: #7388D6;">)</span>         <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 2 *</span><span style="color: #8D8D84;">*/</span> 
      printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%i\n"</span>, num<span style="color: #7388D6;">)</span>;
    close<span style="color: #7388D6;">(</span>fd<span style="color: #7388D6;">)</span>;                                      <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 3 *</span><span style="color: #8D8D84;">*/</span>
    unlink<span style="color: #7388D6;">(</span>fifoName<span style="color: #7388D6;">)</span>;                               <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">line 4 *</span><span style="color: #8D8D84;">*/</span>
    <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5e5a8cd" class="outline-3">
<h3 id="org5e5a8cd">The Nginx Web Server</h3>
<div class="outline-text-3" id="text-org5e5a8cd">
<p>
Multiprocessing in production-grade software: the nginx web server
</p>

<ul class="org-ul">
<li>www.nginx.com
<ul class="org-ul">
<li>The web server is written in C.</li>
<li>nginx combines multiprocessing and non-blocking I/O as concurrency mechanisms.</li>
</ul></li>

<li>nginx, like any modern web server that relies on multiprocessing for concurrency,
is a "pre-forking" server.
<ul class="org-ul">
<li>nginx can be started as a 'system service' (at boot time), and is platform-neutral.</li>
</ul></li>

<li><p>
<code>nginx.conf</code>  ()configuration entries are key/value pairs: no XML!)
</p>
<pre class="example">
user www-data;           ## www-data (name is arbitrary) is owner of workers
worker_processes 4;      ## default number of workers, might be set to processor count
pid /var/run/nginx.pid;  ## file /var/run/nginx.pid stores pid of master process

events {
   worker_connections 1024;  ## Max of 1024 connections per worker 
   ...                       ## (typical browsers open at least two connections to a 
                                site per client session)
    }   
</pre></li>

<li><p>
<code>ps -ef | grep nginx</code>
</p>
<pre class="example">
Owner     pid   ppid   nginx process type

root      1803     1   master process /usr/sbin/nginx  ## command that started nginx
www-data  1804  1803   worker process
www-data  1805  1803   worker process
www-data  1807  1803   worker process
www-data  1808  1803   worker process
</pre></li>
</ul>
</div>
</div>
<div id="outline-container-org8c01a40" class="outline-3">
<h3 id="org8c01a40">Execing and Forking Options in Multiprocessing</h3>
<div class="outline-text-3" id="text-org8c01a40">
<p>
A second way for one executing program to start another
</p>

<ul class="org-ul">
<li><p>
Review of the previously way, introduction of the new way:
</p>
<pre class="example">
        fork()
parent----------&gt;child        ## Both parent and child continue to execute...

         exec...()
process1-----------&gt;process2  ## process2 replaces process1, which terminates
</pre></li>
<li>In systems speak, an 'image' is an executable program. For instance,
copying the system from one machine to another is called
're-imaging'.
<ul class="org-ul">
<li>In the multiprocessing 'pipeExample' code, the image is the
compiled, executable program named 'pipeExample'</li>
</ul></li>
<li>A new process can be 'spawned' (created) under one of two distinct
scenarios, which the difference between the fork() function and the
exec-family of functions illustrates.
<ul class="org-ul">
<li>The exec-family consists of library functions that, under the
hood, make the same system call.</li>
</ul></li>
<li><p>
In a successful call to fork(), the new child process executes the
'same' image as the parent that spawned it: the forked process is a
clone. So the standard code idiom is this:
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #6434A3;">pid_t</span> <span style="color: #BA36A5;">pid</span> = fork<span style="color: #707183;">()</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">parent executes this </span><span style="color: #8D8D84;">*/</span>
...                  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">check for success </span><span style="color: #8D8D84;">*/</span>
<span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>0 == pid<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>      <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">0 returned to the child </span><span style="color: #8D8D84;">*/</span>
   ...               <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">child code </span><span style="color: #8D8D84;">*/</span>
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">else</span> <span style="color: #707183;">{</span>               <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">parent code: fork returns child's pid to parent </span><span style="color: #8D8D84;">*/</span>
   ...               <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">alternative parent test: if (pid &gt; 0)</span>
<span style="color: #8D8D84; font-style: italic;">}</span></pre>
</pre>
</div></li>
<li><p>
In a successful call to an exec-function, replaces the current process image with
a new image that's loaded into memory.
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">flag</span> = execl<span style="color: #707183;">(</span><span style="color: #008000;">"/usr/bin/myGame"</span>, <span style="color: #008000;">"myGame"</span>, 0<span style="color: #707183;">)</span>;
<span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>-1 == flag<span style="color: #707183;">)</span> perror<span style="color: #707183;">(</span><span style="color: #008000;">"Couldn't exec..."</span><span style="color: #707183;">)</span>;
<span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">on success, the 'myGame' program now executes </span><span style="color: #8D8D84;">*/</span></pre>
</pre>
</div>
<ul class="org-ul">
<li>The new image has its own address space and other features. In
summary, the old process stops execution and a new one begins
execution.</li>
<li>The new process retains the pid (and ppid) of the one it replaces
<ul class="org-ul">
<li>The user and group properties are likewise unchanged.</li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="outline-container-org6f93a9c" class="outline-4">
<h4 id="org6f93a9c">Using the Shell</h4>
<div class="outline-text-4" id="text-org6f93a9c">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ ./fileStatus tmp
File name: tmp

Information about file tmp:

Owner ID:    503
Group ID:    20
Byte size:   68
Last access: Fri Oct  6 11:10:23 2017
File type:   directory
Owner read:  Owner readable
Owner write: Owner writable

bash-3.2$ ./fileStatus fileStatus
File name: fileStatus

Information about file fileStatus:

Owner ID:    503
Group ID:    20
Byte size:   8808
Last access: Fri Oct  6 11:12:05 2017
File type:   regular
Owner read:  Owner readable
Owner write: Owner writable

bash-3.2$ ./execing
File name: tmp

Information about file tmp:

Owner ID:    503
Group ID:    20
Byte size:   68
Last access: Fri Oct  6 11:10:23 2017
File type:   directory
Owner read:  Owner readable
Owner write: Owner writable</pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org0f64295" class="outline-4">
<h4 id="org0f64295">Source Code</h4>
<div class="outline-text-4" id="text-org0f64295">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">To run: </span>

<span style="color: #8D8D84; font-style: italic;">   -- compile this program (gcc -o execing execing.c) and fileStatus.c </span>
<span style="color: #8D8D84; font-style: italic;">   --                      (gcc -o fileStatus fileStatus.c)</span>
<span style="color: #8D8D84; font-style: italic;">   -- create a subdirectory named tmp: mkdir tmp</span>
<span style="color: #8D8D84; font-style: italic;">   -- from the command line: ./execing</span>

<span style="color: #8D8D84; font-style: italic;">   This program 'execs' the fileStatus program, which outputs metadata about the tmp dir..</span>
<span style="color: #8D8D84; font-style: italic;">   Here's a depiction:</span>

<span style="color: #8D8D84; font-style: italic;">                   execv</span>
<span style="color: #8D8D84; font-style: italic;">   execing program-------&gt;fileStatus program</span>
<span style="color: #8D8D84;">*/</span>

<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">unistd.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdlib.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">char</span>* <span style="color: #0000FF;">const</span> <span style="color: #BA36A5;">args</span><span style="color: #7388D6;">[]</span> = <span style="color: #7388D6;">{</span><span style="color: #008000;">"./fileStatus"</span>, <span style="color: #008000;">"tmp"</span>, 0<span style="color: #7388D6;">}</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">fileStatus program, tmp directory </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">ret</span> = execv<span style="color: #7388D6;">(</span><span style="color: #008000;">"./fileStatus"</span>, args<span style="color: #7388D6;">)</span>;            <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">"v" for "vector" </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>-1 == ret<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>                                  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">check for failure </span><span style="color: #8D8D84;">*/</span>
    perror<span style="color: #909183;">(</span><span style="color: #008000;">"execv(...) error"</span><span style="color: #909183;">)</span>;
    exit<span style="color: #909183;">(</span>-1<span style="color: #909183;">)</span>;
  <span style="color: #7388D6;">}</span>
  <span style="color: #0000FF;">else</span> 
    printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"I'm here\n"</span><span style="color: #7388D6;">)</span>;                           <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">never executes </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbbc1555" class="outline-3">
<h3 id="orgbbc1555">Process Tracking and Management</h3>
<div class="outline-text-3" id="text-orgbbc1555">
<p>
Process tracking and context switching
</p>

<ul class="org-ul">
<li>Each process has a unique ID (pid), a non-negative integer.
<ul class="org-ul">
<li>A process's pid is recorded in the system's process table.</li>
<li>Library functions getpid() and getppid() get the pid and the
parent's pid, respectively.</li>
<li>The pid of 0 is typically reserved for the 'idle process', the one
that 'runs' when there's nothing else to run.</li>
<li>The 'init process' has a pid of 1: the first user-space process
that the OS kernel spawns in the boot-up.
<ul class="org-ul">
<li>On shutdown, the init process is the last process to terminate:
it waits for all of its children.</li>
<li>The init process starts other processes: system services such as
the login service, etc.</li>
</ul></li>
</ul></li>
<li>Key data structures in a process 'context':
<ul class="org-ul">
<li>process table: tracks information per process, in particular
information that allows a pre-empted process to restart later.</li>
<li>page table(s): translate virtual into physical addresses. Each
process has its own, which effectively partitions virtual address
spaces among processes.</li>
<li>file table: tracks, per process, files that a process has opened.</li>
</ul></li>
<li>Every process has a user and group 'owner', which determines the
process's access rights to resources.
<ul class="org-ul">
<li>Every process likewise belongs to a 'process group', which
facilitates sending signals to every process in a group, to
getting information about related processes, and so on.</li>
<li>In the default case, a child process belongs to the same as its
parent.</li>
</ul></li>
<li>Most modern systems use pre-emptive scheduling, with either
fixed-length or variable-length time-slices: a process that exceeds
the time-slice on a given run is pre-empted and sent back to a
scheduling queue.
<ul class="org-ul">
<li>A process and a thread 'context' consists of key information about
it.
<ul class="org-ul">
<li>For a process, key data structures such as the process table,
the file table, and its page tables define the 'context'.</li>
</ul></li>
</ul></li>
<li>Context switches, which occur during pre-emption, come in two
flavors:
<ul class="org-ul">
<li>From one thread to another within the same process: 'intraprocess
switching'</li>
<li>From one process to another: 'interprocess switching'
<ul class="org-ul">
<li>The big cost is the swapping out of one (virtual) address space
for another: page tables</li>
</ul></li>
<li>A process-level context switch is signficantly more expensive than
a thread-level context switch.
<ul class="org-ul">
<li>The cost of thread-level switching is near zero on modern systems.</li>
<li><p>
Depiction:
</p>
<pre class="example">
Process1      Process2        processor7
  Thread11      Thread21
  Thread12

1st scenario: Thread12 replaces Thread11 on processor7  + virtually no overhead

2nd scenario: Thread21 replaces Thread11 on processor7  + high overhead--
                                                          process context switch
</pre></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3e0ed8a" class="outline-3">
<h3 id="org3e0ed8a">Multiprocessing Through Richer Code Examples</h3>
<div class="outline-text-3" id="text-org3e0ed8a">
<p>
Chapter 4 : 
</p>
<ul class="org-ul">
<li>node.js</li>
<li>ipc</li>
<li>nginx</li>
<li>exercise</li>
<li>upsides and downsides of multiprocessing</li>
</ul>
</div>
<div id="outline-container-org306f49d" class="outline-4">
<h4 id="org306f49d">Overview</h4>
</div>
</div>
</div>
<div id="outline-container-orgc7eb2b9" class="outline-2">
<h2 id="orgc7eb2b9">Multithreading &#x2013; Grundlagen</h2>
<div class="outline-text-2" id="text-orgc7eb2b9">
</div>
<div id="outline-container-org15e5fe9" class="outline-3">
<h3 id="org15e5fe9">Overview</h3>
<div class="outline-text-3" id="text-org15e5fe9">
<p>
Multithreading overview
</p>

<ul class="org-ul">
<li>The chief advantage of multithreading over multiprocessing is that
threads are 'lighter' than processes:
<ul class="org-ul">
<li>A process consists of one or more threads of execution.</li>
<li>A process-level context switch is significantly more expensive, in the millisecond range.</li>
<li>A thread-level context switch has a near-zero cost for threads in
the same process.</li>
</ul></li>
<li>The chief disadvantage is that threads in the same process share the
same address space:
<ul class="org-ul">
<li>The programmer, rather than the OS, must ensure that two threads
in the same process don't inappropriately access the same memory
location (e.g., by trying to update the location).</li>
<li>The programmer must coordinate threads in the same process to
avoid 'race conditions'.  
<ul class="org-ul">
<li>If the coordination is overdone, <i>deadlock</i> may result.</li>
</ul></li>
<li>Thread coordination must be just right:
<ul class="org-ul">
<li>Too little brings the threat of race conditions and, therefore,
unpredictable results.</li>
<li>Too much hurts efficiency and may result in deadlock.</li>
</ul></li>
</ul></li>
<li>Some systems (e.g., Linux) implement threads as processes that
happen to share an address space; other systems (e.g., Windows) have
distinct kernel-level support for threads.
<ul class="org-ul">
<li>Under any implementation, the standard behavior is that distinct
processes have distinct address spaces, whereas threads in the
same process share an address space.</li>
</ul></li>
<li>Examples in C, Java, and Go
<ul class="org-ul">
<li>C# and Java have very similar support for threading, although both
sides might disagree with this characterization. :)</li>
</ul></li>
</ul>
</div>
<div id="outline-container-org7ac13e0" class="outline-4">
<h4 id="org7ac13e0">A Sample Race Condition in Java</h4>
<div class="outline-text-4" id="text-org7ac13e0">
</div><div id="outline-container-org17aa326" class="outline-5">
<h5 id="org17aa326">source code</h5>
<div class="outline-text-5" id="text-org17aa326">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #036A07;">/** To compile: javac RaceC.java</span>
<span style="color: #036A07;">    To run:     java Main</span>

<span style="color: #036A07;">    Flow of control for Threads referenced by t1 and t2 (for convenience,</span>
<span style="color: #036A07;">    call the Threads referenced by t1 and t2 simply 't1' and 't2'):</span>

<span style="color: #036A07;">    The 'main thread' is the thread that executes the method 'main', in</span>
<span style="color: #036A07;">    this case in class Main (see below).</span>

<span style="color: #036A07;">                 creates</span>
<span style="color: #036A07;">    main thread-----------</span><span style="color: #ff0000; font-weight: bold;">&gt;</span><span style="color: #036A07;">t1 and t2</span>

<span style="color: #036A07;">                  starts</span>
<span style="color: #036A07;">    main thread-----------</span><span style="color: #ff0000; font-weight: bold;">&gt;</span><span style="color: #036A07;">t1 and t2</span>

<span style="color: #036A07;">                 calls run()</span>
<span style="color: #036A07;">    Java runtime-------------</span><span style="color: #ff0000; font-weight: bold;">&gt;</span><span style="color: #036A07;">on started Threads t1 and t2</span>

<span style="color: #036A07;">    At this point, three threads in the app are executing: main, t1, and t2.</span>

<span style="color: #036A07;">    An instance of a Java Thread represents the sequence of instructions in the</span>
<span style="color: #036A07;">    body of the encapsulated 'run' method (and any other instructions in methods</span>
<span style="color: #036A07;">    that 'run' invokes).</span>

<span style="color: #036A07;">    A thread that exits run() terminates, and cannot be restarted.</span>
<span style="color: #036A07;">*/</span>
<span style="color: #0000FF;">public</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">RaceC</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">n</span>;                            <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">a single instance on n</span>
    <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">race</span><span style="color: #7388D6;">()</span> <span style="color: #7388D6;">{</span>
        n = 0;                               <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">initialize to zero before threads alter its value</span>
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">limit</span> = <span style="color: #D0372D;">Integer</span>.MAX_VALUE * 2L; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">four billion and change</span>
        <span style="color: #6434A3;">Thread</span> <span style="color: #BA36A5;">t1</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Thread</span><span style="color: #909183;">()</span> <span style="color: #909183;">{</span>           <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">incrementing thread</span>
                <span style="color: #0000FF;">public</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">run</span><span style="color: #709870;">()</span> <span style="color: #709870;">{</span> 
                    <span style="color: #0000FF;">for</span> <span style="color: #907373;">(</span><span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">i</span> = 0; i &lt; <span style="color: #6434A3;">limit</span>; i++<span style="color: #907373;">)</span> n = n + 1; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">increment limit times</span>
                <span style="color: #709870;">}</span>
            <span style="color: #909183;">}</span>;
        <span style="color: #6434A3;">Thread</span> <span style="color: #BA36A5;">t2</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Thread</span><span style="color: #909183;">()</span> <span style="color: #909183;">{</span>           <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">decrementing thread</span>
                <span style="color: #0000FF;">public</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">run</span><span style="color: #709870;">()</span> <span style="color: #709870;">{</span>
                    <span style="color: #0000FF;">for</span> <span style="color: #907373;">(</span><span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">i</span> = 0; i &lt; <span style="color: #6434A3;">limit</span>; i++<span style="color: #907373;">)</span> n = n - 1; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">decrement limit times</span>
                <span style="color: #709870;">}</span>
            <span style="color: #909183;">}</span>;
        t1.start<span style="color: #909183;">()</span>;  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">start t1's execution</span>
        t2.start<span style="color: #909183;">()</span>;  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">start t2's execution</span>
        <span style="color: #0000FF;">try</span> <span style="color: #909183;">{</span>
            t1.join<span style="color: #709870;">()</span>;  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">wait here until t1 terminates</span>
            t2.join<span style="color: #709870;">()</span>;  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">wait here until t2 terminates</span>
        <span style="color: #909183;">}</span> <span style="color: #0000FF;">catch</span><span style="color: #909183;">(</span><span style="color: #6434A3;">Exception</span> <span style="color: #BA36A5;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span> <span style="color: #909183;">}</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #008000;">"n's value is: "</span> + n<span style="color: #909183;">)</span>;
    <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Main</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">public</span> <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">String</span><span style="color: #909183;">[</span> <span style="color: #909183;">]</span> <span style="color: #BA36A5;">args</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>         <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">*** main thread executes method main</span>
        <span style="color: #0000FF;">for</span> <span style="color: #909183;">(</span><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span> = 0; i &lt; 8; i++<span style="color: #909183;">)</span> RaceC.race<span style="color: #909183;">()</span>; 
    <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #036A07;">/** Output from a sample run:</span>

<span style="color: #036A07;">    n's value is: -265936</span>
<span style="color: #036A07;">    n's value is: -7317</span>
<span style="color: #036A07;">    n's value is: 47128</span>
<span style="color: #036A07;">    n's value is: -219153</span>
<span style="color: #036A07;">    n's value is: 82805</span>
<span style="color: #036A07;">    n's value is: -7944</span>
<span style="color: #036A07;">    n's value is: 87322</span>
<span style="color: #036A07;">    n's value is: -2</span>
<span style="color: #036A07;">*/</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb50dbe5" class="outline-5">
<h5 id="orgb50dbe5">using the shell</h5>
<div class="outline-text-5" id="text-orgb50dbe5">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ javac RaceC.java
bash-3.2$ java Main
n<span style="color: #008000;">'s value is: -332920</span>
<span style="color: #008000;">n'</span>s value is: 237836
n<span style="color: #008000;">'s value is: 73816</span>
<span style="color: #008000;">n'</span>s value is: 61941
n<span style="color: #008000;">'s value is: 59569</span>
<span style="color: #008000;">n'</span>s value is: -2
n<span style="color: #008000;">'s value is: -2</span>
<span style="color: #008000;">n'</span>s value is: 80561</pre>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga07c9f2" class="outline-4">
<h4 id="orga07c9f2">Analysis of the Race Condition Code</h4>
<div class="outline-text-4" id="text-orga07c9f2">
<p>
A detailed look at how a race condition occurs
</p>

<ul class="org-ul">
<li>T1 and T2 are threads in process P: T1 and T2 have access the same
memory locations.</li>
<li>N is memory location within the address space that T1 and T2 share</li>
<li><p>
T1 tries to increment n at the same time that T2 tries to
decrement N.
</p>
<pre class="example">
      N = N + 1  +---+  N = N - 1        ## Are these statements 'atomic'?
   T1-----------&gt;| 5 |&lt;-----------T2
	         +---+
	           N
</pre></li>
<li>Each pseudo-code instruction involves two operations: an addition or
subtraction, then an assignment
<ul class="org-ul">
<li><p>
Assume that the result of the addition/subtraction is stored in a
CPU register or on the stack: in either case, in a temporary
location. Here's a depiction:
</p>
<pre class="example">
 Temp1 = N + 1  ### increment N and save the incremented value (N is unchanged so far)
 N = Temp1      ### assign the incremented value to N
</pre>
<ul class="org-ul">
<li>Temp1 is T1's temporary location, Temp2 is T2's temporary location</li>
</ul></li>
</ul></li>
<li>The machine has multiple CPUs: T1 executes on one of these as T2
executes on another</li>
<li><p>
The following depicts one possible outcome of a race condition:
</p>
<pre class="example">
     Clock ticks:
  
   C1: Temp1 = 5 + 1 = 6   ## T1's addition
   C2: Temp2 = 5 - 1 = 4   ## T2's subtraction (T1's assignment has not occurred yet.)
   C3: N = Temp2           ## T2's assignment operation (N is decremented to 4)
   C4: N = Temp1           ## T1's assignment operation (N is incremented to 6).
</pre></li>
<li>After a single increment by 1 and a single decrement by 1, N winds up as 6&#x2013;not 5.
<ul class="org-ul">
<li>Improper interleaving of the operations is at fault.</li>
<li>Whichever thread starts its arithmetic operation
(addition/subtraction) must be allow to complete the assignment
without interruption.
<ul class="org-ul">
<li>This is precisely what 'thread synchronization' through locking
of N ensures: single-threaded execution of the arithmetic
operation and the subsequent assignment.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org1a21725" class="outline-4">
<h4 id="org1a21725">Overview of Explicit Thread Locking</h4>
<div class="outline-text-4" id="text-org1a21725">
</div><div id="outline-container-org80cadfe" class="outline-5">
<h5 id="org80cadfe">code examples</h5>
<div class="outline-text-5" id="text-org80cadfe">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">Thread synchronization mechanisms: code examples */</span>

<span style="color: #036A07;">/** C example **/</span>
<span style="color: #0000FF;">static</span> <span style="color: #6434A3;">pthread_mutex_t</span> <span style="color: #BA36A5;">lock</span>;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">declare a lock */</span>              <span style="color: #036A07;">/** line 1 **/</span>
<span style="color: #6434A3;">void</span> <span style="color: #006699;">increment_n</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>                                            <span style="color: #036A07;">/** line 2 **/</span>
    pthread_mutex_lock<span style="color: #7388D6;">(</span>&amp;lock<span style="color: #7388D6;">)</span>;                                  <span style="color: #036A07;">/** line 3 **/</span>
    n = n + 1;  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">critical section code */</span>                     <span style="color: #036A07;">/** line 4 **/</span>
    pthread_mutex_unlock<span style="color: #7388D6;">(</span>&amp;lock<span style="color: #7388D6;">)</span>;                                <span style="color: #036A07;">/** line 5 **/</span>
<span style="color: #707183;">}</span>

<span style="color: #036A07;">/** Java example **/</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Test</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">n</span>; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">a single, shared storage location          /** line 6 **/</span>
    <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">Object</span> <span style="color: #BA36A5;">lock</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Object</span><span style="color: #7388D6;">()</span>; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">can't be null         /** line 7 **/</span>
    <span style="color: #6434A3;">void</span> <span style="color: #006699;">incrementN</span><span style="color: #7388D6;">()</span> <span style="color: #7388D6;">{</span>
        <span style="color: #0000FF;">synchronized</span><span style="color: #909183;">(</span>lock<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>                                    <span style="color: #036A07;">/** line 8 **/</span>
            n = n + 1; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">critical section code */</span>              <span style="color: #036A07;">/** line 9 **/</span>
        <span style="color: #909183;">}</span>                                                       <span style="color: #036A07;">/** line 10 **/</span>
    <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3dfba09" class="outline-5">
<h5 id="org3dfba09">Mechanisms for thread coordination</h5>
<div class="outline-text-5" id="text-org3dfba09">
<ul class="org-ul">
<li>The terms below are associated with processes and threads, but the
focus now is on threads given the assumption that a process executes
in that one of its threads executes.</li>
<li>A 'critical section' of code must be executed in single-threaded fashion because
otherwise a race condition could arise.
<ul class="org-ul">
<li><p>
For example, if threads T1 and T2 can both execute 
</p>
<pre class="example">
N = N + 1  ## the same storage N is accessible to T1 and T2

</pre>
<p>
this statement is a critical section of code. T1 and T2 should not
execute this section at the same time.
</p></li>
</ul></li>
<li>A locking mechanism should provide the following services:
<ul class="org-ul">
<li>The mechanism should ensure 'mutual exclusion': if T1 manages to
grab the lock, then T2 is excluded from the critical section that
the lock protects while T1 holds the lock; and vice versa.</li>
<li>The mechanism should ensure 'progress': if no thread holds the
lock, then some thread should be able to grab it and thereby enter
the critical section that the lock protects.</li>
</ul></li>
<li>Various locking mechanisms:
<ul class="org-ul">
<li>A 'semaphore' restricts the number of threads allowed to access a
shared resource (e.g., a shared function). For example, 'semahore'
might allow two threads to access a chunk of code simultaneously,
but no more than two. A semaphore is thus a set of permission
tickets, which enable a thread to access a resource.
<ul class="org-ul">
<li>Semaphores as 'tickets': a semaphore is like a ticket that
grants access to a resource.  A semaphore with a value of three
would grant access to three threads at most at a time.</li>
</ul></li>
<li>A 'mutex' is a semaphore with a value of 1: whichever thread holds
the mutex has access to the protected resource, whereas all others
are excluded.
<ul class="org-ul">
<li>A mutex enforces mutual exclusion, but a semaphore with a value
&gt; 1 would not.</li>
</ul></li>
<li>A 'monitor' (which the Java 'synchronized' block provides) is a
mechanism that enforces mutual exclusion, supports progress, and
has addition mechanisms for thread cooperation: in Java's case,
the 'wait' mechanism supports quiet waiting for a lock to be
released, and the 'notify' mechanism notifies waiters that a lock
has been released.</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgc9bd029" class="outline-4">
<h4 id="orgc9bd029">A Sample Deadlock in Java</h4>
<div class="outline-text-4" id="text-orgc9bd029">
</div><div id="outline-container-orgfe46a45" class="outline-5">
<h5 id="orgfe46a45">using the shell</h5>
<div class="outline-text-5" id="text-orgfe46a45">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ javac Deadlock.java 
bash-3.2$ java Deadlock
thread2 holds lock2
thread1 holds lock1
thread2 waiting for lock1
        <span style="color: #707183;">(</span>thread2 needs lock1 to release lock2...<span style="color: #707183;">)</span>
thread1 waiting for lock2
        <span style="color: #707183;">(</span>thread1 needs lock2 to release lock1...<span style="color: #707183;">)</span>
  ^C ^Cbash-3.2$ 
bash-3.2$ java Deadlock
thread1 holds lock1
thread2 holds lock2
thread2 waiting for lock1
thread1 waiting for lock2
        <span style="color: #707183;">(</span>thread2 needs lock1 to release lock2...<span style="color: #707183;">)</span>
        <span style="color: #707183;">(</span>thread1 needs lock2 to release lock1...<span style="color: #707183;">)</span>
  ^C ^Cbash-3.2$ </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org591af98" class="outline-5">
<h5 id="org591af98">source code</h5>
<div class="outline-text-5" id="text-org591af98">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #036A07;">/** To compile and run from the command-line:</span>
<span style="color: #036A07;">      javac Deadlock.java</span>
<span style="color: #036A07;">      java Deadlock</span>
<span style="color: #036A07;">*/</span>
<span style="color: #0000FF;">public</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Deadlock</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">Object</span> <span style="color: #BA36A5;">lock1</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Object</span><span style="color: #7388D6;">()</span>; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">a single lock1                   /** line 1 **/</span>
    <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">Object</span> <span style="color: #BA36A5;">lock2</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Object</span><span style="color: #7388D6;">()</span>; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">a single lock2</span>
    
    <span style="color: #036A07;">/** Each thread executes its run() method. **/</span>
    <span style="color: #0000FF;">public</span> <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">String</span> <span style="color: #BA36A5;">args</span><span style="color: #909183;">[]</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        <span style="color: #6434A3;">Thread</span> <span style="color: #BA36A5;">thread1</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Thread</span><span style="color: #909183;">()</span> <span style="color: #909183;">{</span>
                <span style="color: #0000FF;">public</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">run</span><span style="color: #709870;">()</span> <span style="color: #709870;">{</span>                            
                    <span style="color: #0000FF;">synchronized</span><span style="color: #907373;">(</span>lock1<span style="color: #907373;">)</span> <span style="color: #907373;">{</span>                                   <span style="color: #036A07;">/** line 2 **/</span>
                        print<span style="color: #6276BA;">(</span><span style="color: #008000;">"thread1 holds lock1"</span><span style="color: #6276BA;">)</span>;
                        <span style="color: #0000FF;">try</span> <span style="color: #6276BA;">{</span> Thread.sleep<span style="color: #858580;">(</span>2<span style="color: #858580;">)</span>; <span style="color: #6276BA;">}</span> <span style="color: #0000FF;">catch</span><span style="color: #6276BA;">(</span><span style="color: #6434A3;">Exception</span> <span style="color: #BA36A5;">e</span><span style="color: #6276BA;">)</span> <span style="color: #6276BA;">{</span> <span style="color: #6276BA;">}</span>     <span style="color: #036A07;">/** line 3 **/</span>
                        print<span style="color: #6276BA;">(</span><span style="color: #008000;">"thread1 waiting for lock2"</span><span style="color: #6276BA;">)</span>;
                        print<span style="color: #6276BA;">(</span><span style="color: #008000;">"\t(thread1 needs lock2 to release lock1...)"</span><span style="color: #6276BA;">)</span>;
                        <span style="color: #0000FF;">synchronized</span><span style="color: #6276BA;">(</span>lock2<span style="color: #6276BA;">)</span> <span style="color: #6276BA;">{</span>                               <span style="color: #036A07;">/** line 4 **/</span>
                            print<span style="color: #858580;">(</span><span style="color: #008000;">"thread1 holds lock1 and lock2"</span><span style="color: #858580;">)</span>;
                        <span style="color: #6276BA;">}</span> <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">lock2 released here                            /** line 5 **/</span>
                    <span style="color: #907373;">}</span> <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">lock1 released here                                /** line 6 **/</span>
                <span style="color: #709870;">}</span> 
            <span style="color: #909183;">}</span>;
        <span style="color: #6434A3;">Thread</span> <span style="color: #BA36A5;">thread2</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Thread</span><span style="color: #909183;">()</span> <span style="color: #909183;">{</span>
                <span style="color: #0000FF;">public</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">run</span><span style="color: #709870;">()</span> <span style="color: #709870;">{</span>
                    <span style="color: #0000FF;">synchronized</span><span style="color: #907373;">(</span>lock2<span style="color: #907373;">)</span> <span style="color: #907373;">{</span>                                   <span style="color: #036A07;">/** line 7 **/</span>
                        print<span style="color: #6276BA;">(</span><span style="color: #008000;">"thread2 holds lock2"</span><span style="color: #6276BA;">)</span>;
                        <span style="color: #0000FF;">try</span> <span style="color: #6276BA;">{</span> Thread.sleep<span style="color: #858580;">(</span>2<span style="color: #858580;">)</span>; <span style="color: #6276BA;">}</span> <span style="color: #0000FF;">catch</span><span style="color: #6276BA;">(</span><span style="color: #6434A3;">Exception</span> <span style="color: #BA36A5;">e</span><span style="color: #6276BA;">)</span> <span style="color: #6276BA;">{</span> <span style="color: #6276BA;">}</span>
                        print<span style="color: #6276BA;">(</span><span style="color: #008000;">"thread2 waiting for lock1"</span><span style="color: #6276BA;">)</span>;
                        print<span style="color: #6276BA;">(</span><span style="color: #008000;">"\t(thread2 needs lock1 to release lock2...)"</span><span style="color: #6276BA;">)</span>;
                        <span style="color: #0000FF;">synchronized</span><span style="color: #6276BA;">(</span>lock1<span style="color: #6276BA;">)</span> <span style="color: #6276BA;">{</span>                               <span style="color: #036A07;">/** line 8 **/</span>
                            print<span style="color: #858580;">(</span><span style="color: #008000;">"thread2 holds lock2 and lock1"</span><span style="color: #858580;">)</span>;
                        <span style="color: #6276BA;">}</span> <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">lock1 released here                            /** line 9 **/</span>
                    <span style="color: #907373;">}</span> <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">lock2 released here                                /** line 10 **/</span>
                <span style="color: #709870;">}</span>
            <span style="color: #909183;">}</span>;
        thread1.start<span style="color: #909183;">()</span>;                                                    <span style="color: #036A07;">/** line 11 **/</span>
        thread2.start<span style="color: #909183;">()</span>;                                                    <span style="color: #036A07;">/** line 12 **/</span>
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">print</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">Object</span> <span style="color: #BA36A5;">obj</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span> System.out.println<span style="color: #909183;">(</span>obj<span style="color: #909183;">)</span>; <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org162dfd4" class="outline-4">
<h4 id="org162dfd4">High-level Concurrency Management in Multithreading</h4>
<div class="outline-text-4" id="text-org162dfd4">
<ul class="org-ul">
<li>Belaboring the obvious: multithreading is far trickier to manage than multiprocessing
<ul class="org-ul">
<li>The OS keeps the processes in multiprocessing from stepping on one another's storge.</li>
<li>The programmer must do the same for threads within a process: thread coordination</li>
</ul></li>
<li><p>
How to support to thread-safety (i.e., safety from race conditions)?
</p>
<ul class="org-ul">
<li>Consider an in-memory mutable list and an 'add' operation.</li>
</ul>
<pre class="example">
       ADD 3  +---+---+
thread-------&gt;| 1 | 2 |        ## list L before the ADD
              +---+---+
              +---+---+---+
              | 1 | 2 | 3 |    ## list L after the ADD, which changes the original list
              +---+---+---+
</pre></li>
<li>Basic Java approach: Ensure mutual exclusion on shared storage through locking.
<ul class="org-ul">
<li>Locking allows only single-threaded access to the list L during an ADD operation.</li>
</ul></li>

<li><p>
Basic Clojure approach: make in-memory objects immutable by default, with a few exceptions
</p>
<ul class="org-ul">
<li>The ADD operation first makes a copy of the original list, and then changes the copy.</li>
</ul>
<pre class="example">
       ADD 3  +---+---+
thread-------&gt;| 1 | 2 |        ## list L 
              +---+---+
                  L

              +---+---+
              | 1 | 2 |        ## copy of list L
              +---+---+
                  Lc

              +---+---+---+
              | 1 | 2 | 3 |    ## copy after the ADD (original is unchanged)
              +---+---+---+
                  Lc
</pre></li>
<li><p>
The preferred Go approach: have a single thread control access to
list L, with other threads sending messages such as ADD to this
controlling thread.
</p>
<ul class="org-ul">
<li>The messages are sent through a thread-safe channel.</li>
</ul>
<pre class="example">
             +---+---+
             | 1 | 2 |      ## a single thread T controls access to L
             +---+---+

        ADD 3                ADD 33
thread1-------&gt;channel to T&lt;--------thread2  ## the channel has built-in synchronization
</pre></li>
</ul>
</div>
</div>
<div id="outline-container-orgf244e8e" class="outline-4">
<h4 id="orgf244e8e">Wrapup of multithreading basics and miscellany</h4>
<div class="outline-text-4" id="text-orgf244e8e">
</div>
<div id="outline-container-orgdb87008" class="outline-5">
<h5 id="orgdb87008">Wrapup</h5>
<div class="outline-text-5" id="text-orgdb87008">
<ul class="org-ul">
<li>Multithreading can be a highly efficient way to do concurrent
programming, as thread-level context switches are very cheap.
<ul class="org-ul">
<li>It's the preferred approach to concurrency in languages such as
Java and C#.</li>
</ul></li>
<li>Multithreading has twin challenges for the programmer:
<ul class="org-ul">
<li>Avoid race conditions by ensuring that multiple threads don't
access shared memory locations in inappropriate ways.
<ul class="org-ul">
<li>Ensure that critical sections are executed in single-threaded
mode.</li>
</ul></li>
<li>Avoid 'over synchronization' that degrades performance and may
result in deadlock.</li>
</ul></li>
<li>Languages now offer programmers high-level constructs and types to
ease the challenges of multithreaded programming.
<ul class="org-ul">
<li>But sometimes a simple mutex is still the way to go.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgbc56342" class="outline-5">
<h5 id="orgbc56342">Native versus green threads, and the Global Interpreter Lock (GIL)</h5>
<div class="outline-text-5" id="text-orgbc56342">
<ul class="org-ul">
<li>A 'native thread' is under kernel OS control when it comes to
scheduling.
<ul class="org-ul">
<li>Since roughly 2000, Java Thread instances map to 'native'
threads. (Same for C#.)</li>
<li>C's 'pthreads' (the 'p' for POSIX API standardization) are
'native' threads.</li>
</ul></li>
<li>A 'green thread' (aka 'microthread', 'tasklet') is under a particular language's runtime control.
<ul class="org-ul">
<li>In effect, 'green threads' emulate native threads, and may provide
better performance for operations such as thread creation and
synchronization.</li>
<li>Prior to version 1.9, for example, Ruby's standard implementation (CRuby) had only green threads.</li>
</ul></li>
<li>A GIL is a mechanism (in implementation, a mutex) that a runtime
uses to allow only one thread to execute at a time, even in a
multithreaded environment: no thread-level parallelism.
<ul class="org-ul">
<li>The standard implementations of Ruby (CRuby) and Python (CPython) have a GIL.</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgbe9f3e7" class="outline-4">
<h4 id="orgbe9f3e7">Exercise for basic multithreading</h4>
<div class="outline-text-4" id="text-orgbe9f3e7">
<ul class="org-ul">
<li>Fix the RaceC program (RaceC.java) by providing explicit locking.
<ul class="org-ul">
<li>Use synchronized blocks and a shared lock to ensure that threads
t1 and t2 do the increment and decrement operations 'atomically'
(that is, without interruption).'</li>
<li><b>Hint:</b> use a static field as the lock to ensure there's a single instance of the lock.</li>
</ul></li>
<li><p>
To get a sense of what thread syncrhonization costs, time the RaceC
program with and without thread synchronization.
</p>
<ul class="org-ul">
<li>The program's execution can be timed in various ways, including the way sketched below:</li>
</ul>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #0000FF;">final</span> <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">startTime</span> = System.currentTimeMillis<span style="color: #707183;">()</span>;
<span style="color: #036A07;">/*** code to be timed ***/</span>
<span style="color: #0000FF;">final</span> <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">stopTime</span> = System.currentTimeMillis<span style="color: #707183;">()</span>;
<span style="color: #0000FF;">final</span> <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">latency</span> = stopTime - startTime;</pre>
</pre>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org489d750" class="outline-3">
<h3 id="org489d750">Multithreading Through Richer Code Examples</h3>
<div class="outline-text-3" id="text-org489d750">
<p>
Chapter 6
</p>
</div>
</div>
<div id="outline-container-org4297020" class="outline-3">
<h3 id="org4297020">Thread-Safety And High-Level Concurrent Types In Java</h3>
<div class="outline-text-3" id="text-org4297020">
<p>
Chapter 7 
</p>
</div>
</div>
<div id="outline-container-org6012d96" class="outline-3">
<h3 id="org6012d96">Options For Thread Synchronization And Cooperation</h3>
<div class="outline-text-3" id="text-org6012d96">
<p>
Chapter 8
</p>
</div>
</div>
<div id="outline-container-orgef1f8e5" class="outline-3">
<h3 id="orgef1f8e5">Concurrency And Non-Blocking I-O</h3>
<div class="outline-text-3" id="text-orgef1f8e5">
<p>
Chapter 9
</p>
</div>
</div>
</div>

<div id="outline-container-orgfe08862" class="outline-2">
<h2 id="orgfe08862">Parallele Algorithmen</h2>
<div class="outline-text-2" id="text-orgfe08862">
</div>
<div id="outline-container-org2bbca4d" class="outline-3">
<h3 id="org2bbca4d">Parallelism Basics</h3>
<div class="outline-text-3" id="text-org2bbca4d">
</div>
<div id="outline-container-org0fc4f94" class="outline-4">
<h4 id="org0fc4f94">Overview of Parallelism Beyond Concurrency</h4>
<div class="outline-text-4" id="text-org0fc4f94">
<p>
Parallelism in computing
</p>

<ul class="org-ul">
<li>So far the emphasis has been on parallelism as concurrency made
efficient: multiple concurrent tasks are distributed among
processors so that the tasks can be processed literally at the same
time&#x2013;in parallel.</li>
<li>In a multiprocessing approach to concurrency, multiple processes
execute on multiple processors.
<ul class="org-ul">
<li>The OS handles the scheduling.</li>
</ul></li>
<li>In a multithreading approach to concurrency, multiple threads within a process execute on multiple processors.
<ul class="org-ul">
<li>If API threads map to 'native' threads, then the OS handles the scheduling. (Assuming no GIL.)</li>
</ul></li>
<li>In hybrid approaches (e.g., Asp.Net's multithreaded worker
processes), there's still the distribution of task processing among
multiple processors.</li>
</ul>

<p>
The goal now is to focus on broader uses of parallel computation.
</p>

<ul class="org-ul">
<li>Some reasons why parallelism is now so attractive:
<ul class="org-ul">
<li>Consumer desktop, laptop, and even handheld machines are now
multi-core, with one or more processors per core.
<ul class="org-ul">
<li>In fact (even if not in reputation), these machines are 'parallel computers'.</li>
<li>At issue is how to exploit this possibily for parallel computations.</li>
</ul></li>
<li>Consumer-level machines may come with GPUs (graphics-processing
units) and FPUs (floating-point unit or 'math coproccessor') as
well as CPUs (central or 'generic' processing units).
<ul class="org-ul">
<li>GPUs and FPUs are designed for parallelism.</li>
<li>'gpgpu' (general-purpose computing on a GPU) refers to the use
of a GPU for 'general purposes', that is, purposes beyond just
graphics. So gpgpu approaches a GPU as if it were a
(specialized) CPU.</li>
</ul></li>
<li>Distributed software systems such as email and the WWW have code
modules that execute on physically distinct devices.
<ul class="org-ul">
<li>The 'network as the computer' describes networked hosts, each
with its own collection of processors, as a resource for
distributed parallel computation.</li>
<li>The key challenge is how to coordinate such computations and to share information among them.
<ul class="org-ul">
<li>Message-passing is a popular, general method.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Parallel computations may used shared, centralized memory;
distributed memory; or some hybrid of the two.
<ul class="org-ul">
<li>The point of interest is how to write programs that execute as
parallel computations.</li>
<li>Support from toolchains (in particular, compilers therein) is
critical to encouarge widespread use of hardware support for
parallel computing.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org9bb45b6" class="outline-4">
<h4 id="org9bb45b6">A SIMD Auto Vectorization Code Example in C</h4>
<div class="outline-text-4" id="text-org9bb45b6">
</div><div id="outline-container-org0095232" class="outline-5">
<h5 id="org0095232">the non parallel version</h5>
<div class="outline-text-5" id="text-org0095232">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">To compile and run:</span>

<span style="color: #8D8D84; font-style: italic;">    gcc -o nonsimd nonsimd.c</span>
<span style="color: #8D8D84; font-style: italic;">    ./nonsimd  # On Windows: simd</span>
<span style="color: #8D8D84;">*/</span>
  
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">Length</span> 8

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">array1</span><span style="color: #7388D6;">[</span> <span style="color: #7388D6;">]</span> = <span style="color: #7388D6;">{</span>1, 2, 3, 4, 5, 6, 7, 8<span style="color: #7388D6;">}</span>; 
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">array2</span><span style="color: #7388D6;">[</span> <span style="color: #7388D6;">]</span> = <span style="color: #7388D6;">{</span>8, 7, 6, 5, 4, 3, 2, 1<span style="color: #7388D6;">}</span>;
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">sum</span><span style="color: #7388D6;">[</span>Length<span style="color: #7388D6;">]</span>;

  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> sum<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = array1<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> + array2<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span>; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">serial computation *</span><span style="color: #8D8D84;">*/</span>
  
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%i "</span>, sum<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>; 
  putchar<span style="color: #7388D6;">(</span><span style="color: #008000;">'\n'</span><span style="color: #7388D6;">)</span>;
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span>
<span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">A better way: SSE = Streaming SIMD Extensions = additional instruction set, </span>
<span style="color: #8D8D84; font-style: italic;">    more CPU registers</span>

<span style="color: #8D8D84; font-style: italic;">In the late 1990s, Intel introduced an SSE instruction set for their Pentium III</span>
<span style="color: #8D8D84; font-style: italic;">processors. This became known as the MMX instruction set. (Officially, MMX is not an</span>
<span style="color: #8D8D84; font-style: italic;">acronym.) AMD earlier introduced a comparable instruction set known as 3DNow!. In any case, </span>
<span style="color: #8D8D84; font-style: italic;">the hardware support included new registers with names that start with 'xmm'. In the </span>
<span style="color: #8D8D84; font-style: italic;">original SSE, there was support only for integer operations.</span>

<span style="color: #8D8D84; font-style: italic;">SEE has progressed, with new versions: SSE2, SSE3, SSSE3, and</span>
<span style="color: #8D8D84; font-style: italic;">SSE4. The newer versions bring SIMD support for both integer and</span>
<span style="color: #8D8D84; font-style: italic;">floating-point operations. At the same time, C/C++ compilers such as</span>
<span style="color: #8D8D84; font-style: italic;">GNU and Clang provided support, eventually automatic, for</span>
<span style="color: #8D8D84; font-style: italic;">SIMD-friendly code. Nowadays, both compilers are capable of 'automatic</span>
<span style="color: #8D8D84; font-style: italic;">vectorization' of approrpiately written source code.</span>

<span style="color: #8D8D84; font-style: italic;">The short version: elements in the arrays 'array1' and 'array2' should</span>
<span style="color: #8D8D84; font-style: italic;">be added pairwise in parallel in order to boost performance.</span>
<span style="color: #8D8D84;">*/</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf614685" class="outline-5">
<h5 id="orgf614685">the parallel version</h5>
<div class="outline-text-5" id="text-orgf614685">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">To compile and run:</span>

<span style="color: #8D8D84; font-style: italic;">    gcc -o simd simd.c</span>
<span style="color: #8D8D84; font-style: italic;">    ./simd  # On Windows: simd</span>

<span style="color: #8D8D84; font-style: italic;"> No explicit optimization is required. The GNU and Clang compilers</span>
<span style="color: #8D8D84; font-style: italic;"> do the optimization automatically. </span>
<span style="color: #8D8D84;">*/</span>
  
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">A typedef in C supports 'aliasing' of data types. Here's a simple example:</span>

<span style="color: #8D8D84; font-style: italic;">     typedef unsigned boolean; ## 'unsigned' is short for 'unsigned int'</span>

<span style="color: #8D8D84; font-style: italic;">   This typedef allows 'boolean' to be used in place of 'unsigned', for example:</span>

<span style="color: #8D8D84; font-style: italic;">     boolean flag = 0;  ## 0 is 'false' in C</span>

<span style="color: #8D8D84; font-style: italic;">   The typedef below is more complicated, as it includes special information for the</span>
<span style="color: #8D8D84; font-style: italic;">   compiler, in particuar the '__attribute__' and 'vector_size' terms. Here's the upshot</span>
<span style="color: #8D8D84; font-style: italic;">   of the typedef:</span>

<span style="color: #8D8D84; font-style: italic;">   # 'intV8' aliases 'int', but as a vector (1-dimensional array) rather than as a scalar </span>
<span style="color: #8D8D84; font-style: italic;">      type.</span>
<span style="color: #8D8D84; font-style: italic;">   # The size of an 'intV8' vector is set to 32 == Length * sizeof(int) == 8 * 4. </span>
<span style="color: #8D8D84; font-style: italic;">     The size is in bytes.</span>
<span style="color: #8D8D84;">*/</span>
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">Length</span> 8
<span style="color: #0000FF;">typedef</span> <span style="color: #6434A3;">int</span> <span style="color: #6434A3;">intV8</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>vector_size <span style="color: #909183;">(</span><span style="color: #6434A3;">Length</span> * <span style="color: #0000FF;">sizeof</span><span style="color: #709870;">(</span><span style="color: #6434A3;">int</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">32 bytes *</span><span style="color: #8D8D84;">*/</span>
    
<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">dataV1</span> = <span style="color: #7388D6;">{</span>1, 2, 3, 4, 5, 6, 7, 8<span style="color: #7388D6;">}</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">initialize vector dataV1: no array syntax </span><span style="color: #8D8D84;">*/</span>                   
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">dataV2</span> = <span style="color: #7388D6;">{</span>8, 7, 6, 5, 4, 3, 2, 1<span style="color: #7388D6;">}</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">same for vector dataV2 </span><span style="color: #8D8D84;">*/</span>
  
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">add</span> = dataV1 + dataV2; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">9  9  9  9  9  9  9 9 -- no array syntax </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">mul</span> = dataV1 * dataV2; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">8 14 18 20 20 18 14 8 -- no array syntax </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">intV8</span> <span style="color: #BA36A5;">div</span> = dataV2 / dataV1; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">8  3  2  1  0  0  0 0 -- no array syntax </span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%i "</span>, add<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>; <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">array syntax </span><span style="color: #8D8D84;">*/</span>
  putchar<span style="color: #7388D6;">(</span><span style="color: #008000;">'\n'</span><span style="color: #7388D6;">)</span>;
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5820cb3" class="outline-4">
<h4 id="org5820cb3">using the shell</h4>
<div class="outline-text-4" id="text-org5820cb3">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ gcc -o nonsimd nonsimd.c
bash-3.2$ gcc -o simd simd.c

bash-3.2$ ./nonsimd
9 9 9 9 9 9 9 9 

bash-3.2$ ./simd
9 9 9 9 9 9 9 9 </pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org05c1dc9" class="outline-4">
<h4 id="org05c1dc9">in Assembly-Code</h4>
<div class="outline-text-4" id="text-org05c1dc9">
<p>
Some compiler-generated assembly code from the simd.c program
</p>
<pre class="example">
# A note on C compilation:

                 +------------+    +--------+    +---------+    +------+
C source code---&gt;|preprocessor|---&gt;|compiler|---&gt;|assembler|---&gt;|linker|---&gt;executable 	
                 +------------+    +--------+ /  +---------+ /  +------+    machine code
                                             /              /
                                        assembly code    object code

## Compile command: gcc -S simd.c  (produces 'simd.s' by default)	
	
main:
   ## The identifiers that start with $ are constants.
	
   ## %rsp is the 'stack pointer', which points to the TOP position on the stack.
	
   ## An expression such as 96(%rsp) is an address or pointer expression: %rsp is the base 
      address, 96 is of the offset therefrom. The offset is in bytes, so in this case it's 
      96 bytes. (The Intel stack grows downwards, from high to low addresses.)

   ## The full expression 'movl $1, 96(%rsp)' copies (not literally moves) the 32-bit value 
      1 into stack location %rsp + 96:

	The stack
	  ...                     ## high addresses
	+-----+
	|  1  |&lt;------%rsp + 96   ## instruction 'movl $l, 96(%rsp)' puts 1 in this location
        +-----+
	  ...                
	+-----+
	|     |
	+-----+
	|     |&lt;------%rsp   ## %rsp is the 64-bit 'stack pointer'
	+-----+
	  ...                     ## low addresses
	
   ## Note that every offset increases by 4 because the values (1,2,3,...) are 4-byte 
      (32-bit) integer values.
   movl $1, 96(%rsp)         # data vector 1 start
   movl $2, 100(%rsp)
   movl $3, 104(%rsp)
   movl $4, 108(%rsp)
   movl $5, 112(%rsp)
   movl $6, 116(%rsp)
   movl $7, 120(%rsp)
   movl $8, 124(%rsp)        # data vector 1 end
   movl $8, 128(%rsp)        # data vector 2 start
   movl $7, 132(%rsp)
   movl $6, 136(%rsp)
   movl $5, 140(%rsp)
   movl $4, 144(%rsp)
   movl $3, 148(%rsp)
   movl $2, 152(%rsp)
   movl $1, 156(%rsp)        # data vector 2 end
	
   movdqa 96(%rsp), %xmm1    # %xmm1 = dataV1[0..3]: 'dq' is for 'double quadword'
	                     # (quad == 64 bits) and %xmm1 is a 128-bit register
	
   movdqa 128(%rsp), %xmm0   # %xmm0 = dataV2[0..3]
	
   paddd %xmm0, %xmm1        # %xmm1 += %xmm0 (the 'paddd' instruction is for 'packed 
                               addition' of 32-bit values)
   movdqa 112(%rsp), %xmm2   # %xmm2 = dataV1[4..7]
   movdqa 144(%rsp), %xmm0   # %xmm0 = dataV2[4..7]
   paddd %xmm2, %xmm0        # %xmm0 += %xmm2
	
   movdqa %xmm1, 32(%rsp)    # save %xmm1 to stack (sums of the 1st four elements)
   movdqa %xmm0, 48(%rsp)    # save %xmm0 to stack (sums of the last four elements)
	                     # the sum is now on the stack contiguously, in effect as an array
   ...

</pre>
</div>
</div>
</div>
<div id="outline-container-org7794dfe" class="outline-3">
<h3 id="org7794dfe">Time the Performance Boost From Parallelism &#x2013; a Code Example</h3>
<div class="outline-text-3" id="text-org7794dfe">
</div>
<div id="outline-container-org78bc808" class="outline-4">
<h4 id="org78bc808">Source Code</h4>
<div class="outline-text-4" id="text-org78bc808">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">A timing example to contrast serial and parallel execution on typical matrix/vector </span>
<span style="color: #8D8D84; font-style: italic;">    operations. The program uses 'SSE intrinsics', the interface for which is the header </span>
<span style="color: #8D8D84; font-style: italic;">    file 'xmmintrin.h'.</span>
<span style="color: #8D8D84; font-style: italic;">    </span>
<span style="color: #8D8D84; font-style: italic;">    Some of the code is obscure, a good sign of what's involved as you get ever closer </span>
<span style="color: #8D8D84; font-style: italic;">    to the metal.</span>

<span style="color: #8D8D84; font-style: italic;">    The program adds two vectors, and then multiples the rows of the sum vector by a </span>
<span style="color: #8D8D84; font-style: italic;">    +third vector.</span>
<span style="color: #8D8D84; font-style: italic;">*</span><span style="color: #8D8D84;">*/</span>

<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdio.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">xmmintrin.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">stdint.h</span><span style="color: #707183;">&gt;</span>

<span style="color: #0000FF;">typedef</span> <span style="color: #6434A3;">void</span> <span style="color: #707183;">(</span>*<span style="color: #6434A3;">func</span><span style="color: #707183;">)()</span>;  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">a function that takes no arguments and returns void *</span><span style="color: #8D8D84;">*/</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">Length</span>      <span style="color: #707183;">(</span>2048<span style="color: #707183;">)</span>
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">AlignedVals</span>    <span style="color: #707183;">(</span>4<span style="color: #707183;">)</span>

 <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">Ensure 16-byte alignment of vector elements: 16 bytes is 4 ints or 4 floats,</span>
<span style="color: #8D8D84; font-style: italic;">     which comes to 128 bits--the size of an %xmm register. *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">v1</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>; 
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">v2</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">v3</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">r1</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #6434A3;">float</span> <span style="color: #BA36A5;">r2</span><span style="color: #707183;">[</span>Length<span style="color: #707183;">]</span> <span style="color: #0000FF;">__attribute__</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>aligned<span style="color: #909183;">(</span>16<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">Initialize with small random values. *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #6434A3;">void</span> <span style="color: #006699;">init</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
    v1<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">float</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>rand<span style="color: #709870;">()</span> / RAND_MAX<span style="color: #909183;">)</span>; 
    v2<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">float</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>rand<span style="color: #709870;">()</span> / RAND_MAX<span style="color: #909183;">)</span>;  
    v3<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">float</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>rand<span style="color: #709870;">()</span> / RAND_MAX<span style="color: #909183;">)</span>; 
  <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">void</span> <span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i = 0; i &lt; Length; i++<span style="color: #7388D6;">)</span> r1<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = <span style="color: #7388D6;">(</span>v1<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> + v2<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span> * v3<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span>; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">the math *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">void</span> <span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">set up for the special vector instructions *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_v1</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> v1; 
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_v2</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> v2;
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_v3</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> v3;
  <span style="color: #6434A3;">__m128</span>* <span style="color: #BA36A5;">mm_rv</span> = <span style="color: #7388D6;">(</span><span style="color: #6434A3;">__m128</span>*<span style="color: #7388D6;">)</span> r2;

  <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">Multiply a vector row by a vector: the outer instruction is _mm_mul_ps. </span>
<span style="color: #8D8D84; font-style: italic;">      _mm_add_ps adds vector elements.</span>
<span style="color: #8D8D84; font-style: italic;">   *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">i</span>;
  <span style="color: #6434A3;">unsigned</span> <span style="color: #BA36A5;">n</span> = Length / AlignedVals; <span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">in this case, n == 512 *</span><span style="color: #8D8D84;">*/</span>
  <span style="color: #0000FF;">for</span><span style="color: #7388D6;">(</span> i = 0; i &lt; n; i++<span style="color: #7388D6;">)</span> mm_rv<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = _mm_mul_ps<span style="color: #7388D6;">(</span>_mm_add_ps<span style="color: #909183;">(</span>mm_v1<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>, mm_v2<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>, mm_v3<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #8D8D84;">/** </span><span style="color: #8D8D84; font-style: italic;">from the Intel developer's guide: in-line assembly for reasonably good timings *</span><span style="color: #8D8D84;">*/</span>
<span style="color: #6434A3;">uint64_t</span> <span style="color: #006699;">rdtsc</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #6434A3;">uint32_t</span> <span style="color: #BA36A5;">lo</span>, <span style="color: #BA36A5;">hi</span>;
    <span style="color: #0000FF;">__asm__</span> __volatile__ <span style="color: #7388D6;">(</span>
      <span style="color: #008000;">"xorl %%eax, %%eax\n"</span>
      <span style="color: #008000;">"cpuid\n"</span>
      <span style="color: #008000;">"rdtsc\n"</span>
      : <span style="color: #008000;">"=a"</span> <span style="color: #909183;">(</span>lo<span style="color: #909183;">)</span>, <span style="color: #008000;">"=d"</span> <span style="color: #909183;">(</span>hi<span style="color: #909183;">)</span>
      :
      : <span style="color: #008000;">"%ebx"</span>, <span style="color: #008000;">"%ecx"</span><span style="color: #7388D6;">)</span>;
    <span style="color: #0000FF;">return</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">uint64_t</span><span style="color: #7388D6;">)</span> hi &lt;&lt; 32 | lo;
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">void</span> <span style="color: #006699;">time_it</span><span style="color: #707183;">(</span><span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">msg</span>, <span style="color: #6434A3;">func</span> <span style="color: #BA36A5;">func2run</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  <span style="color: #6434A3;">unsigned</span> <span style="color: #6434A3;">long</span> <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">start</span>, <span style="color: #BA36A5;">stop</span>;
  start = rdtsc<span style="color: #7388D6;">()</span>;
  func2run<span style="color: #7388D6;">()</span>;
  stop = rdtsc<span style="color: #7388D6;">()</span>;
  printf<span style="color: #7388D6;">(</span><span style="color: #008000;">"%s: %lld\n"</span>, msg, stop - start<span style="color: #7388D6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
  init<span style="color: #7388D6;">()</span>;
  time_it<span style="color: #7388D6;">(</span><span style="color: #008000;">"in_serial()  "</span>, in_serial<span style="color: #7388D6;">)</span>;
  time_it<span style="color: #7388D6;">(</span><span style="color: #008000;">"in_parallel()"</span>, in_parallel<span style="color: #7388D6;">)</span>;
  <span style="color: #0000FF;">return</span> 0;
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd4eb585" class="outline-4">
<h4 id="orgd4eb585">using the shell</h4>
<div class="outline-text-4" id="text-orgd4eb585">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ gcc -o sseTimings sseTimings.c
bash-3.2$ ./sseTimings
<span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span>  : 19905
<span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span>: 10483
bash-3.2$ ./sseTimings
<span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span>  : 22260
<span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span>: 11319
bash-3.2$ ./sseTimings
<span style="color: #006699;">in_serial</span><span style="color: #707183;">()</span>  : 21785
<span style="color: #006699;">in_parallel</span><span style="color: #707183;">()</span>: 10957</pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgec0c38f" class="outline-3">
<h3 id="orgec0c38f">OpenMp</h3>
<div class="outline-text-3" id="text-orgec0c38f">
</div>
<div id="outline-container-org934c3d1" class="outline-4">
<h4 id="org934c3d1">Overview</h4>
</div>
<div id="outline-container-orgb0db8de" class="outline-4">
<h4 id="orgb0db8de">Basics</h4>
</div>
<div id="outline-container-org70391ed" class="outline-4">
<h4 id="org70391ed">Miser-Spendthrift Problem</h4>
</div>
</div>
<div id="outline-container-org9196d5c" class="outline-3">
<h3 id="org9196d5c">Parallelism and Performance</h3>
<div class="outline-text-3" id="text-org9196d5c">
</div>
<div id="outline-container-org6c8dcc2" class="outline-4">
<h4 id="org6c8dcc2">How Can Performance Gains Through Parallelism Be Measured</h4>
<div class="outline-text-4" id="text-org6c8dcc2">
<p>
Parallelism and performance
</p>

<ul class="org-ul">
<li>Revised 'sseTimings' program, now in 3 versions: 'timings2048',
'timings8192', and 'timings32768':
<ul class="org-ul">
<li>Average speedup of 'serial' version from 20 test runs:<br />
'timings2048':  average speedup of 2.17    ## 2048 is vector size<br />
'timings8192':  average speedup of 1.72    ##  8192 <code>= 2048 x 4\\
       'timings32768': average speedup of 1.65    ## 32768 =</code> 8192 x 4</li>
<li>Key question: The 'in<sub>parallel</sub>()' function does only 1/4th the
arithmetic operations as the 'in<sub>serial</sub>()' function. Why is max
speedup above only slightly over 2 rather than close to (or even
at) 4?</li>
</ul></li>
</ul>
<hr />
<ul class="org-ul">
<li>How to measure performance?
<ul class="org-ul">
<li>Response time ('latency'): elapsed time
<ul class="org-ul">
<li>Program P1 takes 10 units, whereas program P2 takes 5: P1/P2 =
2, a speedup of 2</li>
</ul></li>
<li>Throughput: number of tasks completed in a fixed amount of time.
<ul class="org-ul">
<li><p>
On single-processor machine M1, with required times for processing above the arrows:
</p>
<pre class="example">
    5       3   +-----------+
T2-----&gt;T1-----&gt;| processor |  ## Two tasks completed in 8 time units on M1
                +-----------+
</pre></li>
<li><p>
On multiple-processor machine M2:
</p>
<pre class="example">
   5   +-----------+
T1-----&gt;| processor | ## T1 takes a bit longer on M2
       +-----------+
               ## Two tasks completed in 5 time units on M2, a speedup of about 1.6
   5   +-----------+
T2-----&gt;| processor | ## T2 takes the same amount of time on M1 and M2
       +-----------+
</pre></li>
</ul></li>
<li>Big picture: parallelism is a good way to boost performance
<ul class="org-ul">
<li>Parallelism tends to increase throughput, and thereby performance.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org89236ab" class="outline-4">
<h4 id="org89236ab">The ParallelSort Program in Java</h4>
<div class="outline-text-4" id="text-org89236ab">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #036A07;">/** A Java program to illustrate the potential speedup of parallelism, in this</span>
<span style="color: #036A07;">    case for sorting: the program uses the new (as of Java 8) Arrays.parallelSort</span>
<span style="color: #036A07;">    method, and also the Arrays.parallelSetAll method for parallel initialization</span>
<span style="color: #036A07;">    of the roughly 4M array of integers.</span>

<span style="color: #036A07;">    As noted, Java 8 or greater is requied.</span>
<span style="color: #036A07;">*/</span>
<span style="color: #0000FF;">import</span> <span style="color: #D0372D;">java</span>.<span style="color: #D0372D;">util</span>.<span style="color: #6434A3;">Random</span>;
<span style="color: #0000FF;">import</span> <span style="color: #D0372D;">java</span>.<span style="color: #D0372D;">util</span>.<span style="color: #6434A3;">Arrays</span>;

<span style="color: #0000FF;">public</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">ParallelSort</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">int</span><span style="color: #7388D6;">[</span> <span style="color: #7388D6;">]</span> <span style="color: #BA36A5;">array2Sort</span>;
    
    <span style="color: #0000FF;">public</span> <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">String</span><span style="color: #909183;">[</span> <span style="color: #909183;">]</span> <span style="color: #BA36A5;">args</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">ParallelSort</span><span style="color: #909183;">()</span>.doIt<span style="color: #909183;">()</span>;
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">doIt</span><span style="color: #7388D6;">()</span> <span style="color: #7388D6;">{</span>
        <span style="color: #0000FF;">final</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">arraySize</span> = 1024 * 1024 * 4;  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">about 4M: 4,194,304     /** line 1 **/</span>

        <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">** serial sort</span>
        init<span style="color: #909183;">(</span>arraySize<span style="color: #909183;">)</span>;
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">serial</span> = sortArray<span style="color: #909183;">(</span>array2Sort, <span style="color: #D0372D;">false</span><span style="color: #909183;">)</span>;                        <span style="color: #036A07;">/** line 2 **/</span>

        <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">** parallel sort</span>
        init<span style="color: #909183;">(</span>arraySize<span style="color: #909183;">)</span>;
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">parallel</span> = sortArray<span style="color: #909183;">(</span>array2Sort, <span style="color: #D0372D;">true</span><span style="color: #909183;">)</span>;                       <span style="color: #036A07;">/** line 3 **/</span>

        <span style="color: #8D8D84;">//</span><span style="color: #8D8D84; font-style: italic;">** report</span>
        log<span style="color: #909183;">(</span><span style="color: #008000;">"Serial sort of array of size:   "</span> + arraySize<span style="color: #909183;">)</span>;
        log<span style="color: #909183;">(</span><span style="color: #008000;">"Elapsed time: "</span> + serial<span style="color: #909183;">)</span>;
        log<span style="color: #909183;">(</span><span style="color: #008000;">""</span><span style="color: #909183;">)</span>;

        log<span style="color: #909183;">(</span><span style="color: #008000;">"Parallel sort of array of size: "</span> + arraySize<span style="color: #909183;">)</span>; 
        log<span style="color: #909183;">(</span><span style="color: #008000;">"Elapsed time: "</span> + parallel<span style="color: #909183;">)</span>;

        log<span style="color: #909183;">(</span><span style="color: #008000;">""</span><span style="color: #909183;">)</span>;
        <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">ratio</span> = <span style="color: #909183;">(</span><span style="color: #6434A3;">double</span><span style="color: #909183;">)</span> serial / <span style="color: #909183;">(</span><span style="color: #6434A3;">double</span><span style="color: #909183;">)</span> parallel;
        <span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span>parallel &lt; <span style="color: #6434A3;">serial</span><span style="color: #909183;">)</span> 
            log<span style="color: #909183;">(</span><span style="color: #008000;">"Speedup:  "</span> + ratio<span style="color: #909183;">)</span>;
        <span style="color: #0000FF;">else</span>
            log<span style="color: #909183;">(</span><span style="color: #008000;">"Slowdown: "</span> + ratio<span style="color: #909183;">)</span>;
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">init</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">size</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        array2Sort = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">int</span><span style="color: #909183;">[</span>size<span style="color: #909183;">]</span>;
        <span style="color: #036A07;">/** parallel initialization of array elements **/</span>
        Arrays.parallelSetAll<span style="color: #909183;">(</span>array2Sort,                                  <span style="color: #036A07;">/** line 4 **/</span> 
                              i-&gt;<span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Random</span><span style="color: #709870;">()</span>.nextInt<span style="color: #709870;">()</span><span style="color: #909183;">)</span>;                  <span style="color: #036A07;">/** line 5 **/</span>
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">long</span> <span style="color: #006699;">sortArray</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">int</span><span style="color: #909183;">[</span> <span style="color: #909183;">]</span> <span style="color: #BA36A5;">array</span>, <span style="color: #6434A3;">boolean</span> <span style="color: #BA36A5;">parallel</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">start</span> = System.currentTimeMillis<span style="color: #909183;">()</span>;
        <span style="color: #036A07;">/** parallel version of merge-sort **/</span>
        <span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span>parallel<span style="color: #909183;">)</span> Arrays.parallelSort<span style="color: #909183;">(</span>array<span style="color: #909183;">)</span>;                          <span style="color: #036A07;">/** line 6 **/</span>
        <span style="color: #036A07;">/** variant of quicksort ('dual pivot') **/</span>
        <span style="color: #0000FF;">else</span> Arrays.sort<span style="color: #909183;">(</span>array<span style="color: #909183;">)</span>;                                           <span style="color: #036A07;">/** line 7 **/</span>
        <span style="color: #6434A3;">long</span> <span style="color: #BA36A5;">stop</span> = System.currentTimeMillis<span style="color: #909183;">()</span>;
        <span style="color: #0000FF;">return</span> stop - start;
    <span style="color: #7388D6;">}</span>
    <span style="color: #0000FF;">private</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">log</span><span style="color: #7388D6;">(</span><span style="color: #6434A3;">String</span> <span style="color: #BA36A5;">msg</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
        System.out.println<span style="color: #909183;">(</span>msg<span style="color: #909183;">)</span>;
    <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
<div id="outline-container-org6fc9ae2" class="outline-5">
<h5 id="org6fc9ae2">using the shell</h5>
<div class="outline-text-5" id="text-org6fc9ae2">
<div class="org-src-container">
<pre class="src src-sh">bash-3.2$ java ParallelSort
Serial sort of array of size:   4194304
Elapsed time: 824

Parallel sort of array of size: 4194304
Elapsed time: 358

Speedup:  2.3016759776536313
bash-3.2$ java ParallelSort
Serial sort of array of size:   4194304
Elapsed time: 710

Parallel sort of array of size: 4194304
Elapsed time: 258

Speedup:  2.751937984496124
bash-3.2$ java ParallelSort
Serial sort of array of size:   4194304
Elapsed time: 807

Parallel sort of array of size: 4194304
Elapsed time: 295

Speedup:  2.7355932203389832</pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd0c2a9f" class="outline-4">
<h4 id="orgd0c2a9f">Amdahls Law by Example</h4>
<div class="outline-text-4" id="text-orgd0c2a9f">
<p>
A quick look at Amdahl's Law
</p>

<ul class="org-ul">
<li>The law, named after its creator (a one-time IBM engineer who
founded a IBM rival company), sets a theoretical limit on the
speedup that can be achieved in a computation.
<ul class="org-ul">
<li>The law has the practical benefit of sharpening intuitions about
how speedup should be pursued.</li>
</ul></li>
<li>A sample problem for Amdahl's law: 
<ul class="org-ul">
<li>Compute the arithmetic mean of 4M floating-point values on
single-processor machine M1.  Call this problem P.</li>
<li>Compute the speedup of porting the solution to quad-processor
machine M4.
<ul class="org-ul">
<li>Assume that M1 and M4 differ only in the number of processors.</li>
</ul></li>
</ul></li>
<li>A step-by-step application of the law:
<ol class="org-ol">
<li>Compute response time for P on M1: \(RT1\)</li>
<li>Compute response time for P on M4: \(RT4\)</li>
<li>Computer the ratio: \(RT1/RT4\)
<ul class="org-ul">
<li>If \(\frac{RT1}{RT4} = 1\), the response times are the same: no difference between M1 and M4 performance.</li>
<li>If \(\frac{RT1}{RT4} < 1\), there's slowdown rather than speedup.</li>
<li>If \(\frac{RT1}{RT4} > 1\), there's speedup.</li>
</ul></li>
<li>Normalize \(RT1\) to 1 time unit: keeps things simple.</li>
<li>Break \(RT4\) into two parts: 
<ul class="org-ul">
<li>\(enchanced\): in this case, parallel and</li>
<li>\(unenhanced\): in this case, serial</li>
<li>The \(unenhanced\) part of \(RT4\) is the part still done in serial
mode &#x2013; no benefit of parallelism.
<ul class="org-ul">
<li>The data set needs to be partitioned, assigned to workers
(threads or processes), the results from the workers need to
be aggregated, etc.</li>
</ul></li>
<li>The \(enhanced\) part of \(RT4\) is the part that benefits from the
speedup due to parallelism.</li>
<li>\[Speedup = \frac{RT1}{RT4} = \frac{1}{unenhanced + enhanced}\]</li>
<li>The \(enhanced\) depends on two factors: what fraction of time is
sped up, and by what amount.  How much time does M4 speed in
'parallel mode' when solving P, and how much faster is M4 in
'parallel mode' than M1 in serial mode?</li>
<li>Assume M4 is four times faster than M1 when M4 is in 'parallel
mode', and that M4 is in 'parallel mode' 80% of the time when
solving P.</li>
<li>\[Speedup = \frac{RT1}{RT4} = \frac{1}{unenhanced + enhanced} = \frac{1}{0.2 + \frac{0.8}{4.0}} = 2.5\]</li>
<li>Under the given assumptions, M4 solves P 2.5 times faster than does M1.</li>
</ul></li>
</ol></li>
<li>The big picture of Amdahal's Law:
<ul class="org-ul">
<li>It's tempting to be distracted by how much faster a 'local
speedup' is: M4 is four times faster than M1 when M4 is in
'parallel mode'.</li>
<li>It's critical to focus on the fraction of time spent in enhanced
mode: M4 is in 'parallel mode' 80% of the time&#x2013;not 100% of time.</li>
</ul></li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Machine</th>
<th scope="col" class="org-right">Fraction in local speedup</th>
<th scope="col" class="org-right">Local speedup</th>
<th scope="col" class="org-right">Global speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">M4</td>
<td class="org-right">0.8</td>
<td class="org-right">4.0</td>
<td class="org-right">2.5</td>
</tr>

<tr>
<td class="org-left">M8</td>
<td class="org-right">0.7</td>
<td class="org-right">8.0</td>
<td class="org-right">2.6</td>
</tr>

<tr>
<td class="org-left">M12</td>
<td class="org-right">0.6</td>
<td class="org-right">12.0</td>
<td class="org-right"><b>2.2</b></td>
</tr>

<tr>
<td class="org-left">M16</td>
<td class="org-right">0.5</td>
<td class="org-right">16.0</td>
<td class="org-right">1.9</td>
</tr>

<tr>
<td class="org-left">M20</td>
<td class="org-right">0.4</td>
<td class="org-right">20.0</td>
<td class="org-right">1.6</td>
</tr>

<tr>
<td class="org-left">M24</td>
<td class="org-right">0.3</td>
<td class="org-right">24.0</td>
<td class="org-right">1.4</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orga50ad8e" class="outline-4">
<h4 id="orga50ad8e">Programming exercise for parallelism/performance</h4>
<div class="outline-text-4" id="text-orga50ad8e">
<ul class="org-ul">
<li>More data gathering and reflecting on the data than coding</li>
<li>The current version calls Arrays.sort(&#x2026;) and Arrays.parallelSort(&#x2026;) on an array.
<ul class="org-ul">
<li>Array has roughly 4M array elements.</li>
<li>Speedup on the machines I tried was about 2.5 for the parallelSort.</li>
</ul></li>
<li><p>
In the interest of gathering more data, change the program so that
it tries various sizes.  For instance:
</p>
<div class="org-src-container">
<pre class="src src-java">  <span style="color: #0000FF;">final</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">initialSize</span> = 1024;
  <span style="color: #0000FF;">final</span> <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">howMany</span> = 16; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">don't go over 20 -- overflow occurs</span>
  <span style="color: #6434A3;">int</span><span style="color: #707183;">[</span> <span style="color: #707183;">]</span> <span style="color: #BA36A5;">arraySizes</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">int</span><span style="color: #707183;">[</span>howMany<span style="color: #707183;">]</span>;
  arraySizes<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = initialSize;
  <span style="color: #0000FF;">for</span> <span style="color: #707183;">(</span><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">i</span> = 1; i &lt; <span style="color: #6434A3;">howMany</span>; i++<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
      arraySizes<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span> = arraySizes<span style="color: #7388D6;">[</span>i - 1<span style="color: #7388D6;">]</span> * 2;
  <span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
Get the speedup for each of the sizes, and note any trends in speedup.
</p></li>
<li>Do the same for numeric types other than int, for instance, long, float, and double.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga5c5c40" class="outline-3">
<h3 id="orga5c5c40">Parallelism And Distributed Computing</h3>
<div class="outline-text-3" id="text-orga5c5c40">
<ul class="org-ul">
<li>Map/Reduce in Java</li>
<li>OpenMPI</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3187c9d" class="outline-2">
<h2 id="org3187c9d">weitere verwendete Literatur</h2>
<div class="outline-text-2" id="text-org3187c9d">
<ul class="org-ul">
<li><a class='org-ref-reference' href="#CACM2017">CACM2017</a></li>
<li><a class='org-ref-reference' href="#CACM2016">CACM2016</a></li>
<li><a class='org-ref-reference' href="#Subramanian2017">Subramanian2017</a></li>
</ul>
</div>
</div>
<div id="outline-container-org018d737" class="outline-2">
<h2 id="org018d737"><h2>Literaturverzeichnis</h2>
<ul class='org-ref-bib'><li><a id="Bengel2015">[Bengel2015] Günther Bengel, Christian Baun, Marcel Kunze & Karl-Uwe Stucky, Masterkurs Parallele und Verteilte Systeme, Springer Fachmedien Wiesbaden (2015).</a></li>
<li><a id="Kalin2015">[Kalin2015] Martin Kalin, Concurrent and Parallel Programming Concepts, (2015), zuletzt aufgerufen am 10.10.2017: <a href="https://www.safaribooksonline.com/library/view/concurrent-and-parallel/9781771375313/">https://www.safaribooksonline.com/library/view/concurrent-and-parallel/9781771375313/</a> </a></li>
<li><a id="Flynn1972">[Flynn1972] Flynn, Some Computer Organizations and Their Effectiveness, <i>IEEE Trans. Comput.</i>, <b>21(9)</b>, 948-960 (1972). <a href="http://dx.doi.org/10.1109/TC.1972.5009071">link</a>. <a href="http://dx.doi.org/10.1109/TC.1972.5009071">doi</a>.</a></li>
<li><a id="CACM2017">[CACM2017] Practical Parallelism, (2017), zuletzt aufgerufen am 26.09.2017: <a href="https://cacm.acm.org/careers/219104-practical-parallelism/fulltext">https://cacm.acm.org/careers/219104-practical-parallelism/fulltext</a> </a></li>
<li><a id="CACM2016">[CACM2016] Parallel Programming Made Easy, (2017), zuletzt aufgerufen am 26.09.2017: <a href="https://cacm.acm.org/careers/203794-parallel-programming-made-easy/fulltext">https://cacm.acm.org/careers/203794-parallel-programming-made-easy/fulltext</a> </a></li>
<li><a id="Subramanian2017">[Subramanian2017] Subramanian, Jeffrey, Abeydeera, Lee, Ying, Emer & Sanchez, Fractal: An Execution Model for Fine-Grain Nested Speculative Parallelism, 587-599, in in: Proceedings of the 44th Annual International Symposium on Computer Architecture, edited by ACM (2017)</a></li>
</ul></h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Johannes Brauer</p>
<p class="date">Created: 2017-10-10 Tue 12:01</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>