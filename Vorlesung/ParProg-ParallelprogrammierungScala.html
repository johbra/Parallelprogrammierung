<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de">
<head>
<!-- 2017-11-20 Mon 12:28 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parallelprogrammierung in Scala</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Johannes Brauer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<link rel="stylesheet" type="text/css" href="mycss/mystyle.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Parallelprogrammierung in Scala
<br />
<span class="subtitle">Parallelprogrammierung</span>
</h1>
<div id="outline-container-orgaf25343" class="outline-2">
<h2 id="orgaf25343">Einführung</h2>
<div class="outline-text-2" id="text-orgaf25343">
<p>
Darstellungen lehnen sich an <a class='org-ref-reference' href="#KuncakProkopec2015">KuncakProkopec2015</a> an.
</p>
</div>
<div id="outline-container-orga0f713f" class="outline-3">
<h3 id="orga0f713f">Threads wie in Java</h3>
<div class="outline-text-3" id="text-orga0f713f">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">HelloThread</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Thread</span> <span style="color: #707183;">{</span>
  <span style="color: #006FE0;">override</span> <span style="color: #0000FF;">def</span> <span style="color: #006699;">run</span><span style="color: #7388D6;">()</span> <span style="color: #7388D6;">{</span>
    println<span style="color: #909183;">(</span><span style="color: #008000;">"Hello"</span><span style="color: #909183;">)</span>
    println<span style="color: #909183;">(</span><span style="color: #008000;">"world!"</span><span style="color: #909183;">)</span>
  <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #0000FF;">def</span> <span style="color: #006699;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
   <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t</span> <span style="color: #0000FF;">=</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">HelloThread</span><span style="color: #7388D6;">()</span>
   <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">s</span> <span style="color: #0000FF;">=</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">HelloThread</span><span style="color: #7388D6;">()</span>
   t.start<span style="color: #7388D6;">()</span>
   s.start<span style="color: #7388D6;">()</span>
   t.join<span style="color: #7388D6;">()</span>
   s.join<span style="color: #7388D6;">()</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4623214" class="outline-3">
<h3 id="org4623214">Synchronized blocks</h3>
<div class="outline-text-3" id="text-org4623214">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #006FE0;">private</span> <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">x</span> <span style="color: #0000FF;">=</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">AnyRef</span> <span style="color: #707183;">{}</span>
<span style="color: #006FE0;">private</span> <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">uidCount</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0L</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">getUniqueId</span><span style="color: #707183;">()</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Long</span> <span style="color: #0000FF;">=</span> x.synchronized <span style="color: #707183;">{</span>
  uidCount <span style="color: #0000FF;">=</span> uidCount + <span style="color: #D0372D;">1</span>
  uidCount 
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org69833f8" class="outline-3">
<h3 id="org69833f8">Basic parallel construct</h3>
<div class="outline-text-3" id="text-org69833f8">
<p>
Um zwei Ausdrücke, <code>e1</code> and <code>e2</code>, parallel zu berechnen und das
Ergebnispaar zurückzugeben:
</p>
<pre class="example">
parallel(e1, e2)

</pre>
</div>
<div id="outline-container-orgcf95516" class="outline-4">
<h4 id="orgcf95516">Beispiel: Berechnung der <a href="https://de.wikipedia.org/wiki/P-Norm">P-Norm</a></h4>
<div class="outline-text-4" id="text-orgcf95516">
<ul class="org-ul">
<li>Gegeben sei ein Vektor als Array von ganzen Zahlen.</li>
<li>Die P-Norm ist die Veralgemeinerung des Begriffs der <i>Länge</i> eines
Vektors aus der Geometrie.</li>
<li>Die 2-Norm eines zweidimensionalen Vektors \((a_1, a_2)\) ist \((a_1^2 + a_2^2)^{1/2}\).</li>
<li>Die Verallgemeinerung:
Die P-Norm eines Vektors \((a_1, \ldots\ , a_n)\) ist
\[(\sum_{i-1}^n |a_i|^p)^{1/p}\]</li>
</ul>
</div>
<div id="outline-container-org765a90e" class="outline-5">
<h5 id="org765a90e">Sequentielle Lösung</h5>
<div class="outline-text-5" id="text-org765a90e">
<ul class="org-ul">
<li>Eine etwas verallgemeinerte Funktion <code>sumSegment</code> soll folgendes
Problem lösen. Gegeben sind
<ul class="org-ul">
<li>ein Integer-Array <code>a</code>, das den Vektor repräsentiert</li>
<li>eine positive Double-Zahl <code>p</code></li>
<li>zwei gültige Array-Indizes <code>s</code> und <code>t</code> auf <code>a</code> mit \(s \leq t\)</li>
</ul></li>
<li>Berechne \[(\sum_{i-s}^{t-1}\lfloor|a_i|\rfloor^p)^{1/p}\] mit
\(\lfloor x\rfloor\) ist die größte ganze Zahl kleiner oder gleich
\(x\).</li>
</ul>

<div class="figure">
<p><img src="./Abbildungen/ast.png" alt="ast.png" width="300px" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">sumSegment</span><span style="color: #707183;">(</span>a<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span>, s<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
         <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">i</span><span style="color: #0000FF;">=</span> s; <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">sum</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
         <span style="color: #0000FF;">while</span> <span style="color: #7388D6;">(</span>i &lt; t<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
           sum<span style="color: #0000FF;">=</span> sum + power<span style="color: #909183;">(</span>a<span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>, p<span style="color: #909183;">)</span>
           i<span style="color: #0000FF;">=</span> i + <span style="color: #D0372D;">1</span> 
         <span style="color: #7388D6;">}</span>
sum 
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
<code>power</code> berechnet \(\lfloor |x^p|\rfloor\)
</p>
<div class="org-src-container">
<pre class="src src-scala"> <span style="color: #0000FF;">def</span> <span style="color: #006699;">power</span><span style="color: #707183;">(</span>x<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> math.exp<span style="color: #707183;">(</span>p * math.log<span style="color: #7388D6;">(</span>abs<span style="color: #909183;">(</span>x<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>.toInt</pre>
</pre>
</div>
<ul class="org-ul">
<li><p>
Berechnung der P-Norm mithilfe von <code>sumSegment(a, p, s, t)</code>
\[||a||_p := (\sum_{i=0}^{N-1}\lfloor|a_i|\rfloor^p)^{1/p}\] mit <code>N = a.length</code>.
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">pNorm</span><span style="color: #707183;">(</span>a<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span>
  power<span style="color: #707183;">(</span>sumSegment<span style="color: #7388D6;">(</span>a, p, <span style="color: #D0372D;">0</span>, a.length<span style="color: #7388D6;">)</span>, <span style="color: #D0372D;">1</span>/p<span style="color: #707183;">)</span>  </pre>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org0d7fa89" class="outline-5">
<h5 id="org0d7fa89">Parallelisierung</h5>
<div class="outline-text-5" id="text-org0d7fa89">
<ul class="org-ul">
<li><p>
Aufspaltung der Summe in zwei Teilsummen
\[||a||_p :=
  (\sum_{i=0}^{N-1}\lfloor|a_i|\rfloor^p)^{1/p}=(\sum_{i=0}^{m-1}\lfloor|a_i|\rfloor^p +
  \sum_{i=m}^{N-1}\lfloor|a_i|\rfloor^p)^{1/p}\]
</p>

<div class="figure">
<p><img src="./Abbildungen/m.png" alt="m.png" width="300px" />
</p>
</div></li>
<li><p>
Zwei Aufrufe von <code>sumSegment</code> parallel:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">pNormTwoPart</span><span style="color: #707183;">(</span>a<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
         <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">m</span> <span style="color: #0000FF;">=</span> a.length / <span style="color: #D0372D;">2</span>
         <span style="color: #0000FF;">val</span> <span style="color: #7388D6;">(</span><span style="color: #BA36A5;">sum1</span>, <span style="color: #BA36A5;">sum2</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=</span> parallel<span style="color: #7388D6;">(</span>sumSegment<span style="color: #909183;">(</span>a, p, <span style="color: #D0372D;">0</span>, m<span style="color: #909183;">)</span>,
                                     sumSegment<span style="color: #909183;">(</span>a, p, m, a.length<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
         power<span style="color: #7388D6;">(</span>sum1 + sum2, <span style="color: #D0372D;">1</span>/p<span style="color: #7388D6;">)</span> <span style="color: #707183;">}</span></pre>
</pre>
</div></li>
<li><p>
Vier Aufrufe parallel:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">m1</span> <span style="color: #0000FF;">=</span> a.length/<span style="color: #D0372D;">4</span>; <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">m2</span> <span style="color: #0000FF;">=</span> a.length/<span style="color: #D0372D;">2</span>; <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">m3</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">3</span>*a.length/<span style="color: #D0372D;">4</span>
       <span style="color: #0000FF;">val</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">sum1</span>, <span style="color: #BA36A5;">sum2</span><span style="color: #7388D6;">)</span>,<span style="color: #7388D6;">(</span><span style="color: #BA36A5;">sum3</span>,<span style="color: #BA36A5;">sum4</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=</span>
         parallel<span style="color: #707183;">(</span>parallel<span style="color: #7388D6;">(</span>sumSegment<span style="color: #909183;">(</span>a, p, <span style="color: #D0372D;">0</span>, m1<span style="color: #909183;">)</span>, sumSegment<span style="color: #909183;">(</span>a, p, m1, m2<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>,
                  parallel<span style="color: #7388D6;">(</span>sumSegment<span style="color: #909183;">(</span>a, p, m2, m3<span style="color: #909183;">)</span>, sumSegment<span style="color: #909183;">(</span>a, p, m3, a.length<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span></pre>
</pre>
</div></li>
<li><p>
Rekursive Zerlegung
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">pNormRec</span><span style="color: #707183;">(</span>a<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span>
  power<span style="color: #707183;">(</span>segmentRec<span style="color: #7388D6;">(</span>a, p, <span style="color: #D0372D;">0</span>, a.length<span style="color: #7388D6;">)</span>, <span style="color: #D0372D;">1</span>/p<span style="color: #707183;">)</span>

<span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">wie sumSegment nur parallel/rekursiv</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">segmentRec</span><span style="color: #707183;">(</span>a<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span>, s<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>t - s &lt; threshold<span style="color: #7388D6;">)</span>
    sumSegment<span style="color: #7388D6;">(</span>a, p, s, t<span style="color: #7388D6;">)</span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">kleines Segment: mach es sequentiell</span>
  <span style="color: #0000FF;">else</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">m</span> <span style="color: #0000FF;">=</span> s + <span style="color: #909183;">(</span>t - s<span style="color: #909183;">)</span>/<span style="color: #D0372D;">2</span>
    <span style="color: #0000FF;">val</span> <span style="color: #909183;">(</span><span style="color: #BA36A5;">sum1</span>, <span style="color: #BA36A5;">sum2</span><span style="color: #909183;">)</span> <span style="color: #0000FF;">=</span> parallel<span style="color: #909183;">(</span>segmentRec<span style="color: #709870;">(</span>a, p, s, m<span style="color: #709870;">)</span>,
                                segmentRec<span style="color: #709870;">(</span>a, p, m, t<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    sum1 + sum2 <span style="color: #7388D6;">}</span> 
<span style="color: #707183;">}</span></pre>
</pre>
</div></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org5fd1ea7" class="outline-3">
<h3 id="org5fd1ea7">Kontrollstruktur <code>parallel</code></h3>
<div class="outline-text-3" id="text-org5fd1ea7">
<ul class="org-ul">
<li><code>parallel</code> ist ein Schlüsselwort in Scala.</li>
<li><p>
<code>parallel</code> könnte auch als Funktion mit folgender Signatur
implementiert werden:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">parallel</span> <span style="color: #707183;">[</span><span style="color: #D0372D;">A</span>, <span style="color: #D0372D;">B</span><span style="color: #707183;">](</span>taskA<span style="color: #0000FF;">:</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">A</span>, taskB<span style="color: #0000FF;">:</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">B</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #707183;">(</span><span style="color: #D0372D;">A</span>, <span style="color: #D0372D;">B</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span> ... <span style="color: #707183;">}</span>  </pre>
</pre>
</div></li>
</ul>
</div>
<div id="outline-container-org9a28206" class="outline-4">
<h4 id="org9a28206">Systemunterstützung</h4>
<div class="outline-text-4" id="text-org9a28206">
<ul class="org-ul">
<li>Effiziente Parallelität erfordert Unterstützung durch
<ul class="org-ul">
<li>die Sprache und ihre Bibliotheken</li>
<li>die virtuelle Maschine</li>
<li>das Betriebssystem</li>
<li>die Hardware</li>
</ul></li>
<li>Gängige Implementierung von <code>parallel</code> nutzt JVM-Threads.</li>
<li>Von Parallelarbeit kann man nur dann eine wesentliche
Geschwindigkeitssteigerung erwarten, wenn die parallel
auszuführenden Schritte nicht zu trivial sind.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb8ff487" class="outline-2">
<h2 id="orgb8ff487">First-Class Tasks</h2>
<div class="outline-text-2" id="text-orgb8ff487">
</div>
<div id="outline-container-orgb35c82d" class="outline-3">
<h3 id="orgb35c82d">Flexiblere Alternative für parallele Berechnungen</h3>
<div class="outline-text-3" id="text-orgb35c82d">
<ul class="org-ul">
<li><p>
Statt
</p>
<pre class="example">
val (v1, v2) = parallel(e1, e2)

</pre>
<p>
kann man auch das <code>task</code>-Konstrukt benutzen:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t1</span> <span style="color: #0000FF;">=</span> task<span style="color: #707183;">(</span>e1<span style="color: #707183;">)</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t2</span> <span style="color: #0000FF;">=</span> task<span style="color: #707183;">(</span>e2<span style="color: #707183;">)</span> 
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">v1</span> <span style="color: #0000FF;">=</span> t1.join
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">v2</span> <span style="color: #0000FF;">=</span> t2.join  </pre>
</pre>
</div>
<p>
Der Ausdruck <code>t = task(e)</code> startet die Berechnung als Thread:
</p>
<ul class="org-ul">
<li><code>t</code> ist eine <code>task</code>, die den Wert von <code>e</code> berechnet.</li>
<li>Die laufende Berechnung wird parallel zu <code>t</code> fortgesetzt.</li>
<li>Um das Resultat von <code>e</code> zu erhalten, benutzt man <code>t.join</code>.</li>
<li><code>t.join</code> sorgt dafür, dass der ausführende Thread auf die
Beendigung von <code>t</code> wartet.</li>
</ul></li>
</ul>
</div>
<div id="outline-container-org2c751f2" class="outline-4">
<h4 id="org2c751f2">Task-Interface</h4>
<div class="outline-text-4" id="text-org2c751f2">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">task</span><span style="color: #707183;">(</span>c<span style="color: #0000FF;">:</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">A</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Task</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span>
<span style="color: #0000FF;">trait</span> <span style="color: #6434A3;">Task</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">join</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<ul class="org-ul">
<li><code>task</code> und <code>join</code> erzeugen Abbildungen zwischen Berechnungen und Tasks.</li>
<li>Die Gleichung <code>task(e).join == e</code> gilt immer.</li>
<li><p>
Auf die Verwendung von <code>.join</code> kann verzichtet werden, wenn man eine
implizite Umwandlung definiert: 
</p>
<pre class="example">
implicit def getJoin[T](x:Task[T]): T = x.join

</pre></li>
</ul>
</div>
</div>
<div id="outline-container-orgbcf95d9" class="outline-4">
<h4 id="orgbcf95d9">Anwendungsbeispiel für vier Tasks</h4>
<div class="outline-text-4" id="text-orgbcf95d9">
<p>
Statt
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">part1</span>, <span style="color: #BA36A5;">part2</span><span style="color: #7388D6;">)</span>,<span style="color: #7388D6;">(</span><span style="color: #BA36A5;">part3</span>,<span style="color: #BA36A5;">part4</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=</span>
  parallel<span style="color: #707183;">(</span>parallel<span style="color: #7388D6;">(</span>sumSegment<span style="color: #909183;">(</span>a, p, <span style="color: #D0372D;">0</span>, mid1<span style="color: #909183;">)</span>,
                    sumSegment<span style="color: #909183;">(</span>a, p, mid1, mid2<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>,
           parallel<span style="color: #7388D6;">(</span>sumSegment<span style="color: #909183;">(</span>a, p, mid2, mid3<span style="color: #909183;">)</span>,
                    sumSegment<span style="color: #909183;">(</span>a, p, mid3, a.length<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
power<span style="color: #707183;">(</span>part1 + part2 + part3 + part4, <span style="color: #D0372D;">1</span>/p<span style="color: #707183;">)</span></pre>
</pre>
</div>
<p>
kann man nun auch Tasks benutzen:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t1</span> <span style="color: #0000FF;">=</span> task <span style="color: #707183;">{</span>sumSegment<span style="color: #7388D6;">(</span>a, p, <span style="color: #D0372D;">0</span>, mid1<span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t2</span> <span style="color: #0000FF;">=</span> task <span style="color: #707183;">{</span>sumSegment<span style="color: #7388D6;">(</span>a, p, mid1, mid2<span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t3</span> <span style="color: #0000FF;">=</span> task <span style="color: #707183;">{</span>sumSegment<span style="color: #7388D6;">(</span>a, p, mid2, mid3<span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">t4</span> <span style="color: #0000FF;">=</span> task <span style="color: #707183;">{</span>sumSegment<span style="color: #7388D6;">(</span>a, p, mid3, a.length<span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
power<span style="color: #707183;">(</span>t1 + t2 + t3 + t4, <span style="color: #D0372D;">1</span>/p<span style="color: #707183;">)</span></pre>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org0fd835c" class="outline-2">
<h2 id="org0fd835c">ScalaMeter</h2>
<div class="outline-text-2" id="text-org0fd835c">
</div>
<div id="outline-container-org121849b" class="outline-3">
<h3 id="org121849b">Wie schnell sind parallele Programme</h3>
<div class="outline-text-3" id="text-org121849b">
<ul class="org-ul">
<li>Bewertung von Programmen/Algorithmen durch asymptotische Analyse
<ul class="org-ul">
<li>anwendbar auf rekursive Programme und damit auch auf rekursive
Parallelität (vgl. die <code>segmentRec</code>-Funktion für die Berechnung
der P-Norm)</li>
</ul></li>
<li>Zeitmessungen durchführen
<ul class="org-ul">
<li>Beispiele bereits betrachtet</li>
<li>Frage: Warum sind Zeitmessungen schwierig?</li>
</ul></li>
<li>Amdahls Law</li>
</ul>
</div>
</div>
<div id="outline-container-orgf0fc07c" class="outline-3">
<h3 id="orgf0fc07c">Was ist Benchmarking?</h3>
<div class="outline-text-3" id="text-orgf0fc07c">
<ul class="org-ul">
<li><i>Testen</i> soll zeigen, dass für konkrete Anwendungsfälle das Programm
das erwartete Ergebnis liefert.</li>
<li><i>Benchmarking</i> berechnet Performanz–Maße für Teile eines Programms.</li>
<li>Warum ist Benchmarking für parallele Programme besonders interessant?</li>
</ul>
</div>
</div>
<div id="outline-container-org5cd5e53" class="outline-3">
<h3 id="org5cd5e53">Laufzeitfaktoren</h3>
<div class="outline-text-3" id="text-org5cd5e53">
<ul class="org-ul">
<li>Prozessorgeschwindigkeit</li>
<li>Anzahl der Prozessoren</li>
<li>Speicherzugriffszeit und Datenrate</li>
<li>Verhalten der Cache-Speicher</li>
<li>Laufzeitsystem 
<ul class="org-ul">
<li>Garbage-Collection</li>
<li>Just-in-time-Übersetzung</li>
<li>Thread-Scheduling</li>
</ul></li>
<li>Ergänzende Information: <a class='org-ref-reference' href="#Drepper2007">Drepper2007</a></li>
</ul>
</div>
</div>
<div id="outline-container-org554f968" class="outline-3">
<h3 id="org554f968">Mess-Methodik</h3>
<div class="outline-text-3" id="text-org554f968">
<ul class="org-ul">
<li>Einfache Laufzeitmessungen liefern zufällige Ergebnisse.</li>
<li>Maßnahmen:
<ul class="org-ul">
<li>mehrfache Wiederholung</li>
<li>stastische Methoden anwenden: Durchschnitt, Varianz, Elimination
von Ausreißern</li>
<li>Sicherstellen eines „stabilen“ Systemzustands (Warm-up-Phase)</li>
<li>Sonderverhalten ausschließen (Garbage-Collection,
Just-in-time-Übersetzung, Spezialoptimierungen)</li>
</ul></li>
<li>Ergänzende Information: <a class='org-ref-reference' href="#Georges2007">Georges2007</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgdbedfc0" class="outline-3">
<h3 id="orgdbedfc0">Benchmarking mit ScalaMeter</h3>
<div class="outline-text-3" id="text-orgdbedfc0">
<ul class="org-ul">
<li>Framework für 
<ul class="org-ul">
<li>Performanz-Regressionstest &#x2013; Vergleich der Performanz eines
Programmlaufs mit den Ergebnissen vorheriger Läufe</li>
<li><b>Benchmarking</b> &#x2013; Messen der Performance eines Programms bzw. eines
bestimmten Teils davon</li>
</ul></li>
</ul>
</div>
<div id="outline-container-orgbc0e17f" class="outline-4">
<h4 id="orgbc0e17f">Benutzung</h4>
<div class="outline-text-4" id="text-orgbc0e17f">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">import</span> org.scalameter.<span style="color: #0000FF;">_</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">time</span> <span style="color: #0000FF;">=</span> measure <span style="color: #707183;">{</span>
  <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span> until <span style="color: #D0372D;">1000000</span><span style="color: #7388D6;">)</span>.toArray
<span style="color: #707183;">}</span>
println<span style="color: #707183;">(</span>s&#8221;Array initialization time<span style="color: #0000FF;">:</span> $time ms&#8221;<span style="color: #707183;">)</span></pre>
</pre>
</div>
<p>
Einige Messergebnisse:
</p>
<div class="org-src-container">
<pre class="src src-shell">scala&gt; import org.scalameter._
import org.scalameter._
scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res16: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 112.550853 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res17: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 129.276758 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res18: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 114.564872 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res19: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 76.054651 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res20: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 44.536571 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res21: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 42.655136 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res22: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 41.384557 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res23: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 40.751557 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res24: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 62.932047 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res25: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 48.995 ms

scala&gt; measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res26: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 54.067021 ms</pre>
</pre>
</div>
</div>
<div id="outline-container-orgadff2d7" class="outline-5">
<h5 id="orgadff2d7">JVM Warmup</h5>
<div class="outline-text-5" id="text-orgadff2d7">
<ul class="org-ul">
<li>Sehr unterschiedliche Messergebnisse bei aufeinanderfolgenden Programmläufen</li>
<li>Ein Programm, das auf der JVM läuft, durchläuft eine Aufwärmperiode,
nach deren Ablauf es seine maximale Geschwindigkeit erreicht.
<ol class="org-ol">
<li>Das Programm (der Bytecode) wird interpretiert.</li>
<li>Teile des Programms werden in Maschinencode übersetzt.</li>
<li>Die JVM wird eventuell weitere dynamische Optimierungen vornehmen.</li>
<li>Das Programm erreicht einen stabilen Zustand.</li>
</ol></li>
<li>Normalerweise will man die Geschwindigkeit nach Ablauf der
Aufwärmperiode messen.</li>
<li><p>
ScalaMeter <code>Warmer</code>-Objekte lassen den zu messenden Code laufen, bis
ein stabiler Zustand erreicht ist:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">time</span> <span style="color: #0000FF;">=</span> withWarmer<span style="color: #707183;">(</span><span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Warmer</span>.<span style="color: #D0372D;">Default</span><span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span>
  <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span> until <span style="color: #D0372D;">1000000</span><span style="color: #7388D6;">)</span>.toArray
<span style="color: #707183;">}</span>  </pre>
</pre>
</div></li>
<li>Einige Messergebnisse:</li>
</ul>
<div class="org-src-container">
<pre class="src src-shell">scala&gt; withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res27: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 91.896549 ms

scala&gt; withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res28: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 36.076516 ms

scala&gt; withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res29: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 41.084076 ms

scala&gt; withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res30: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 37.660086 ms

scala&gt; withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res31: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 41.897866 ms

scala&gt; withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span><span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res32: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 51.400989 ms
</pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge53d46e" class="outline-5">
<h5 id="orge53d46e">ScalaMeter Configuration</h5>
<div class="outline-text-5" id="text-orge53d46e">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">time</span> <span style="color: #0000FF;">=</span> config<span style="color: #707183;">(</span>
  <span style="color: #D0372D;">Key</span>.exec.minWarmupRuns -&gt; <span style="color: #D0372D;">20</span>,
  <span style="color: #D0372D;">Key</span>.exec.maxWarmupRuns -&gt; <span style="color: #D0372D;">60</span>,
  <span style="color: #D0372D;">Key</span>.verbose -&gt; <span style="color: #D0372D;">true</span>
<span style="color: #707183;">)</span> withWarmer<span style="color: #707183;">(</span><span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Warmer</span>.<span style="color: #D0372D;">Default</span><span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span>
  <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span> until <span style="color: #D0372D;">1000000</span><span style="color: #7388D6;">)</span>.toArray
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<ul class="org-ul">
<li><p>
Benutzung:
</p>
<div class="org-src-container">
<pre class="src src-shell">scala&gt; val time = config<span style="color: #707183;">(</span>
     |   Key.exec.minWarmupRuns -&gt; 20,
     |   Key.exec.maxWarmupRuns -&gt; 60,
     |   Key.verbose -&gt; true
     | <span style="color: #707183;">)</span> withWarmer<span style="color: #707183;">(</span>new Warmer.Default<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span>
     |   <span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray
     | <span style="color: #707183;">}</span>
Starting warmup.
0. warmup run running time: 79.517448 <span style="color: #707183;">(</span>covNoGC: NaN, covGC: NaN<span style="color: #707183;">)</span>
1. warmup run running time: 134.792116 <span style="color: #707183;">(</span>covNoGC: 0,3648, covGC: 0,3648<span style="color: #707183;">)</span>
2. warmup run running time: 112.503768 <span style="color: #707183;">(</span>covNoGC: 0,2553, covGC: 0,2553<span style="color: #707183;">)</span>
3. warmup run running time: 84.27628 <span style="color: #707183;">(</span>covNoGC: 0,2514, covGC: 0,2514<span style="color: #707183;">)</span>
4. warmup run running time: 95.29925 <span style="color: #707183;">(</span>covNoGC: 0,2234, covGC: 0,2234<span style="color: #707183;">)</span>
GC detected.
5. warmup run running time: 194.387408 <span style="color: #707183;">(</span>covNoGC: 0,2234, covGC: 0,3687<span style="color: #707183;">)</span>
6. warmup run running time: 102.420648 <span style="color: #707183;">(</span>covNoGC: 0,1995, covGC: 0,3459<span style="color: #707183;">)</span>
7. warmup run running time: 97.337027 <span style="color: #707183;">(</span>covNoGC: 0,1838, covGC: 0,3309<span style="color: #707183;">)</span>
8. warmup run running time: 93.12814 <span style="color: #707183;">(</span>covNoGC: 0,1740, covGC: 0,3210<span style="color: #707183;">)</span>
9. warmup run running time: 81.202894 <span style="color: #707183;">(</span>covNoGC: 0,1780, covGC: 0,3225<span style="color: #707183;">)</span>
10. warmup run running time: 83.395876 <span style="color: #707183;">(</span>covNoGC: 0,1768, covGC: 0,3199<span style="color: #707183;">)</span>
11. warmup run running time: 83.710833 <span style="color: #707183;">(</span>covNoGC: 0,1745, covGC: 0,3161<span style="color: #707183;">)</span>
12. warmup run running time: 93.719995 <span style="color: #707183;">(</span>covNoGC: 0,1666, covGC: 0,3060<span style="color: #707183;">)</span>
13. warmup run running time: 79.129419 <span style="color: #707183;">(</span>covNoGC: 0,1684, covGC: 0,3053<span style="color: #707183;">)</span>
14. warmup run running time: 49.723492 <span style="color: #707183;">(</span>covNoGC: 0,2120, covGC: 0,3334<span style="color: #707183;">)</span>
15. warmup run running time: 43.142197 <span style="color: #707183;">(</span>covNoGC: 0,2540, covGC: 0,3637<span style="color: #707183;">)</span>
16. warmup run running time: 43.33126 <span style="color: #707183;">(</span>covNoGC: 0,2849, covGC: 0,3881<span style="color: #707183;">)</span>
17. warmup run running time: 44.380355 <span style="color: #707183;">(</span>covNoGC: 0,3078, covGC: 0,4071<span style="color: #707183;">)</span>
18. warmup run running time: 42.96821 <span style="color: #707183;">(</span>covNoGC: 0,3279, covGC: 0,4244<span style="color: #707183;">)</span>
19. warmup run running time: 37.649185 <span style="color: #707183;">(</span>covNoGC: 0,3509, covGC: 0,4444<span style="color: #707183;">)</span>
GC detected.
20. warmup run running time: 55.993767 <span style="color: #707183;">(</span>covNoGC: 0,3509, covGC: 0,4569<span style="color: #707183;">)</span>
21. warmup run running time: 41.373658 <span style="color: #707183;">(</span>covNoGC: 0,3659, covGC: 0,4711<span style="color: #707183;">)</span>
22. warmup run running time: 42.396609 <span style="color: #707183;">(</span>covNoGC: 0,3883, covGC: 0,4916<span style="color: #707183;">)</span>
23. warmup run running time: 42.881321 <span style="color: #707183;">(</span>covNoGC: 0,3712, covGC: 0,5137<span style="color: #707183;">)</span>
24. warmup run running time: 45.010063 <span style="color: #707183;">(</span>covNoGC: 0,3671, covGC: 0,5331<span style="color: #707183;">)</span>
25. warmup run running time: 42.99345 <span style="color: #707183;">(</span>covNoGC: 0,3812, covGC: 0,3761<span style="color: #707183;">)</span>
26. warmup run running time: 44.65123 <span style="color: #707183;">(</span>covNoGC: 0,3843, covGC: 0,3656<span style="color: #707183;">)</span>
27. warmup run running time: 45.08368 <span style="color: #707183;">(</span>covNoGC: 0,3728, covGC: 0,3520<span style="color: #707183;">)</span>
28. warmup run running time: 44.773776 <span style="color: #707183;">(</span>covNoGC: 0,3587, covGC: 0,3349<span style="color: #707183;">)</span>
29. warmup run running time: 39.385705 <span style="color: #707183;">(</span>covNoGC: 0,3457, covGC: 0,3318<span style="color: #707183;">)</span>
30. warmup run running time: 43.370046 <span style="color: #707183;">(</span>covNoGC: 0,3375, covGC: 0,3144<span style="color: #707183;">)</span>
31. warmup run running time: 40.737444 <span style="color: #707183;">(</span>covNoGC: 0,3208, covGC: 0,2872<span style="color: #707183;">)</span>
32. warmup run running time: 43.941155 <span style="color: #707183;">(</span>covNoGC: 0,2888, covGC: 0,1912<span style="color: #707183;">)</span>
33. warmup run running time: 38.465119 <span style="color: #707183;">(</span>covNoGC: 0,1901, covGC: 0,0902<span style="color: #707183;">)</span>
Steady-state detected.
Ending warmup.
measurements: 45.413679 ms
<span style="color: #0000FF;">time</span>: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 45.413679 ms</pre>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgd97c596" class="outline-5">
<h5 id="orgd97c596">Weitere Messungen</h5>
<div class="outline-text-5" id="text-orgd97c596">
<dl class="org-dl">
<dt><code>Measurer.Default</code></dt><dd>reine Laufzeit</dd>
<dt><code>IgnoringGC</code></dt><dd>Laufzeit ohne Pausen durch GC</dd>
<dt><code>OutlierElimination</code></dt><dd>entfernt statische Ausreißer</dd>
<dt><code>MemoryFootprint</code></dt><dd>Speicherabdruck eines Objekts</dd>
<dt><code>GarbageCollectionCycles</code></dt><dd>Gesamtzahl aller GC-Pausen</dd>
<dt>&#x2026;</dt><dd></dd>
</dl>
</div>
</div>
<div id="outline-container-org725b748" class="outline-5">
<h5 id="org725b748">Beispiel</h5>
<div class="outline-text-5" id="text-org725b748">
<div class="org-src-container">
<pre class="src src-shell">scala&gt; withMeasurer<span style="color: #707183;">(</span>new Measurer.MemoryFootprint<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span> <span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res42: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 146.72 kB

scala&gt; withMeasurer<span style="color: #707183;">(</span>new Measurer.MemoryFootprint<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span> <span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res43: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 3993.488 kB

scala&gt; withMeasurer<span style="color: #707183;">(</span>new Measurer.MemoryFootprint<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span> <span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res44: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 3999.064 kB

scala&gt; withMeasurer<span style="color: #707183;">(</span>new Measurer.MemoryFootprint<span style="color: #707183;">)</span> measure <span style="color: #707183;">{</span> <span style="color: #7388D6;">(</span>0 until 1000000<span style="color: #7388D6;">)</span>.toArray<span style="color: #707183;">}</span>
res45: org.scalameter.Quantity<span style="color: #707183;">[</span>Double<span style="color: #707183;">]</span> = 3995.936 kB</pre>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org0999033" class="outline-2">
<h2 id="org0999033">Anwendungsbeispiele</h2>
<div class="outline-text-2" id="text-org0999033">
</div>
<div id="outline-container-org981c912" class="outline-3">
<h3 id="org981c912">Paralleles Mapping</h3>
<div class="outline-text-3" id="text-org981c912">
</div>
<div id="outline-container-org94454e6" class="outline-4">
<h4 id="org94454e6">Parallelität und Collections</h4>
<div class="outline-text-4" id="text-org94454e6">
<ul class="org-ul">
<li>Parallelverarbeitung von Collections ist wichtig!
<ul class="org-ul">
<li>gehört zu den wichtigsten Anwendungen der Parallelarbeit</li>
</ul></li>
<li>Unter welchen Bedingungen ist Parallelarbeit möglich?
<ul class="org-ul">
<li>Eigenschaften von Collections: Zerlegung, Verknüpfung</li>
<li>Eigenschaften von Operationen: Assoziativität, Unabhängigkeit</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org0935359" class="outline-4">
<h4 id="org0935359">Funktionale Programmierung und Collections</h4>
<div class="outline-text-4" id="text-org0935359">
<ul class="org-ul">
<li>Operationen auf Collections sind in der funktionalen Programmierung
von besonderem Gewicht.</li>
<li id="<code>map</code>"><p>
wende eine Funktion auf jedes Element an
</p>
<pre class="example">
List(1,3,8).map(x =&gt; x*x) == List(1, 9, 64) 

</pre></li>
<li id="<code>fold</code>"><p>
verknüpfe die Elemente mit einer gegebenen Operation
</p>
<pre class="example">
List(1,3,8).fold(100)((s,x) =&gt; s + x) == 112

</pre></li>
<li id="<code>scan</code>"><p>
verknüpfe die „folds" aller Listen-Präfixe
</p>
<pre class="example">
List(1,3,8).scan(100)((s,x) =&gt; s + x) == List(100, 101, 104, 112)

</pre></li>
</ul>
<p>
Diese Operationen sind für parallelle Collections noch wichtiger als
für sequentielle.
</p>
</div>
</div>
<div id="outline-container-org0631e8b" class="outline-4">
<h4 id="org0631e8b">Wahl der Datenstrukturen</h4>
<div class="outline-text-4" id="text-org0631e8b">
<ul class="org-ul">
<li>Die Collection <code>List</code> wird benutzt, um das Resultat von Operationen
zu spezifizieren.</li>
<li><p>
Grundsätzlich sind Lists aber für parallele Implementierungen
ungeeignet weil 
</p>
<ul class="org-ul">
<li>sie in zwei Teile zu zerlegen und</li>
<li>die Elemente miteinander zu verknüpfen</li>
</ul>
<p>
jeweils linearen Zeitaufwand erfordert.
</p></li>
<li>Stattdessen werden folgende Alternativen betrachtet
<dl class="org-dl">
<dt>Arrays</dt><dd>als imperative Datenstruktur</dd>
<dt>Bäume</dt><dd>als funktionale Datenstruktur</dd>
</dl></li>
</ul>
<p>
Darüber hinaus verfügt Scala über Bibliotheken mit sehr effizient
implementierten parallelen Collections.
</p>
</div>
</div>
<div id="outline-container-orga3bf0ac" class="outline-4">
<h4 id="orga3bf0ac">Bedeutung von <code>map</code></h4>
<div class="outline-text-4" id="text-orga3bf0ac">
<p>
<code>map</code> wendet die als Argument übergebene Funktion auf jedes
Listenelement an: 
</p>
<pre class="example">
List(1,3,8).map(x =&gt; x*x) == List(1, 9, 64)
List(a1, a2, ..., an).map(f) == List(f(a1), f(a2), ..., f(an)) 

</pre>
<p>
Weiter gilt:
</p>
<ul class="org-ul">
<li><code>list.map(x =&gt; x) == list</code></li>
<li><code>list.map(f.compose(g)) == list.map(g).map(f)</code> <br />
mit <code>(f.compose(g))(x) = f(g(x))</code></li>
</ul>
</div>
</div>
<div id="outline-container-org6cea833" class="outline-4">
<h4 id="org6cea833">Sequentielle Implementierung für Listen</h4>
<div class="outline-text-4" id="text-org6cea833">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">mapSeq</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">B</span><span style="color: #707183;">](</span>lst<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, f <span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">B</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #707183;">[</span><span style="color: #D0372D;">B</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> lst <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #D0372D;">Nil</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Nil</span>
  <span style="color: #0000FF;">case</span> <span style="color: #BA36A5;">h</span> <span style="color: #6434A3;">::</span> <span style="color: #BA36A5;">t</span> <span style="color: #0000FF;">=&gt;</span> f<span style="color: #7388D6;">(</span>h<span style="color: #7388D6;">)</span> :: mapSeq<span style="color: #7388D6;">(</span>t,f<span style="color: #7388D6;">)</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
Gesucht ist eine Version, die folgendes parallelisiert:
</p>
<ul class="org-ul">
<li>die Berechnung von <code>f(h)</code> für verschiedene Elemente <code>h</code></li>
<li>den wahlfreien Zugriff auf die Elemente (Listen sind hier
ungeeignet)</li>
</ul>
</div>
</div>
<div id="outline-container-org487a0b3" class="outline-4">
<h4 id="org487a0b3">Sequentielle Version von <code>map</code> für Bäume</h4>
<div class="outline-text-4" id="text-org487a0b3">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">mapASegSeq</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">B</span><span style="color: #707183;">](</span>inp<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, f <span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">B</span>,
                    out<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">B</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Writes to out(i) for left &lt;= i &lt;= right-1</span>
  <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">i</span><span style="color: #0000FF;">=</span> left
  <span style="color: #0000FF;">while</span> <span style="color: #7388D6;">(</span>i &lt; right<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
    out<span style="color: #909183;">(</span>i<span style="color: #909183;">)</span><span style="color: #0000FF;">=</span> f<span style="color: #909183;">(</span>inp<span style="color: #709870;">(</span>i<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
i<span style="color: #0000FF;">=</span> i+<span style="color: #D0372D;">1</span> <span style="color: #7388D6;">}</span><span style="color: #707183;">}</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">in</span><span style="color: #0000FF;">=</span> <span style="color: #D0372D;">Array</span><span style="color: #707183;">(</span><span style="color: #D0372D;">2</span>,<span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">4</span>,<span style="color: #D0372D;">5</span>,<span style="color: #D0372D;">6</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">out</span><span style="color: #0000FF;">=</span> <span style="color: #D0372D;">Array</span><span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">f</span><span style="color: #0000FF;">=</span> <span style="color: #707183;">(</span>x<span style="color: #0000FF;">:</span><span style="color: #6434A3;">Int</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=&gt;</span> x*x
mapASegSeq<span style="color: #707183;">(</span>in, <span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">3</span>, f, out<span style="color: #707183;">)</span>
out

res1<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #707183;">[</span><span style="color: #D0372D;">Int</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">Array</span><span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>, <span style="color: #D0372D;">9</span>, <span style="color: #D0372D;">16</span>, <span style="color: #D0372D;">0</span>, <span style="color: #D0372D;">0</span><span style="color: #707183;">)</span>
</pre>
</pre>
</div>

<div class="figure">
<p><img src="./Abbildungen/inpout.png" alt="inpout.png" width="350px" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb973d08" class="outline-4">
<h4 id="orgb973d08">Parallele Version von <code>map</code> für <code>arrays</code></h4>
<div class="outline-text-4" id="text-orgb973d08">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">mapASegPar</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">B</span><span style="color: #707183;">](</span>inp<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, f <span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">B</span>,
                    out<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">B</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Unit</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Writes to out(i) for left &lt;= i &lt;= right-1</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>right - left &lt; threshold<span style="color: #7388D6;">)</span>
    mapASegSeq<span style="color: #7388D6;">(</span>inp, left, right, f, out<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">else</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">mid</span> <span style="color: #0000FF;">=</span> left + <span style="color: #909183;">(</span>right - left<span style="color: #909183;">)</span>/<span style="color: #D0372D;">2</span>
    parallel<span style="color: #909183;">(</span>mapASegPar<span style="color: #709870;">(</span>inp, left, mid, f, out<span style="color: #709870;">)</span>,
             mapASegPar<span style="color: #709870;">(</span>inp, mid, right, f, out<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
Anmerkungen:
</p>
<ul class="org-ul">
<li>Schreibzugriffe nur für auf verschiedene Array-Elemente zulässig.</li>
<li>Der Wert von <code>threshold</code> darf nicht zu klein gewählt werden.</li>
</ul>
</div>
<div id="outline-container-org340689b" class="outline-5">
<h5 id="org340689b">Benutzungsbeispiel</h5>
<div class="outline-text-5" id="text-org340689b">
<p>
Erhebe jedes Array-Element zur <code>p</code>-ten Potenz:
\[Array(a_1, a_2, \ldots , a_n) \rightarrow Array(|a_1|^p, |a_2|^p, \ldots , |a_n|^p)\]
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">p</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">1.5</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span><span style="color: #707183;">(</span>x<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span> <span style="color: #0000FF;">=</span> power<span style="color: #707183;">(</span>x, p<span style="color: #707183;">)</span>
mapASegSeq<span style="color: #707183;">(</span>inp, <span style="color: #D0372D;">0</span>, inp.length, f, out<span style="color: #707183;">)</span>   <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">sequential</span>
mapASegPar<span style="color: #707183;">(</span>inp, <span style="color: #D0372D;">0</span>, inp.length, f, out<span style="color: #707183;">)</span>   <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">parallel</span></pre>
</pre>
</div>
<p>
Zwei Fragen:
</p>
<ol class="org-ol">
<li>Gibt es Geschwindigkeitsgewinne durch die parallele Ausführung?</li>
<li>Könnte es Geschwindigkeitsgewinne geben, falls man auf die oben
eingeführten =map=Varianten verzichtet?</li>
</ol>
</div>
</div>
<div id="outline-container-org919bccd" class="outline-5">
<h5 id="org919bccd">„Herkömmliche“ sequentielle Version des Algorithmus</h5>
<div class="outline-text-5" id="text-org919bccd">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">normsOf</span><span style="color: #707183;">(</span>inp<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span>,
            left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>,
            out<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Double</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Unit</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">i</span><span style="color: #0000FF;">=</span> left
  <span style="color: #0000FF;">while</span> <span style="color: #7388D6;">(</span>i &lt; right<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
     out<span style="color: #909183;">(</span>i<span style="color: #909183;">)</span><span style="color: #0000FF;">=</span> power<span style="color: #909183;">(</span>inp<span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>,p<span style="color: #909183;">)</span>
     i<span style="color: #0000FF;">=</span> i+<span style="color: #D0372D;">1</span>
  <span style="color: #7388D6;">}</span> 
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f90f47" class="outline-5">
<h5 id="org1f90f47">„Herkömmliche“ parallele Version des Algorithmus</h5>
<div class="outline-text-5" id="text-org1f90f47">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">normsOfPar</span><span style="color: #707183;">(</span>inp<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span>, p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Double</span>,
               left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>,
               out<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Double</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Unit</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>right - left &lt; threshold<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">i</span><span style="color: #0000FF;">=</span> left
    <span style="color: #0000FF;">while</span> <span style="color: #909183;">(</span>i &lt; right<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
      out<span style="color: #709870;">(</span>i<span style="color: #709870;">)</span><span style="color: #0000FF;">=</span> power<span style="color: #709870;">(</span>inp<span style="color: #907373;">(</span>i<span style="color: #907373;">)</span>,p<span style="color: #709870;">)</span>
      i<span style="color: #0000FF;">=</span> i+<span style="color: #D0372D;">1</span> 
    <span style="color: #909183;">}</span>
  <span style="color: #7388D6;">}</span> <span style="color: #0000FF;">else</span> <span style="color: #7388D6;">{</span>
     <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">mid</span> <span style="color: #0000FF;">=</span> left + <span style="color: #909183;">(</span>right - left<span style="color: #909183;">)</span>/<span style="color: #D0372D;">2</span>
     parallel<span style="color: #909183;">(</span>normsOfPar<span style="color: #709870;">(</span>inp, p, left, mid, out<span style="color: #709870;">)</span>,
              normsOfPar<span style="color: #709870;">(</span>inp, p, mid, right, out<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #7388D6;">}</span> 
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfa1f51b" class="outline-5">
<h5 id="orgfa1f51b">Messungen mit ScalaMeter</h5>
<div class="outline-text-5" id="text-orgfa1f51b">
<ul class="org-ul">
<li><code>inp.length = 2000000</code></li>
<li><code>threshold = 10000</code></li>
<li><p>
Intel(R) Core(TM) i7-3770K CPU @ 3.50GHz (4-core, 8 HW threads),
16GB RAM
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Ausdruck</th>
<th scope="col" class="org-right">Zeit(ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">mapASegSeq(inp, 0, inp.length, f, out)</td>
<td class="org-right">174.17</td>
</tr>

<tr>
<td class="org-left">mapASegPar(inp, 0, inp.length, f, out)</td>
<td class="org-right">28.93</td>
</tr>

<tr>
<td class="org-left">normsOfSeq(inp, p, 0, inp.length, out)</td>
<td class="org-right">166.84</td>
</tr>

<tr>
<td class="org-left">normsOfPar(inp, p, 0, inp.length, out)</td>
<td class="org-right">28.17</td>
</tr>
</tbody>
</table></li>

<li>Die Parallelisierung zahlt sich aus.</li>
<li>Die Vermeidung von Funktionen höherer Ordnung zahlt sich nicht aus.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgd438c79" class="outline-4">
<h4 id="orgd438c79">Parallele Version von <code>map</code> für Bäume</h4>
<div class="outline-text-4" id="text-orgd438c79">
<p>
Baumstruktur
</p>
<ul class="org-ul">
<li>Blätter Speichern Array-Segmente</li>
<li><p>
Innere Knoten speichern zwei Unterbäume
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #006FE0;">sealed</span> <span style="color: #006FE0;">abstract</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span> <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">size</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #707183;">}</span>
<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Leaf</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>a<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
 <span style="color: #006FE0;">override</span> <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">size</span> <span style="color: #0000FF;">=</span> a.size
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Node</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>l<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, r<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #006FE0;">override</span> <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">size</span> <span style="color: #0000FF;">=</span> l.size + r.size
<span style="color: #707183;">}</span></pre>
</pre>
</div></li>
<li>Unter der Voraussetzung, dass die Bäume balanciert sind, können die
Zweige parallel betrachtet werden.</li>
</ul>
</div>
<div id="outline-container-org9bb550f" class="outline-5">
<h5 id="org9bb550f">Implementierung</h5>
<div class="outline-text-5" id="text-org9bb550f">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">mapTreePar</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #0000FF;">:</span><span style="color: #6434A3;">Manifest</span>,<span style="color: #D0372D;">B</span><span style="color: #0000FF;">:</span><span style="color: #6434A3;">Manifest</span><span style="color: #707183;">](</span>t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, f<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">B</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">B</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span>
t <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">a</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">len</span> <span style="color: #0000FF;">=</span> a.length; <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">b</span> <span style="color: #0000FF;">=</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Array</span><span style="color: #909183;">[</span><span style="color: #D0372D;">B</span><span style="color: #909183;">](</span>len<span style="color: #909183;">)</span>
    <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">i</span><span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
    <span style="color: #0000FF;">while</span> <span style="color: #909183;">(</span>i &lt; len<span style="color: #909183;">)</span> <span style="color: #909183;">{</span> b<span style="color: #709870;">(</span>i<span style="color: #709870;">)</span><span style="color: #0000FF;">=</span> f<span style="color: #709870;">(</span>a<span style="color: #907373;">(</span>i<span style="color: #907373;">)</span><span style="color: #709870;">)</span>; i<span style="color: #0000FF;">=</span> i + <span style="color: #D0372D;">1</span> <span style="color: #909183;">}</span>
    <span style="color: #D0372D;">Leaf</span><span style="color: #909183;">(</span>b<span style="color: #909183;">)</span> <span style="color: #7388D6;">}</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Node</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">l</span>,<span style="color: #BA36A5;">r</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #909183;">(</span><span style="color: #BA36A5;">lb</span>,<span style="color: #BA36A5;">rb</span><span style="color: #909183;">)</span> <span style="color: #0000FF;">=</span> parallel<span style="color: #909183;">(</span>mapTreePar<span style="color: #709870;">(</span>l,f<span style="color: #709870;">)</span>, mapTreePar<span style="color: #709870;">(</span>r,f<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #D0372D;">Node</span><span style="color: #909183;">(</span>lb, rb<span style="color: #909183;">)</span> <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
Performanz ist mit der Array-Variante vergleichbar.
</p>
</div>
</div>
</div>
<div id="outline-container-orgaa4c4a0" class="outline-4">
<h4 id="orgaa4c4a0">Vergleich der Array- mit der Baum-Variante</h4>
<div class="outline-text-4" id="text-orgaa4c4a0">
<dl class="org-dl">
<dt>Arrays</dt><dd><ul class="org-ul">
<li>(<code>+</code>) Wahlfreier Zugriff auf die Element, geteilter Zugriff ist möglich</li>
<li>(<code>+</code>) gute</li>
<li>(<code>-</code>) imperativ: Race-Conditions müssen vermieden werden</li>
<li>(<code>-</code>) Verkettung kann aufwändig sein</li>
</ul></dd>
<dt>Bäume (nicht änderbare)</dt><dd><ul class="org-ul">
<li>(<code>+</code>) rein funktional, erzeugen neue Bäume, alte bleiben erhalten</li>
<li>(<code>+</code>) keine Synchronisation erforderlich</li>
<li>(<code>+</code>) Verkettung zweier Bäume sehr effizient</li>
<li>(<code>-</code>) Speicherverwaltung aufwändig</li>
<li>(<code>-</code>) schlechte Lokalität des Speicherzugriffs</li>
</ul></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-orgf971278" class="outline-3">
<h3 id="orgf971278">Faltungsoperationen</h3>
<div class="outline-text-3" id="text-orgf971278">
<ul class="org-ul">
<li><p>
Bisher betrachtet:
</p>
<ul class="org-ul">
<li><code>map</code>: wende eine Funktion auf jedes Element einer Collection an</li>
</ul>
<pre class="example">
List(1,3,8).map(x =&gt; x*x) == List(1, 9, 64)

</pre></li>
<li><p>
Jetzt betrachten wir:
</p>
<ul class="org-ul">
<li><code>fold</code>: verknüpfe die Elemente mit einer gegebenen Funktion</li>
</ul>
<pre class="example">
List(1,3,8).fold(100)((s,x) =&gt; s + x) == 112

</pre></li>
</ul>
</div>
<div id="outline-container-org4ac57a6" class="outline-4">
<h4 id="org4ac57a6">Varianten</h4>
<div class="outline-text-4" id="text-org4ac57a6">
<p>
<code>fold</code> akzeptiert neben anderen eine binäre Verknüpfungsoperation als
Argument. Dabei tun sich verschiedene Varianten auf:
</p>
<ul class="org-ul">
<li>sie erwarten ein Startelement oder gehen von nicht leeren Listen aus</li>
<li>in welcher Reihenfolge wird die Verknüpfungsoperation auf die
Elemente angewendet</li>
</ul>
<pre class="example">
List(1,3,8).foldLeft(100)((s,x) =&gt; s - x) == ((100 - 1) - 3) - 8 == 88 
List(1,3,8).foldRight(100)((s,x) =&gt; s - x) == 1 - (3 - (8-100)) == -94 
List(1,3,8).reduceLeft((s,x) =&gt; s - x) == (1 - 3) - 8 == -10 
List(1,3,8).reduceRight((s,x) =&gt; s - x) == 1 - (3 - 8) == 6

</pre>
<p>
Für die Parallelisierung braucht man assoziative Operationen
</p>
<ul class="org-ul">
<li>z. B. Addition, Zeichenkettenverkettung (aber keine Subtraktion)</li>
</ul>
</div>
</div>
<div id="outline-container-org78d7bd9" class="outline-4">
<h4 id="org78d7bd9">Assoziativität</h4>
<div class="outline-text-4" id="text-org78d7bd9">
<ul class="org-ul">
<li>Eine Operation \(f: (A,A) \rightarrow A\) ist assoziativ genau dann,
wenn für alle \(x, y, z\) gilt: \[f(x, f(y, z)) = f(f(x, y), z)\]</li>
<li>Schreibt man \(f(a, b)\) in Infix-Notation als \(a \otimes b\), wird aus
der Assoziativitätsregel: \[x\otimes(y\otimes z) = (x\otimes y)\otimes z\]</li>
<li>Konsequenz: Klammersetzung spielt keine Rolle, z. B, liefern diese
Ausdrücke immer das gleiche Resultat:
\[(x\otimes y)\otimes (z\otimes w) = (x\otimes (y\otimes z))\otimes w = ((x\otimes y)\otimes z)\otimes w\]</li>
</ul>
</div>
</div>
<div id="outline-container-orgaca5c53" class="outline-4">
<h4 id="orgaca5c53">Ausdrücke als Bäume</h4>
<div class="outline-text-4" id="text-orgaca5c53">
<ul class="org-ul">
<li>Blätter sind die Werte</li>
<li>Knoten sind die Operationen 
<dl class="org-dl">
<dt>\(x\otimes(y\otimes z)\)</dt><dd><img src="./Abbildungen/xyz.png" alt="xyz.png" width="200px" /></dd>
<dt>\((x\otimes y)\otimes (z\otimes w)\)</dt><dd><img src="./Abbildungen/xyzw.png" alt="xyzw.png" width="200px" /></dd>
</dl></li>
</ul>
</div>
</div>
<div id="outline-container-org42451a2" class="outline-4">
<h4 id="org42451a2">Falten (Reduzieren) von Bäumen</h4>
<div class="outline-text-4" id="text-org42451a2">
<ul class="org-ul">
<li><p>
Wie wird der Wert eines Ausdrucksbaums berechnet?
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #006FE0;">sealed</span> <span style="color: #006FE0;">abstract</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span>
<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Leaf</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>value<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span>
<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Node</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span>  </pre>
</pre>
</div></li>
<li>Das Resultat der Auswertung eines Ausdrucks entsteht durch Anwendung
einer Funktio <code>reduce</code> auf den Baum.</li>
</ul>
</div>
<div id="outline-container-org7d7f906" class="outline-5">
<h5 id="org7d7f906">Sequentielle Definition:</h5>
<div class="outline-text-5" id="text-org7d7f906">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">reduce</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, f <span style="color: #0000FF;">:</span> <span style="color: #7388D6;">(</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">A</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">A</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=</span> t <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">v</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> v
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Node</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">l</span>, <span style="color: #BA36A5;">r</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> f<span style="color: #7388D6;">(</span>reduce<span style="color: #909183;">[</span><span style="color: #D0372D;">A</span><span style="color: #909183;">](</span>l, f<span style="color: #909183;">)</span>, reduce<span style="color: #909183;">[</span><span style="color: #D0372D;">A</span><span style="color: #909183;">](</span>r, f<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>   <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Node -&gt; f</span>
<span style="color: #707183;">}</span>  </pre>
</pre>
</div>
<ul class="org-ul">
<li>Die Faltung (Reduzierung) eines Knotens (<code>Node</code>) kann als Ersetzung
des <code>Node</code>-Konstruktors durch die Argumentfunktion <code>f</code> angesehen
werden.</li>
<li>Anwendung von <code>reduce</code>
<ul class="org-ul">
<li><p>
Für nicht-assoziative Operationen hängt das Resultat von der
Struktur des Baumes ab:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">tree</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">Node</span><span style="color: #707183;">(</span><span style="color: #D0372D;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>, <span style="color: #D0372D;">Node</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">Leaf</span><span style="color: #909183;">(</span><span style="color: #D0372D;">3</span><span style="color: #909183;">)</span>, <span style="color: #D0372D;">Leaf</span><span style="color: #909183;">(</span><span style="color: #D0372D;">8</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">fMinus</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">(</span>x<span style="color: #0000FF;">:</span><span style="color: #6434A3;">Int</span>,y<span style="color: #0000FF;">:</span><span style="color: #6434A3;">Int</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">=&gt;</span> x - y
<span style="color: #0000FF;">def</span> <span style="color: #006699;">res</span> <span style="color: #0000FF;">=</span> reduce<span style="color: #707183;">[</span><span style="color: #D0372D;">Int</span><span style="color: #707183;">](</span>tree, fMinus<span style="color: #707183;">)</span></pre>
</pre>
</div></li>
<li>Resultat?</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org73ff574" class="outline-5">
<h5 id="org73ff574">Parallele Definition</h5>
<div class="outline-text-5" id="text-org73ff574">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">reduce</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, f <span style="color: #0000FF;">:</span> <span style="color: #7388D6;">(</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">A</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">A</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=</span> t <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">v</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> v
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Node</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">l</span>, <span style="color: #BA36A5;">r</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #909183;">(</span><span style="color: #BA36A5;">lV</span>, <span style="color: #BA36A5;">rV</span><span style="color: #909183;">)</span> <span style="color: #0000FF;">=</span> parallel<span style="color: #909183;">(</span>reduce<span style="color: #709870;">[</span><span style="color: #D0372D;">A</span><span style="color: #709870;">](</span>l, f<span style="color: #709870;">)</span>, reduce<span style="color: #709870;">[</span><span style="color: #D0372D;">A</span><span style="color: #709870;">](</span>r, f<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
f<span style="color: #909183;">(</span>lV, rV<span style="color: #909183;">)</span> <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb86a20c" class="outline-4">
<h4 id="orgb86a20c">Assoziativitätsbetrachtung</h4>
<div class="outline-text-4" id="text-orgb86a20c">
<p>
\[ $x\otimes(y\otimes z) = (x\otimes y)\otimes z\]
Mit Ersetzung von \(\otimes\) in Scala durch <code>f</code> kann die Gleichung wie
folgt geschrieben werden:
</p>
<pre class="example">
reduce(Node(Leaf(x), Node(Leaf(y), Leaf(z))), f) ==
reduce(Node(Node(Leaf(x), Leaf(y)), Leaf(z)), f)

</pre>
</div>
</div>
<div id="outline-container-orgde0046b" class="outline-4">
<h4 id="orgde0046b">Baumordnung repräsentiert durch Listen</h4>
<div class="outline-text-4" id="text-orgde0046b">
<ul class="org-ul">
<li><p>
Die Ordnung der Elemente in einem Baum kann durch Umwandlung in eine
Liste wiedergegeben werden:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">toList</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> t <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">v</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">List</span><span style="color: #7388D6;">(</span>v<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Node</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">l</span>, <span style="color: #BA36A5;">r</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> toList<span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">](</span>l<span style="color: #7388D6;">)</span> ++ toList<span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">](</span>r<span style="color: #7388D6;">)</span>  <span style="color: #707183;">}</span></pre>
</pre>
</div></li>
<li><p>
Wie kann unter Verwendung der folgenden <code>map</code>-Funktion für Bäume 
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">map</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">B</span><span style="color: #707183;">](</span>t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, f <span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">B</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">B</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> t <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">v</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Leaf</span><span style="color: #7388D6;">(</span>f<span style="color: #909183;">(</span>v<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Node</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">l</span>, <span style="color: #BA36A5;">r</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Node</span><span style="color: #7388D6;">(</span>map<span style="color: #909183;">[</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">B</span><span style="color: #909183;">](</span>l, f<span style="color: #909183;">)</span>, map<span style="color: #909183;">[</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">B</span><span style="color: #909183;">](</span>r, f<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>  
<span style="color: #707183;">}</span>  </pre>
</pre>
</div>
<p>
die Funktion <code>toList</code> unter Verwendung von <code>map</code> und <code>reduce</code>
formuliert werden?
</p></li>
<li>Antwort:</li>
</ul>
</div>
<div id="outline-container-org58a12ea" class="outline-5">
<h5 id="org58a12ea">Konsequenz der Assoziativität für die Baumreduktion</h5>
<div class="outline-text-5" id="text-org58a12ea">
<ul class="org-ul">
<li>Betrachte zwei Ausdrücke mit derselben Liste von Operanden,
verknüpft mit $&otimes;§ aber unterschiedlicher Klammerung: Diese
Ausdrücke besitzen den gleichen Wert.</li>
<li><p>
Formal:<br />
Wenn <code>f: (A,A) =&gt; A</code> assoziativ ist, <code>t1: Tree[A]</code>, <code>t2: Tree[A]</code>
und wenn <code>toList(t1)==toList(t2)</code> dann gilt: <br />
</p>

<p>
<code>reduce(t1, f)==reduce(t2, f)</code>
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org0fa2935" class="outline-4">
<h4 id="org0fa2935">Ergänzung: Parallele Faltungsoperation für Arrays</h4>
<div class="outline-text-4" id="text-org0fa2935">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">reduceSeg</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>inp<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>, f<span style="color: #0000FF;">:</span> <span style="color: #7388D6;">(</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">A</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">A</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>right - left &lt; threshold<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">res</span><span style="color: #0000FF;">=</span> inp<span style="color: #909183;">(</span>left<span style="color: #909183;">)</span>; <span style="color: #0000FF;">var</span> <span style="color: #ff0000; font-weight: bold;">i</span><span style="color: #0000FF;">=</span> left+<span style="color: #D0372D;">1</span>
    <span style="color: #0000FF;">while</span> <span style="color: #909183;">(</span>i &lt; right<span style="color: #909183;">)</span> <span style="color: #909183;">{</span> res<span style="color: #0000FF;">=</span> f<span style="color: #709870;">(</span>res, inp<span style="color: #907373;">(</span>i<span style="color: #907373;">)</span><span style="color: #709870;">)</span>; i<span style="color: #0000FF;">=</span> i+<span style="color: #D0372D;">1</span> <span style="color: #909183;">}</span>
    res
  <span style="color: #7388D6;">}</span> <span style="color: #0000FF;">else</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">mid</span> <span style="color: #0000FF;">=</span> left + <span style="color: #909183;">(</span>right - left<span style="color: #909183;">)</span>/<span style="color: #D0372D;">2</span>
    <span style="color: #0000FF;">val</span> <span style="color: #909183;">(</span><span style="color: #BA36A5;">a1</span>,<span style="color: #BA36A5;">a2</span><span style="color: #909183;">)</span> <span style="color: #0000FF;">=</span> parallel<span style="color: #909183;">(</span>reduceSeg<span style="color: #709870;">(</span>inp, left, mid, f<span style="color: #709870;">)</span>,
                           reduceSeg<span style="color: #709870;">(</span>inp, mid, right, f<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
f<span style="color: #909183;">(</span>a1,a2<span style="color: #909183;">)</span> <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">reduce</span><span style="color: #707183;">[</span><span style="color: #D0372D;">A</span><span style="color: #707183;">](</span>inp<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">A</span><span style="color: #7388D6;">]</span>, f<span style="color: #0000FF;">:</span> <span style="color: #7388D6;">(</span><span style="color: #D0372D;">A</span>,<span style="color: #D0372D;">A</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">A</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">A</span> <span style="color: #0000FF;">=</span>
  reduceSeg<span style="color: #707183;">(</span>inp, <span style="color: #D0372D;">0</span>, inp.length, f<span style="color: #707183;">)</span></pre>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org78ba825" class="outline-2">
<h2 id="org78ba825">Datenparallelität</h2>
<div class="outline-text-2" id="text-org78ba825">
<p>
Bisher Task-Parallelität betrachtet:
</p>
<blockquote>
<p>
Verteilung von Berechnungsprozessen auf Prozessoren
</p>
</blockquote>
<p>
In Scala stehen hier die Konstrukte <code>parallel</code> und <code>task</code> zur
Verfügung.
</p>

<p>
Datenparallelität
</p>
<blockquote>
<p>
Verteilung von Daten auf Prozessoren
</p>
</blockquote>
</div>
<div id="outline-container-org650e550" class="outline-4">
<h4 id="org650e550">Datenparalleles Programmiermodell</h4>
<div class="outline-text-4" id="text-org650e550">
<ul class="org-ul">
<li>Einfachste Form der datenparallelen Programmierung ist die parallele</li>
</ul>
<p>
<code>for</code>-Schleife.
</p>
<ul class="org-ul">
<li>Beispiel Initialisierung von Array-elementen:</li>
</ul>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">initializeArray</span><span style="color: #707183;">(</span>xs<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)(</span>v<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Unit</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">for</span> <span style="color: #7388D6;">(</span>i <span style="color: #0000FF;">&lt;-</span> <span style="color: #909183;">(</span><span style="color: #D0372D;">0</span> until xs.length<span style="color: #909183;">)</span>.par<span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
xs<span style="color: #909183;">(</span>i<span style="color: #909183;">)</span> <span style="color: #0000FF;">=</span> v <span style="color: #7388D6;">}</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<ul class="org-ul">
<li>Der Aufruf von <code>.par</code> sorgt dafür, dass die Iterationen der
<code>for</code>-Schleife auf verschiedenen Prozessoren konkurrierend
ablaufen.</li>
<li>Achtung: Die parallele <code>for</code>-Schleife ist nicht funktional sondern
arbeitet mit Seiteneffekten.</li>
<li>Der Programmierer ist dafür verantwortlich, dass innerhalb der
Schleife nur unterschiedliche Speicherzellen beschrieben werden.</li>
</ul>
</div>
</div>
<div id="outline-container-org2d0cd66" class="outline-4">
<h4 id="org2d0cd66">Parallele Collections</h4>
<div class="outline-text-4" id="text-org2d0cd66">
<ul class="org-ul">
<li>Neben der parallelen <code>for</code>-Schleife können auch sequentielle
Collections in parallele verwandelt werden.</li>
<li><p>
Der Aufruf von <code>.par</code> macht aus dem sequentiellen Interval ein
paralleles:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #707183;">(</span><span style="color: #D0372D;">1</span> until <span style="color: #D0372D;">1000</span><span style="color: #707183;">)</span>.par
  .filter<span style="color: #707183;">(</span>n <span style="color: #0000FF;">=&gt;</span> n % <span style="color: #D0372D;">3</span> == <span style="color: #D0372D;">0</span><span style="color: #707183;">)</span>
  .count<span style="color: #707183;">(</span>n <span style="color: #0000FF;">=&gt;</span> n.toString == n.toString.reverse<span style="color: #707183;">)</span> </pre>
</pre>
</div></li>
<li>Nicht alle Operationen sind parallelisierbar.
<ul class="org-ul">
<li><p>
Beispiel: Versuch, die Methode <code>sum</code> mithilfe von <code>foldLeft</code> zu
implementieren:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">sum</span><span style="color: #707183;">(</span>xs<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  xs.par.foldLeft<span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span><span style="color: #7388D6;">)(</span><span style="color: #0000FF;">_</span> + <span style="color: #0000FF;">_</span><span style="color: #7388D6;">)</span>
<span style="color: #707183;">}</span>  </pre>
</pre>
</div></li>
<li>Warum wird <code>sum</code> nicht parallel ausgeführt?</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3d8e4fa" class="outline-4">
<h4 id="org3d8e4fa">Die Operation <code>fold</code></h4>
<div class="outline-text-4" id="text-org3d8e4fa">
<ul class="org-ul">
<li><code>fold</code>-Operation führt intern eine Baumreduktion durch (s. o.).</li>
<li><p>
Implementierung der <code>sum</code>-Methode:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">sum</span><span style="color: #707183;">(</span>xs<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Array</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  xs.par.fold<span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span><span style="color: #7388D6;">)(</span><span style="color: #0000FF;">_</span> + <span style="color: #0000FF;">_</span><span style="color: #7388D6;">)</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div></li>
<li>Voraussetzung: Die Verknüpfungsoperation muss assoziativ sein.</li>
</ul>
</div>
</div>
<div id="outline-container-orgaac87dc" class="outline-4">
<h4 id="orgaac87dc">Hierarchie der Scala Collection-Klassen</h4>
<div class="outline-text-4" id="text-orgaac87dc">
<dl class="org-dl">
<dt>Traversable[T]</dt><dd>Collection mit Elementen vom Typ <code>T</code> mit
Operationen, die mit <code>foreach</code> implementiert sind</dd>
<dt>Iterable[T]</dt><dd>Collection mit Elementen vom Typ <code>T=mit
                    Operationen, die mit =iterator</code> implementiert sind</dd>
<dt>Seq[T]</dt><dd>geordnete Sequenz mit Elementen vom Typ <code>T</code></dd>
<dt>Set[T]</dt><dd>eine Menge mit Elementen vom Typ <code>T</code> (keine Duplikate)</dd>
<dt>Map[K, V]</dt><dd>eine Map mit Schlüsseln vom Typ <code>K</code> und Werten vom Typ
<code>V</code> (Schlüssel sind eindeutig)</dd>
</dl>
</div>
</div>
<div id="outline-container-orgb7454e8" class="outline-4">
<h4 id="orgb7454e8">Parallele Collection-Hierarchie</h4>
<div class="outline-text-4" id="text-orgb7454e8">
<ul class="org-ul">
<li>Traits <code>ParIterable[T]</code>, <code>ParSeq[T]</code>, <code>ParSet[T]</code> und <code>ParMap[K, V]</code>
sind die parallelen Gegenstücke zu verschiednen sequentiellen
Traits.</li>
<li><p>
Für Programmcode, der agnostisch gegenüber Parallelität sein soll,
existiert eine separate Hierarchie von generischen
Collection-Traits: 
</p>

<p>
<code>GenIterable[T]</code>, <code>GenSeq[T]</code>, <code>GenSet[T]</code>, <code>GenMap[K, V]</code>
</p>


<div class="figure">
<p><img src="./Abbildungen/gencoll.png" alt="gencoll.png" width="450px" />
</p>
</div></li>
</ul>
</div>

<div id="outline-container-org9e34a54" class="outline-5">
<h5 id="org9e34a54">Anwendungsbeispiel</h5>
<div class="outline-text-5" id="text-org9e34a54">
<p>
Finde das größte Palindrom in einer Sequenz:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">largestPalindrome</span><span style="color: #707183;">(</span>xs<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">GenSeq</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">Int</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  xs.aggregate<span style="color: #7388D6;">(</span><span style="color: #D0372D;">Int</span>.<span style="color: #D0372D;">MinValue</span><span style="color: #7388D6;">)(</span>
    <span style="color: #909183;">(</span>largest, n<span style="color: #909183;">)</span> <span style="color: #0000FF;">=&gt;</span>
    <span style="color: #0000FF;">if</span> <span style="color: #909183;">(</span>n &gt; largest &amp;&amp; n.toString == n.toString.reverse<span style="color: #909183;">)</span> n <span style="color: #0000FF;">else</span> largest,
    math.max
<span style="color: #7388D6;">)</span> <span style="color: #707183;">}</span>
<span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">array</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">(</span><span style="color: #D0372D;">0</span> until <span style="color: #D0372D;">1000000</span><span style="color: #707183;">)</span>.toArray
<span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">2 gleichwertige Aufrufvarianten</span>
largestPalindrome<span style="color: #707183;">(</span>array<span style="color: #707183;">)</span>
largestPalindrome<span style="color: #707183;">(</span>array.par<span style="color: #707183;">)</span></pre>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org569ef9f" class="outline-2">
<h2 id="org569ef9f">Datenstrukturen für parallele Berechnungen</h2>
<div class="outline-text-2" id="text-org569ef9f">
<p>
hier: interne Repräsentation von Listen durch Conc-Bäume
</p>
</div>
<div id="outline-container-org23a2409" class="outline-3">
<h3 id="org23a2409">Ein Datentyp für Listen</h3>
<div class="outline-text-3" id="text-org23a2409">
<p>
&#x2026; wie er für funktionale Programmiersprachen typisch ist:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #006FE0;">sealed</span> <span style="color: #0000FF;">trait</span> <span style="color: #6434A3;">List</span><span style="color: #707183;">[</span>+<span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">head</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">T</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">tail</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span>
<span style="color: #707183;">}</span>

<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">::</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>head<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">T</span>, tail<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">List</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span>

<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">object</span> <span style="color: #D0372D;">Nil</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">List</span><span style="color: #707183;">[</span><span style="color: #D0372D;">Nothing</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">head</span> <span style="color: #0000FF;">=</span> sys.error<span style="color: #7388D6;">(</span>&#8221;empty list&#8221;<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">tail</span> <span style="color: #0000FF;">=</span> sys.error<span style="color: #7388D6;">(</span>&#8221;empty list&#8221;<span style="color: #7388D6;">)</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
<div id="outline-container-org4b70bbc" class="outline-4">
<h4 id="org4b70bbc">Filter-Methode</h4>
<div class="outline-text-4" id="text-org4b70bbc">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">filter</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>lst<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)(</span>p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">T</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Boolean</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">List</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> lst <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #BA36A5;">x</span> <span style="color: #6434A3;">::</span> <span style="color: #BA36A5;">xs</span> <span style="color: #0000FF;">if</span> p<span style="color: #7388D6;">(</span>x<span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> x :: filter<span style="color: #7388D6;">(</span>xs<span style="color: #7388D6;">)(</span>p<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">case</span> <span style="color: #BA36A5;">x</span> <span style="color: #6434A3;">::</span> <span style="color: #BA36A5;">xs</span> <span style="color: #0000FF;">=&gt;</span> filter<span style="color: #7388D6;">(</span>xs<span style="color: #7388D6;">)(</span>p<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">case</span> <span style="color: #D0372D;">Nil</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Nil</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org17ad066" class="outline-3">
<h3 id="org17ad066">Ein Datentyp für Bäume</h3>
<div class="outline-text-3" id="text-org17ad066">
<ul class="org-ul">
<li>Listen sind für sequentielle Berechnungen geeignet, sie werden von
links nach rechts abgearbeitet.</li>
<li>Bäume erlauben parallele Verarbeitung der Unterbäume.</li>
</ul>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #006FE0;">sealed</span> <span style="color: #0000FF;">trait</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span>+<span style="color: #D0372D;">T</span><span style="color: #707183;">]</span>

<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Node</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span>

<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Leaf</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>elem<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">T</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span>

<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">object</span> <span style="color: #D0372D;">Empty</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">Nothing</span><span style="color: #707183;">]</span></pre>
</pre>
</div>
</div>
<div id="outline-container-org55b6fe8" class="outline-4">
<h4 id="org55b6fe8">Filter-Methode</h4>
<div class="outline-text-4" id="text-org55b6fe8">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">filter</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>t<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)(</span>p<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">T</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Boolean</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Tree</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> t <span style="color: #0000FF;">match</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Node</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">left</span>, <span style="color: #BA36A5;">right</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Node</span><span style="color: #7388D6;">(</span>parallel<span style="color: #909183;">(</span>filter<span style="color: #709870;">(</span>left<span style="color: #709870;">)(</span>p<span style="color: #709870;">)</span>, filter<span style="color: #709870;">(</span>right<span style="color: #709870;">)(</span>p<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">case</span> <span style="color: #6434A3;">Leaf</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">elem</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>p<span style="color: #909183;">(</span>elem<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span> t <span style="color: #0000FF;">else</span> <span style="color: #D0372D;">Empty</span>
  <span style="color: #0000FF;">case</span> <span style="color: #D0372D;">Empty</span> <span style="color: #0000FF;">=&gt;</span> <span style="color: #D0372D;">Empty</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
Bäume „entarten“ leicht zu Listen.
</p>

<div class="figure">
<p><img src="./Abbildungen/baumfilterung.png" alt="baumfilterung.png" width="600px" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org3f7f0ae" class="outline-3">
<h3 id="org3f7f0ae">Der Datentyp <code>Conc</code></h3>
<div class="outline-text-3" id="text-org3f7f0ae">
<p>
Ein Datentyp für balancierte Bäume:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #006FE0;">sealed</span> <span style="color: #0000FF;">trait</span> <span style="color: #6434A3;">Conc</span><span style="color: #707183;">[</span>+<span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">level</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">size</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Int</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">left</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">right</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
<p>
In der parallelen Programmierung wird dieser Typ auch als <i>conc-list</i>
bezeichnet (ursprünglich für die Programmiersprache <i><a href="https://de.wikipedia.org/wiki/Fortress_(Programmiersprache)">Fortress</a></i>
entwickelt).
</p>
</div>
<div id="outline-container-orgb75b4f0" class="outline-4">
<h4 id="orgb75b4f0">Konkrete Implementierung</h4>
<div class="outline-text-4" id="text-orgb75b4f0">
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">case</span> <span style="color: #0000FF;">object</span> <span style="color: #D0372D;">Empty</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Conc</span><span style="color: #707183;">[</span><span style="color: #D0372D;">Nothing</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">level</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
  <span style="color: #0000FF;">def</span> <span style="color: #006699;">size</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
<span style="color: #707183;">}</span>
<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Single</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span><span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">x</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">T</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Conc</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">level</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">size</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">1</span> <span style="color: #707183;">}</span>
<span style="color: #0000FF;">case</span> <span style="color: #0000FF;">class</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>left<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span>, right<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">extends</span> <span style="color: #6434A3;">Conc</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">level</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">1</span> + math.max<span style="color: #7388D6;">(</span>left.level, right.level<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">size</span> <span style="color: #0000FF;">=</span> left.size + right.size
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6647387" class="outline-4">
<h4 id="org6647387">Invarianten für Conc-Bäume</h4>
<div class="outline-text-4" id="text-org6647387">
<ol class="org-ol">
<li>Ein <code>&lt;&gt;</code>-Knoten kann niemals <code>Empty</code> als Umterbaum besitzen.</li>
<li>Die <code>level</code>-Differenz zwischen linkem und rechten Unterbaum ist
immer kleiner oder gleich 1.</li>
</ol>
<p>
Implementierungen müssen diese Invarianten beachten.
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">&lt;&gt;</span><span style="color: #707183;">(</span>that<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span><span style="color: #0000FF;">this</span> == <span style="color: #D0372D;">Empty</span><span style="color: #7388D6;">)</span> that
  <span style="color: #0000FF;">else</span> <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>that == <span style="color: #D0372D;">Empty</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">this</span>
  <span style="color: #0000FF;">else</span> concat<span style="color: #7388D6;">(</span><span style="color: #0000FF;">this</span>, that<span style="color: #7388D6;">)</span>
<span style="color: #707183;">}</span></pre>
</pre>
</div>
</div>
<div id="outline-container-orgf458633" class="outline-5">
<h5 id="orgf458633">Implementierung von <code>concat</code></h5>
<div class="outline-text-5" id="text-orgf458633">
<p>
Verschiedene Fälle sind zu betrachten.
</p>
<dl class="org-dl">
<dt>Fall 1</dt><dd><p>
Die beiden zu verknüpfenden Bäume haben eine Höhendifferenz \(\leq 1\)
</p>

<div class="figure">
<p><img src="./Abbildungen/kleineHoehendifferenz.png" alt="kleineHoehendifferenz.png" width="600px" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">def</span> <span style="color: #006699;">concat</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">](</span>xs<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span>, ys<span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #7388D6;">[</span><span style="color: #D0372D;">T</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span><span style="color: #0000FF;">:</span> <span style="color: #6434A3;">Conc</span><span style="color: #707183;">[</span><span style="color: #D0372D;">T</span><span style="color: #707183;">]</span> <span style="color: #0000FF;">=</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">diff</span> <span style="color: #0000FF;">=</span> ys.level - xs.level
  <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>diff &gt;= <span style="color: #D0372D;">-1</span> &amp;&amp; diff &lt;= <span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #7388D6;">(</span>xs, ys<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">else</span> <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>diff &lt; <span style="color: #D0372D;">-1</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>  </pre>
</pre>
</div></dd>
<dt>Fall 2</dt><dd>Der linke Baum ist höher als der rechte
<dl class="org-dl">
<dt>Unterfall 1</dt><dd><p>
der linke Baum ist linkslastig &#x2026;
</p>
<p width="600px">
<img src="./Abbildungen/concat.png" alt="concat.png" width="600px" />
&#x2026; dann „concateniere” rekursiv mit dem rechten Unterbaum
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>xs.left.level &gt;= xs.right.level<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">nr</span> <span style="color: #0000FF;">=</span> concat<span style="color: #7388D6;">(</span>xs.right, ys<span style="color: #7388D6;">)</span>
  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #7388D6;">(</span>xs.left, nr<span style="color: #7388D6;">)</span>
<span style="color: #707183;">}</span> <span style="color: #0000FF;">else</span> <span style="color: #707183;">{</span>    </pre>
</pre>
</div></dd>
<dt>Unterfall2</dt><dd><p>
der linke Baum ist rechtslastig &#x2026; 
</p>

<div class="figure">
<p><img src="./Abbildungen/concat2.png" alt="concat2.png" width="600px" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-scala"><span style="background-color: #FFDCDC; text-decoration: underline;">}</span> <span style="color: #0000FF;">else</span> <span style="background-color: #FFDCDC; text-decoration: underline;">{</span>
  <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">nrr</span> <span style="color: #0000FF;">=</span> concat<span style="color: #707183;">(</span>xs.right.right, ys<span style="color: #707183;">)</span>
  <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>nrr.level == xs.level - <span style="color: #D0372D;">3</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">nl</span> <span style="color: #0000FF;">=</span> xs.left
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">nr</span> <span style="color: #0000FF;">=</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #7388D6;">(</span>xs.right.left, nrr<span style="color: #7388D6;">)</span>
    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #7388D6;">(</span>nl, nr<span style="color: #7388D6;">)</span>
  <span style="color: #707183;">}</span> <span style="color: #0000FF;">else</span> <span style="color: #707183;">{</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">nl</span> <span style="color: #0000FF;">=</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #7388D6;">(</span>xs.left, xs.right.left<span style="color: #7388D6;">)</span>
    <span style="color: #0000FF;">val</span> <span style="color: #BA36A5;">nr</span> <span style="color: #0000FF;">=</span> nrr
    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">&lt;&gt;</span><span style="color: #7388D6;">(</span>nl, nr<span style="color: #7388D6;">)</span>
  <span style="color: #707183;">}</span> 
<span style="background-color: #FFDCDC; text-decoration: underline;">}</span>    </pre>
</pre>
</div></dd>
</dl></dd>
</dl>
<p>
<b>Wichtig:</b> Die Konkatenation ist von der Ordnung \(O(h_1 - h_2)\), wobei
 \(h_1\) und \(h_2\) die Höhen der beiden Bäume sind.
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff26b63" class="outline-2">
<h2 id="orgff26b63"><h2>Literaturverzeichnis</h2>
<ul class='org-ref-bib'><li><a id="KuncakProkopec2015">[KuncakProkopec2015] Viktor Kuncak & Aleksandar Prokopec, Parallel Programming, (2015), zuletzt aufgerufen am 10.11.2017: <a href="https://www.coursera.org/learn/parprog1/home/info">https://www.coursera.org/learn/parprog1/home/info</a> </a></li>
<li><a id="Drepper2007">[Drepper2007] Ulrich Drepper, What Every Programmer Should Know About Memory, (2007), zuletzt aufgerufen am 16.11.2017: <a href="https://people.freebsd.org/~lstewart/articles/cpumemory.pdf">https://people.freebsd.org/~lstewart/articles/cpumemory.pdf</a> </a></li>
<li><a id="Georges2007">[Georges2007] Georges, Buytaert & Eeckhout, Statistically Rigorous Java Performance Evaluation, <i>SIGPLAN Not.</i>, <b>42(10)</b>, 57-76 (2007). <a href="http://doi.acm.org/10.1145/1297105.1297033">link</a>. <a href="http://dx.doi.org/10.1145/1297105.1297033">doi</a>.</a></li>
</ul></h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Johannes Brauer</p>
<p class="date">Created: 2017-11-20 Mon 12:28</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>